cscope 15 $HOME/myir/myd-am335x/kernel/linux-3.2.0-psp04.06.00.08.sdk/sound/soc               0000195735
	@soc-cache.c

14 
	~<löux/i2c.h
>

15 
	~<löux/•i/•i.h
>

16 
	~<sound/soc.h
>

17 
	~<löux/lzo.h
>

18 
	~<löux/bôm≠.h
>

19 
	~<löux/rbåì.h
>

20 
	~<löux/exp‹t.h
>

22 
	~<åa˚/evíts/asoc.h
>

24 
boﬁ
 
	$¢d_soc_£t_ˇche_vÆ
(*
ba£
, 
idx
,

25 
vÆ
, 
w‹d_size
)

27 
w‹d_size
) {

29 
u8
 *
ˇche
 = 
ba£
;

30 i‡(
ˇche
[
idx
] =
vÆ
)

31  
åue
;

32 
ˇche
[
idx
] = 
vÆ
;

36 
u16
 *
ˇche
 = 
ba£
;

37 i‡(
ˇche
[
idx
] =
vÆ
)

38  
åue
;

39 
ˇche
[
idx
] = 
vÆ
;

43 
	`BUG
();

45  
Ál£
;

46 
	}
}

48 
	$¢d_soc_gë_ˇche_vÆ
(c⁄° *
ba£
, 
idx
,

49 
w‹d_size
)

51 i‡(!
ba£
)

54 
w‹d_size
) {

56 c⁄° 
u8
 *
ˇche
 = 
ba£
;

57  
ˇche
[
idx
];

60 c⁄° 
u16
 *
ˇche
 = 
ba£
;

61  
ˇche
[
idx
];

64 
	`BUG
();

68 
	}
}

70 
	s¢d_soc_rbåì_node
 {

71 
rb_node
 
	mnode
;

72 
	mba£_ªg
;

73 
	mw‹d_size
;

74 *
	mblock
;

75 
	mblkÀn
;

76 } 
__©åibuã__
 ((
∑cked
));

78 
	s¢d_soc_rbåì_˘x
 {

79 
rb_roŸ
 
	mroŸ
;

80 
¢d_soc_rbåì_node
 *
	mˇched_rbnode
;

83 
ölöe
 
	$¢d_soc_rbåì_gë_ba£_t›_ªg
(

84 
¢d_soc_rbåì_node
 *
rbnode
,

85 *
ba£
, *
t›
)

87 *
ba£
 = 
rbnode
->
ba£_ªg
;

88 *
t›
 = 
rbnode
->
ba£_ªg
 +Ñbnode->
blkÀn
 - 1;

89 
	}
}

91 
	$¢d_soc_rbåì_gë_ªgi°î
(

92 
¢d_soc_rbåì_node
 *
rbnode
, 
idx
)

94 
vÆ
;

96 
rbnode
->
w‹d_size
) {

98 
u8
 *
p
 = 
rbnode
->
block
;

99 
vÆ
 = 
p
[
idx
];

100  
vÆ
;

103 
u16
 *
p
 = 
rbnode
->
block
;

104 
vÆ
 = 
p
[
idx
];

105  
vÆ
;

108 
	`BUG
();

112 
	}
}

114 
	$¢d_soc_rbåì_£t_ªgi°î
(
¢d_soc_rbåì_node
 *
rbnode
,

115 
idx
, 
vÆ
)

117 
rbnode
->
w‹d_size
) {

119 
u8
 *
p
 = 
rbnode
->
block
;

120 
p
[
idx
] = 
vÆ
;

124 
u16
 *
p
 = 
rbnode
->
block
;

125 
p
[
idx
] = 
vÆ
;

129 
	`BUG
();

132 
	}
}

134 
¢d_soc_rbåì_node
 *
	$¢d_soc_rbåì_lookup
(

135 
rb_roŸ
 *
roŸ
, 
ªg
)

137 
rb_node
 *
node
;

138 
¢d_soc_rbåì_node
 *
rbnode
;

139 
ba£_ªg
, 
t›_ªg
;

141 
node
 = 
roŸ
->
rb_node
;

142 
node
) {

143 
rbnode
 = 
	`c⁄èöî_of
(
node
, 
¢d_soc_rbåì_node
,Çode);

144 
	`¢d_soc_rbåì_gë_ba£_t›_ªg
(
rbnode
, &
ba£_ªg
, &
t›_ªg
);

145 i‡(
ªg
 >
ba£_ªg
 &&Ñeg <
t›_ªg
)

146  
rbnode
;

147 i‡(
ªg
 > 
t›_ªg
)

148 
node
 =Çode->
rb_right
;

149 i‡(
ªg
 < 
ba£_ªg
)

150 
node
 =Çode->
rb_À·
;

153  
NULL
;

154 
	}
}

156 
	$¢d_soc_rbåì_ö£π
(
rb_roŸ
 *
roŸ
,

157 
¢d_soc_rbåì_node
 *
rbnode
)

159 
rb_node
 **
√w
, *
∑ª¡
;

160 
¢d_soc_rbåì_node
 *
rbnode_tmp
;

161 
ba£_ªg_tmp
, 
t›_ªg_tmp
;

162 
ba£_ªg
;

164 
∑ª¡
 = 
NULL
;

165 
√w
 = &
roŸ
->
rb_node
;

166 *
√w
) {

167 
rbnode_tmp
 = 
	`c⁄èöî_of
(*
√w
, 
¢d_soc_rbåì_node
,

168 
node
);

170 
	`¢d_soc_rbåì_gë_ba£_t›_ªg
(
rbnode_tmp
, &
ba£_ªg_tmp
,

171 &
t›_ªg_tmp
);

173 
ba£_ªg
 = 
rbnode
->base_reg;

174 
∑ª¡
 = *
√w
;

176 i‡(
ba£_ªg
 >
ba£_ªg_tmp
 &&

177 
ba£_ªg
 <
t›_ªg_tmp
)

179 i‡(
ba£_ªg
 > 
t›_ªg_tmp
)

180 
√w
 = &((*√w)->
rb_right
);

181 i‡(
ba£_ªg
 < 
ba£_ªg_tmp
)

182 
√w
 = &((*√w)->
rb_À·
);

186 
	`rb_lök_node
(&
rbnode
->
node
, 
∑ª¡
, 
√w
);

187 
	`rb_ö£π_cﬁ‹
(&
rbnode
->
node
, 
roŸ
);

190 
	}
}

192 
	$¢d_soc_rbåì_ˇche_sync
(
¢d_soc_codec
 *
codec
)

194 
¢d_soc_rbåì_˘x
 *
rbåì_˘x
;

195 
rb_node
 *
node
;

196 
¢d_soc_rbåì_node
 *
rbnode
;

197 
ªgtmp
;

198 
vÆ
, 
def
;

199 
ªt
;

200 
i
;

202 
rbåì_˘x
 = 
codec
->
ªg_ˇche
;

203 
node
 = 
	`rb_fú°
(&
rbåì_˘x
->
roŸ
);Çode;Çodê
	`rb_√xt
(node)) {

204 
rbnode
 = 
	`rb_íåy
(
node
, 
¢d_soc_rbåì_node
,Çode);

205 
i
 = 0; i < 
rbnode
->
blkÀn
; ++i) {

206 
ªgtmp
 = 
rbnode
->
ba£_ªg
 + 
i
;

207 
vÆ
 = 
	`¢d_soc_rbåì_gë_ªgi°î
(
rbnode
, 
i
);

208 
def
 = 
	`¢d_soc_gë_ˇche_vÆ
(
codec
->
ªg_def_c›y
, 
i
,

209 
rbnode
->
w‹d_size
);

210 i‡(
vÆ
 =
def
)

213 
	`WARN_ON
(!
	`¢d_soc_codec_wrôabÀ_ªgi°î
(
codec
, 
ªgtmp
));

215 
codec
->
ˇche_by∑ss
 = 1;

216 
ªt
 = 
	`¢d_soc_wrôe
(
codec
, 
ªgtmp
, 
vÆ
);

217 
codec
->
ˇche_by∑ss
 = 0;

218 i‡(
ªt
)

219  
ªt
;

220 
	`dev_dbg
(
codec
->
dev
, "SyncedÑegister %#x, value = %#x\n",

221 
ªgtmp
, 
vÆ
);

226 
	}
}

228 
	$¢d_soc_rbåì_ö£π_to_block
(
¢d_soc_rbåì_node
 *
rbnode
,

229 
pos
, 
ªg
,

230 
vÆue
)

232 
u8
 *
blk
;

234 
blk
 = 
	`kªÆloc
(
rbnode
->
block
,

235 (
rbnode
->
blkÀn
 + 1Ë*Ñbnode->
w‹d_size
, 
GFP_KERNEL
);

236 i‡(!
blk
)

237  -
ENOMEM
;

240 
	`memmove
(
blk
 + (
pos
 + 1Ë* 
rbnode
->
w‹d_size
,

241 
blk
 + 
pos
 * 
rbnode
->
w‹d_size
,

242 (
rbnode
->
blkÀn
 - 
pos
Ë*Ñbnode->
w‹d_size
);

245 
rbnode
->
block
 = 
blk
;

246 
rbnode
->
blkÀn
++;

247 i‡(!
pos
)

248 
rbnode
->
ba£_ªg
 = 
ªg
;

250 
	`¢d_soc_rbåì_£t_ªgi°î
(
rbnode
, 
pos
, 
vÆue
);

252 
	}
}

254 
	$¢d_soc_rbåì_ˇche_wrôe
(
¢d_soc_codec
 *
codec
,

255 
ªg
, 
vÆue
)

257 
¢d_soc_rbåì_˘x
 *
rbåì_˘x
;

258 
¢d_soc_rbåì_node
 *
rbnode
, *
rbnode_tmp
;

259 
rb_node
 *
node
;

260 
vÆ
;

261 
ªg_tmp
;

262 
ba£_ªg
, 
t›_ªg
;

263 
pos
;

264 
i
;

265 
ªt
;

267 
rbåì_˘x
 = 
codec
->
ªg_ˇche
;

269 
rbnode
 = 
rbåì_˘x
->
ˇched_rbnode
;

270 i‡(
rbnode
) {

271 
	`¢d_soc_rbåì_gë_ba£_t›_ªg
(
rbnode
, &
ba£_ªg
, &
t›_ªg
);

272 i‡(
ªg
 >
ba£_ªg
 &&Ñeg <
t›_ªg
) {

273 
ªg_tmp
 = 
ªg
 - 
ba£_ªg
;

274 
vÆ
 = 
	`¢d_soc_rbåì_gë_ªgi°î
(
rbnode
, 
ªg_tmp
);

275 i‡(
vÆ
 =
vÆue
)

277 
	`¢d_soc_rbåì_£t_ªgi°î
(
rbnode
, 
ªg_tmp
, 
vÆue
);

284 
rbnode
 = 
	`¢d_soc_rbåì_lookup
(&
rbåì_˘x
->
roŸ
, 
ªg
);

285 i‡(
rbnode
) {

286 
ªg_tmp
 = 
ªg
 - 
rbnode
->
ba£_ªg
;

287 
vÆ
 = 
	`¢d_soc_rbåì_gë_ªgi°î
(
rbnode
, 
ªg_tmp
);

288 i‡(
vÆ
 =
vÆue
)

290 
	`¢d_soc_rbåì_£t_ªgi°î
(
rbnode
, 
ªg_tmp
, 
vÆue
);

291 
rbåì_˘x
->
ˇched_rbnode
 = 
rbnode
;

294 i‡(!
vÆue
)

297 
node
 = 
	`rb_fú°
(&
rbåì_˘x
->
roŸ
);Çode;

298 
node
 = 
	`rb_√xt
(node)) {

299 
rbnode_tmp
 = 
	`rb_íåy
(
node
, 
¢d_soc_rbåì_node
,Çode);

300 
i
 = 0; i < 
rbnode_tmp
->
blkÀn
; ++i) {

301 
ªg_tmp
 = 
rbnode_tmp
->
ba£_ªg
 + 
i
;

302 i‡(
	`abs
(
ªg_tmp
 - 
ªg
) != 1)

305 i‡(
ªg_tmp
 + 1 =
ªg
)

306 
pos
 = 
i
 + 1;

308 
pos
 = 
i
;

309 
ªt
 = 
	`¢d_soc_rbåì_ö£π_to_block
(
rbnode_tmp
, 
pos
,

310 
ªg
, 
vÆue
);

311 i‡(
ªt
)

312  
ªt
;

313 
rbåì_˘x
->
ˇched_rbnode
 = 
rbnode_tmp
;

322 
rbnode
 = 
	`kzÆloc
( *rbnode, 
GFP_KERNEL
);

323 i‡(!
rbnode
)

324  -
ENOMEM
;

325 
rbnode
->
blkÀn
 = 1;

326 
rbnode
->
ba£_ªg
 = 
ªg
;

327 
rbnode
->
w‹d_size
 = 
codec
->
drivî
->
ªg_w‹d_size
;

328 
rbnode
->
block
 = 
	`kmÆloc
‘bnode->
blkÀn
 *Ñbnode->
w‹d_size
,

329 
GFP_KERNEL
);

330 i‡(!
rbnode
->
block
) {

331 
	`k‰ì
(
rbnode
);

332  -
ENOMEM
;

334 
	`¢d_soc_rbåì_£t_ªgi°î
(
rbnode
, 0, 
vÆue
);

335 
	`¢d_soc_rbåì_ö£π
(&
rbåì_˘x
->
roŸ
, 
rbnode
);

336 
rbåì_˘x
->
ˇched_rbnode
 = 
rbnode
;

340 
	}
}

342 
	$¢d_soc_rbåì_ˇche_ªad
(
¢d_soc_codec
 *
codec
,

343 
ªg
, *
vÆue
)

345 
¢d_soc_rbåì_˘x
 *
rbåì_˘x
;

346 
¢d_soc_rbåì_node
 *
rbnode
;

347 
ba£_ªg
, 
t›_ªg
;

348 
ªg_tmp
;

350 
rbåì_˘x
 = 
codec
->
ªg_ˇche
;

352 
rbnode
 = 
rbåì_˘x
->
ˇched_rbnode
;

353 i‡(
rbnode
) {

354 
	`¢d_soc_rbåì_gë_ba£_t›_ªg
(
rbnode
, &
ba£_ªg
, &
t›_ªg
);

355 i‡(
ªg
 >
ba£_ªg
 &&Ñeg <
t›_ªg
) {

356 
ªg_tmp
 = 
ªg
 - 
ba£_ªg
;

357 *
vÆue
 = 
	`¢d_soc_rbåì_gë_ªgi°î
(
rbnode
, 
ªg_tmp
);

364 
rbnode
 = 
	`¢d_soc_rbåì_lookup
(&
rbåì_˘x
->
roŸ
, 
ªg
);

365 i‡(
rbnode
) {

366 
ªg_tmp
 = 
ªg
 - 
rbnode
->
ba£_ªg
;

367 *
vÆue
 = 
	`¢d_soc_rbåì_gë_ªgi°î
(
rbnode
, 
ªg_tmp
);

368 
rbåì_˘x
->
ˇched_rbnode
 = 
rbnode
;

371 *
vÆue
 = 0;

375 
	}
}

377 
	$¢d_soc_rbåì_ˇche_exô
(
¢d_soc_codec
 *
codec
)

379 
rb_node
 *
√xt
;

380 
¢d_soc_rbåì_˘x
 *
rbåì_˘x
;

381 
¢d_soc_rbåì_node
 *
rbåì_node
;

384 
rbåì_˘x
 = 
codec
->
ªg_ˇche
;

385 i‡(!
rbåì_˘x
)

389 
√xt
 = 
	`rb_fú°
(&
rbåì_˘x
->
roŸ
);

390 
√xt
) {

391 
rbåì_node
 = 
	`rb_íåy
(
√xt
, 
¢d_soc_rbåì_node
, 
node
);

392 
√xt
 = 
	`rb_√xt
(&
rbåì_node
->
node
);

393 
	`rb_îa£
(&
rbåì_node
->
node
, &
rbåì_˘x
->
roŸ
);

394 
	`k‰ì
(
rbåì_node
->
block
);

395 
	`k‰ì
(
rbåì_node
);

399 
	`k‰ì
(
codec
->
ªg_ˇche
);

400 
codec
->
ªg_ˇche
 = 
NULL
;

403 
	}
}

405 
	$¢d_soc_rbåì_ˇche_öô
(
¢d_soc_codec
 *
codec
)

407 
¢d_soc_rbåì_˘x
 *
rbåì_˘x
;

408 
w‹d_size
;

409 
vÆ
;

410 
i
;

411 
ªt
;

413 
codec
->
ªg_ˇche
 = 
	`kmÆloc
( *
rbåì_˘x
, 
GFP_KERNEL
);

414 i‡(!
codec
->
ªg_ˇche
)

415  -
ENOMEM
;

417 
rbåì_˘x
 = 
codec
->
ªg_ˇche
;

418 
rbåì_˘x
->
roŸ
 = 
RB_ROOT
;

419 
rbåì_˘x
->
ˇched_rbnode
 = 
NULL
;

421 i‡(!
codec
->
ªg_def_c›y
)

424 
w‹d_size
 = 
codec
->
drivî
->
ªg_w‹d_size
;

425 
i
 = 0; i < 
codec
->
drivî
->
ªg_ˇche_size
; ++i) {

426 
vÆ
 = 
	`¢d_soc_gë_ˇche_vÆ
(
codec
->
ªg_def_c›y
, 
i
,

427 
w‹d_size
);

428 i‡(!
vÆ
)

430 
ªt
 = 
	`¢d_soc_rbåì_ˇche_wrôe
(
codec
, 
i
, 
vÆ
);

431 i‡(
ªt
)

432 
îr
;

437 
îr
:

438 
	`¢d_soc_ˇche_exô
(
codec
);

439  
ªt
;

440 
	}
}

442 #ifde‡
CONFIG_SND_SOC_CACHE_LZO


443 
	s¢d_soc_lzo_˘x
 {

444 *
	mwmem
;

445 *
	md°
;

446 c⁄° *
	m§c
;

447 
size_t
 
	m§c_Àn
;

448 
size_t
 
	md°_Àn
;

449 
size_t
 
	mdecom¥es£d_size
;

450 *
	msync_bmp
;

451 
	msync_bmp_nbôs
;

454 
	#LZO_BLOCK_NUM
 8

	)

455 
	$¢d_soc_lzo_block_cou¡
()

457  
LZO_BLOCK_NUM
;

458 
	}
}

460 
	$¢d_soc_lzo_¥ï¨e
(
¢d_soc_lzo_˘x
 *
lzo_˘x
)

462 
lzo_˘x
->
wmem
 = 
	`kmÆloc
(
LZO1X_MEM_COMPRESS
, 
GFP_KERNEL
);

463 i‡(!
lzo_˘x
->
wmem
)

464  -
ENOMEM
;

466 
	}
}

468 
	$¢d_soc_lzo_com¥ess
(
¢d_soc_lzo_˘x
 *
lzo_˘x
)

470 
size_t
 
com¥ess_size
;

471 
ªt
;

473 
ªt
 = 
	`lzo1x_1_com¥ess
(
lzo_˘x
->
§c
,Üzo_˘x->
§c_Àn
,

474 
lzo_˘x
->
d°
, &
com¥ess_size
,Üzo_˘x->
wmem
);

475 i‡(
ªt
 !
LZO_E_OK
 || 
com¥ess_size
 > 
lzo_˘x
->
d°_Àn
)

476  -
EINVAL
;

477 
lzo_˘x
->
d°_Àn
 = 
com¥ess_size
;

479 
	}
}

481 
	$¢d_soc_lzo_decom¥ess
(
¢d_soc_lzo_˘x
 *
lzo_˘x
)

483 
size_t
 
d°_Àn
;

484 
ªt
;

486 
d°_Àn
 = 
lzo_˘x
->dst_len;

487 
ªt
 = 
	`lzo1x_decom¥ess_ß„
(
lzo_˘x
->
§c
,Üzo_˘x->
§c_Àn
,

488 
lzo_˘x
->
d°
, &
d°_Àn
);

489 i‡(
ªt
 !
LZO_E_OK
 || 
d°_Àn
 !
lzo_˘x
->dst_len)

490  -
EINVAL
;

492 
	}
}

494 
	$¢d_soc_lzo_com¥ess_ˇche_block
(
¢d_soc_codec
 *
codec
,

495 
¢d_soc_lzo_˘x
 *
lzo_˘x
)

497 
ªt
;

499 
lzo_˘x
->
d°_Àn
 = 
	`lzo1x_w‹°_com¥ess
(
PAGE_SIZE
);

500 
lzo_˘x
->
d°
 = 
	`kmÆloc
÷zo_˘x->
d°_Àn
, 
GFP_KERNEL
);

501 i‡(!
lzo_˘x
->
d°
) {

502 
lzo_˘x
->
d°_Àn
 = 0;

503  -
ENOMEM
;

506 
ªt
 = 
	`¢d_soc_lzo_com¥ess
(
lzo_˘x
);

507 i‡(
ªt
 < 0)

508  
ªt
;

510 
	}
}

512 
	$¢d_soc_lzo_decom¥ess_ˇche_block
(
¢d_soc_codec
 *
codec
,

513 
¢d_soc_lzo_˘x
 *
lzo_˘x
)

515 
ªt
;

517 
lzo_˘x
->
d°_Àn
 =Üzo_˘x->
decom¥es£d_size
;

518 
lzo_˘x
->
d°
 = 
	`kmÆloc
÷zo_˘x->
d°_Àn
, 
GFP_KERNEL
);

519 i‡(!
lzo_˘x
->
d°
) {

520 
lzo_˘x
->
d°_Àn
 = 0;

521  -
ENOMEM
;

524 
ªt
 = 
	`¢d_soc_lzo_decom¥ess
(
lzo_˘x
);

525 i‡(
ªt
 < 0)

526  
ªt
;

528 
	}
}

530 
ölöe
 
	$¢d_soc_lzo_gë_blködex
(
¢d_soc_codec
 *
codec
,

531 
ªg
)

533 c⁄° 
¢d_soc_codec_drivî
 *
codec_drv
;

535 
codec_drv
 = 
codec
->
drivî
;

536  (
ªg
 * 
codec_drv
->
ªg_w‹d_size
) /

537 
	`DIV_ROUND_UP
(
codec
->
ªg_size
, 
	`¢d_soc_lzo_block_cou¡
());

538 
	}
}

540 
ölöe
 
	$¢d_soc_lzo_gë_blkpos
(
¢d_soc_codec
 *
codec
,

541 
ªg
)

543 c⁄° 
¢d_soc_codec_drivî
 *
codec_drv
;

545 
codec_drv
 = 
codec
->
drivî
;

546  
ªg
 % (
	`DIV_ROUND_UP
(
codec
->
ªg_size
, 
	`¢d_soc_lzo_block_cou¡
()) /

547 
codec_drv
->
ªg_w‹d_size
);

548 
	}
}

550 
ölöe
 
	$¢d_soc_lzo_gë_blksize
(
¢d_soc_codec
 *
codec
)

552  
	`DIV_ROUND_UP
(
codec
->
ªg_size
, 
	`¢d_soc_lzo_block_cou¡
());

553 
	}
}

555 
	$¢d_soc_lzo_ˇche_sync
(
¢d_soc_codec
 *
codec
)

557 
¢d_soc_lzo_˘x
 **
lzo_blocks
;

558 
vÆ
;

559 
i
;

560 
ªt
;

562 
lzo_blocks
 = 
codec
->
ªg_ˇche
;

563 
	`f‹_óch_£t_bô
(
i
, 
lzo_blocks
[0]->
sync_bmp
,Üzo_blocks[0]->
sync_bmp_nbôs
) {

564 
	`WARN_ON
(!
	`¢d_soc_codec_wrôabÀ_ªgi°î
(
codec
, 
i
));

565 
ªt
 = 
	`¢d_soc_ˇche_ªad
(
codec
, 
i
, &
vÆ
);

566 i‡(
ªt
)

567  
ªt
;

568 
codec
->
ˇche_by∑ss
 = 1;

569 
ªt
 = 
	`¢d_soc_wrôe
(
codec
, 
i
, 
vÆ
);

570 
codec
->
ˇche_by∑ss
 = 0;

571 i‡(
ªt
)

572  
ªt
;

573 
	`dev_dbg
(
codec
->
dev
, "SyncedÑegister %#x, value = %#x\n",

574 
i
, 
vÆ
);

578 
	}
}

580 
	$¢d_soc_lzo_ˇche_wrôe
(
¢d_soc_codec
 *
codec
,

581 
ªg
, 
vÆue
)

583 
¢d_soc_lzo_˘x
 *
lzo_block
, **
lzo_blocks
;

584 
ªt
, 
blködex
, 
blkpos
;

585 
size_t
 
blksize
, 
tmp_d°_Àn
;

586 *
tmp_d°
;

589 
blködex
 = 
	`¢d_soc_lzo_gë_blködex
(
codec
, 
ªg
);

591 
blkpos
 = 
	`¢d_soc_lzo_gë_blkpos
(
codec
, 
ªg
);

593 
blksize
 = 
	`¢d_soc_lzo_gë_blksize
(
codec
);

594 
lzo_blocks
 = 
codec
->
ªg_ˇche
;

595 
lzo_block
 = 
lzo_blocks
[
blködex
];

598 
tmp_d°
 = 
lzo_block
->
d°
;

599 
tmp_d°_Àn
 = 
lzo_block
->
d°_Àn
;

602 
lzo_block
->
§c
 =Üzo_block->
d°
;

603 
lzo_block
->
§c_Àn
 =Üzo_block->
d°_Àn
;

606 
ªt
 = 
	`¢d_soc_lzo_decom¥ess_ˇche_block
(
codec
, 
lzo_block
);

607 i‡(
ªt
 < 0) {

608 
	`k‰ì
(
lzo_block
->
d°
);

609 
out
;

613 i‡(
	`¢d_soc_£t_ˇche_vÆ
(
lzo_block
->
d°
, 
blkpos
, 
vÆue
,

614 
codec
->
drivî
->
ªg_w‹d_size
)) {

615 
	`k‰ì
(
lzo_block
->
d°
);

616 
out
;

620 
lzo_block
->
§c
 =Üzo_block->
d°
;

621 
lzo_block
->
§c_Àn
 =Üzo_block->
d°_Àn
;

624 
ªt
 = 
	`¢d_soc_lzo_com¥ess_ˇche_block
(
codec
, 
lzo_block
);

625 i‡(
ªt
 < 0) {

626 
	`k‰ì
(
lzo_block
->
d°
);

627 
	`k‰ì
(
lzo_block
->
§c
);

628 
out
;

632 
	`£t_bô
(
ªg
, 
lzo_block
->
sync_bmp
);

633 
	`k‰ì
(
tmp_d°
);

634 
	`k‰ì
(
lzo_block
->
§c
);

636 
out
:

637 
lzo_block
->
d°
 = 
tmp_d°
;

638 
lzo_block
->
d°_Àn
 = 
tmp_d°_Àn
;

639  
ªt
;

640 
	}
}

642 
	$¢d_soc_lzo_ˇche_ªad
(
¢d_soc_codec
 *
codec
,

643 
ªg
, *
vÆue
)

645 
¢d_soc_lzo_˘x
 *
lzo_block
, **
lzo_blocks
;

646 
ªt
, 
blködex
, 
blkpos
;

647 
size_t
 
blksize
, 
tmp_d°_Àn
;

648 *
tmp_d°
;

650 *
vÆue
 = 0;

652 
blködex
 = 
	`¢d_soc_lzo_gë_blködex
(
codec
, 
ªg
);

654 
blkpos
 = 
	`¢d_soc_lzo_gë_blkpos
(
codec
, 
ªg
);

656 
blksize
 = 
	`¢d_soc_lzo_gë_blksize
(
codec
);

657 
lzo_blocks
 = 
codec
->
ªg_ˇche
;

658 
lzo_block
 = 
lzo_blocks
[
blködex
];

661 
tmp_d°
 = 
lzo_block
->
d°
;

662 
tmp_d°_Àn
 = 
lzo_block
->
d°_Àn
;

665 
lzo_block
->
§c
 =Üzo_block->
d°
;

666 
lzo_block
->
§c_Àn
 =Üzo_block->
d°_Àn
;

669 
ªt
 = 
	`¢d_soc_lzo_decom¥ess_ˇche_block
(
codec
, 
lzo_block
);

670 i‡(
ªt
 >= 0)

672 *
vÆue
 = 
	`¢d_soc_gë_ˇche_vÆ
(
lzo_block
->
d°
, 
blkpos
,

673 
codec
->
drivî
->
ªg_w‹d_size
);

675 
	`k‰ì
(
lzo_block
->
d°
);

677 
lzo_block
->
d°
 = 
tmp_d°
;

678 
lzo_block
->
d°_Àn
 = 
tmp_d°_Àn
;

680 
	}
}

682 
	$¢d_soc_lzo_ˇche_exô
(
¢d_soc_codec
 *
codec
)

684 
¢d_soc_lzo_˘x
 **
lzo_blocks
;

685 
i
, 
blkcou¡
;

687 
lzo_blocks
 = 
codec
->
ªg_ˇche
;

688 i‡(!
lzo_blocks
)

691 
blkcou¡
 = 
	`¢d_soc_lzo_block_cou¡
();

697 i‡(
lzo_blocks
[0])

698 
	`k‰ì
(
lzo_blocks
[0]->
sync_bmp
);

699 
i
 = 0; i < 
blkcou¡
; ++i) {

700 i‡(
lzo_blocks
[
i
]) {

701 
	`k‰ì
(
lzo_blocks
[
i
]->
wmem
);

702 
	`k‰ì
(
lzo_blocks
[
i
]->
d°
);

705 
	`k‰ì
(
lzo_blocks
[
i
]);

707 
	`k‰ì
(
lzo_blocks
);

708 
codec
->
ªg_ˇche
 = 
NULL
;

710 
	}
}

712 
	$¢d_soc_lzo_ˇche_öô
(
¢d_soc_codec
 *
codec
)

714 
¢d_soc_lzo_˘x
 **
lzo_blocks
;

715 
size_t
 
bmp_size
;

716 c⁄° 
¢d_soc_codec_drivî
 *
codec_drv
;

717 
ªt
, 
to‰ì
, 
i
, 
blksize
, 
blkcou¡
;

718 c⁄° *
p
, *
íd
;

719 *
sync_bmp
;

721 
ªt
 = 0;

722 
codec_drv
 = 
codec
->
drivî
;

729 
to‰ì
 = 0;

730 i‡(!
codec
->
ªg_def_c›y
)

731 
to‰ì
 = 1;

733 i‡(!
codec
->
ªg_def_c›y
) {

734 
codec
->
ªg_def_c›y
 = 
	`kzÆloc
(codec->
ªg_size
, 
GFP_KERNEL
);

735 i‡(!
codec
->
ªg_def_c›y
)

736  -
ENOMEM
;

739 
blkcou¡
 = 
	`¢d_soc_lzo_block_cou¡
();

740 
codec
->
ªg_ˇche
 = 
	`kzÆloc
(
blkcou¡
 *  *
lzo_blocks
,

741 
GFP_KERNEL
);

742 i‡(!
codec
->
ªg_ˇche
) {

743 
ªt
 = -
ENOMEM
;

744 
îr_to‰ì
;

746 
lzo_blocks
 = 
codec
->
ªg_ˇche
;

754 
bmp_size
 = 
codec_drv
->
ªg_ˇche_size
;

755 
sync_bmp
 = 
	`kmÆloc
(
	`BITS_TO_LONGS
(
bmp_size
) * (),

756 
GFP_KERNEL
);

757 i‡(!
sync_bmp
) {

758 
ªt
 = -
ENOMEM
;

759 
îr
;

761 
	`bôm≠_zîo
(
sync_bmp
, 
bmp_size
);

764 
i
 = 0; i < 
blkcou¡
; ++i) {

765 
lzo_blocks
[
i
] = 
	`kzÆloc
( **lzo_blocks,

766 
GFP_KERNEL
);

767 i‡(!
lzo_blocks
[
i
]) {

768 
	`k‰ì
(
sync_bmp
);

769 
ªt
 = -
ENOMEM
;

770 
îr
;

772 
lzo_blocks
[
i
]->
sync_bmp
 = sync_bmp;

773 
lzo_blocks
[
i
]->
sync_bmp_nbôs
 = 
bmp_size
;

775 
ªt
 = 
	`¢d_soc_lzo_¥ï¨e
(
lzo_blocks
[
i
]);

776 i‡(
ªt
 < 0)

777 
îr
;

780 
blksize
 = 
	`¢d_soc_lzo_gë_blksize
(
codec
);

781 
p
 = 
codec
->
ªg_def_c›y
;

782 
íd
 = 
codec
->
ªg_def_c›y
 + codec->
ªg_size
;

784 
i
 = 0; i < 
blkcou¡
; ++i, 
p
 +
blksize
) {

785 
lzo_blocks
[
i
]->
§c
 = 
p
;

786 i‡(
p
 + 
blksize
 > 
íd
)

787 
lzo_blocks
[
i
]->
§c_Àn
 = 
íd
 - 
p
;

789 
lzo_blocks
[
i
]->
§c_Àn
 = 
blksize
;

790 
ªt
 = 
	`¢d_soc_lzo_com¥ess_ˇche_block
(
codec
,

791 
lzo_blocks
[
i
]);

792 i‡(
ªt
 < 0)

793 
îr
;

794 
lzo_blocks
[
i
]->
decom¥es£d_size
 =

795 
lzo_blocks
[
i
]->
§c_Àn
;

798 i‡(
to‰ì
) {

799 
	`k‰ì
(
codec
->
ªg_def_c›y
);

800 
codec
->
ªg_def_c›y
 = 
NULL
;

803 
îr
:

804 
	`¢d_soc_ˇche_exô
(
codec
);

805 
îr_to‰ì
:

806 i‡(
to‰ì
) {

807 
	`k‰ì
(
codec
->
ªg_def_c›y
);

808 
codec
->
ªg_def_c›y
 = 
NULL
;

810  
ªt
;

811 
	}
}

814 
	$¢d_soc_Ê©_ˇche_sync
(
¢d_soc_codec
 *
codec
)

816 
i
;

817 
ªt
;

818 c⁄° 
¢d_soc_codec_drivî
 *
codec_drv
;

819 
vÆ
;

821 
codec_drv
 = 
codec
->
drivî
;

822 
i
 = 0; i < 
codec_drv
->
ªg_ˇche_size
; ++i) {

823 
ªt
 = 
	`¢d_soc_ˇche_ªad
(
codec
, 
i
, &
vÆ
);

824 i‡(
ªt
)

825  
ªt
;

826 i‡(
codec
->
ªg_def_c›y
)

827 i‡(
	`¢d_soc_gë_ˇche_vÆ
(
codec
->
ªg_def_c›y
,

828 
i
, 
codec_drv
->
ªg_w‹d_size
Ë=
vÆ
)

831 
	`WARN_ON
(!
	`¢d_soc_codec_wrôabÀ_ªgi°î
(
codec
, 
i
));

833 
ªt
 = 
	`¢d_soc_wrôe
(
codec
, 
i
, 
vÆ
);

834 i‡(
ªt
)

835  
ªt
;

836 
	`dev_dbg
(
codec
->
dev
, "SyncedÑegister %#x, value = %#x\n",

837 
i
, 
vÆ
);

840 
	}
}

842 
	$¢d_soc_Ê©_ˇche_wrôe
(
¢d_soc_codec
 *
codec
,

843 
ªg
, 
vÆue
)

845 
	`¢d_soc_£t_ˇche_vÆ
(
codec
->
ªg_ˇche
, 
ªg
, 
vÆue
,

846 
codec
->
drivî
->
ªg_w‹d_size
);

848 
	}
}

850 
	$¢d_soc_Ê©_ˇche_ªad
(
¢d_soc_codec
 *
codec
,

851 
ªg
, *
vÆue
)

853 *
vÆue
 = 
	`¢d_soc_gë_ˇche_vÆ
(
codec
->
ªg_ˇche
, 
ªg
,

854 
codec
->
drivî
->
ªg_w‹d_size
);

856 
	}
}

858 
	$¢d_soc_Ê©_ˇche_exô
(
¢d_soc_codec
 *
codec
)

860 i‡(!
codec
->
ªg_ˇche
)

862 
	`k‰ì
(
codec
->
ªg_ˇche
);

863 
codec
->
ªg_ˇche
 = 
NULL
;

865 
	}
}

867 
	$¢d_soc_Ê©_ˇche_öô
(
¢d_soc_codec
 *
codec
)

869 i‡(
codec
->
ªg_def_c›y
)

870 
codec
->
ªg_ˇche
 = 
	`kmemdup
(codec->
ªg_def_c›y
,

871 
codec
->
ªg_size
, 
GFP_KERNEL
);

873 
codec
->
ªg_ˇche
 = 
	`kzÆloc
(codec->
ªg_size
, 
GFP_KERNEL
);

874 i‡(!
codec
->
ªg_ˇche
)

875  -
ENOMEM
;

878 
	}
}

881 c⁄° 
¢d_soc_ˇche_›s
 
	gˇche_ty≥s
[] = {

884 .
id
 = 
SND_SOC_FLAT_COMPRESSION
,

885 .
	g«me
 = "flat",

886 .
	göô
 = 
¢d_soc_Ê©_ˇche_öô
,

887 .
	gexô
 = 
¢d_soc_Ê©_ˇche_exô
,

888 .
	gªad
 = 
¢d_soc_Ê©_ˇche_ªad
,

889 .
	gwrôe
 = 
¢d_soc_Ê©_ˇche_wrôe
,

890 .
	gsync
 = 
¢d_soc_Ê©_ˇche_sync


892 #ifde‡
CONFIG_SND_SOC_CACHE_LZO


894 .
	gid
 = 
SND_SOC_LZO_COMPRESSION
,

895 .
	g«me
 = "LZO",

896 .
	göô
 = 
¢d_soc_lzo_ˇche_öô
,

897 .
	gexô
 = 
¢d_soc_lzo_ˇche_exô
,

898 .
	gªad
 = 
¢d_soc_lzo_ˇche_ªad
,

899 .
	gwrôe
 = 
¢d_soc_lzo_ˇche_wrôe
,

900 .
	gsync
 = 
¢d_soc_lzo_ˇche_sync


904 .
	gid
 = 
SND_SOC_RBTREE_COMPRESSION
,

905 .
	g«me
 = "rbtree",

906 .
	göô
 = 
¢d_soc_rbåì_ˇche_öô
,

907 .
	gexô
 = 
¢d_soc_rbåì_ˇche_exô
,

908 .
	gªad
 = 
¢d_soc_rbåì_ˇche_ªad
,

909 .
	gwrôe
 = 
¢d_soc_rbåì_ˇche_wrôe
,

910 .
	gsync
 = 
¢d_soc_rbåì_ˇche_sync


914 
	$¢d_soc_ˇche_öô
(
¢d_soc_codec
 *
codec
)

916 
i
;

918 
i
 = 0; i < 
	`ARRAY_SIZE
(
ˇche_ty≥s
); ++i)

919 i‡(
ˇche_ty≥s
[
i
].
id
 =
codec
->
com¥ess_ty≥
)

923 i‡(
i
 =
	`ARRAY_SIZE
(
ˇche_ty≥s
)) {

924 
	`dev_w¨n
(
codec
->
dev
, "CouldÇot match compressÅype: %d\n",

925 
codec
->
com¥ess_ty≥
);

926 
i
 = 0;

929 
	`muãx_öô
(&
codec
->
ˇche_rw_muãx
);

930 
codec
->
ˇche_›s
 = &
ˇche_ty≥s
[
i
];

932 i‡(
codec
->
ˇche_›s
->
öô
) {

933 i‡(
codec
->
ˇche_›s
->
«me
)

934 
	`dev_dbg
(
codec
->
dev
, "Initializing %s cache for %s codec\n",

935 
codec
->
ˇche_›s
->
«me
, codec->name);

936  
codec
->
ˇche_›s
->
	`öô
(codec);

938  -
ENOSYS
;

939 
	}
}

945 
	$¢d_soc_ˇche_exô
(
¢d_soc_codec
 *
codec
)

947 i‡(
codec
->
ˇche_›s
 && codec->ˇche_›s->
exô
) {

948 i‡(
codec
->
ˇche_›s
->
«me
)

949 
	`dev_dbg
(
codec
->
dev
, "Destroying %s cache for %s codec\n",

950 
codec
->
ˇche_›s
->
«me
, codec->name);

951  
codec
->
ˇche_›s
->
	`exô
(codec);

953  -
ENOSYS
;

954 
	}
}

963 
	$¢d_soc_ˇche_ªad
(
¢d_soc_codec
 *
codec
,

964 
ªg
, *
vÆue
)

966 
ªt
;

968 
	`muãx_lock
(&
codec
->
ˇche_rw_muãx
);

970 i‡(
vÆue
 && 
codec
->
ˇche_›s
 && codec->ˇche_›s->
ªad
) {

971 
ªt
 = 
codec
->
ˇche_›s
->
	`ªad
(codec, 
ªg
, 
vÆue
);

972 
	`muãx_u∆ock
(&
codec
->
ˇche_rw_muãx
);

973  
ªt
;

976 
	`muãx_u∆ock
(&
codec
->
ˇche_rw_muãx
);

977  -
ENOSYS
;

978 
	}
}

979 
EXPORT_SYMBOL_GPL
(
¢d_soc_ˇche_ªad
);

988 
	$¢d_soc_ˇche_wrôe
(
¢d_soc_codec
 *
codec
,

989 
ªg
, 
vÆue
)

991 
ªt
;

993 
	`muãx_lock
(&
codec
->
ˇche_rw_muãx
);

995 i‡(
codec
->
ˇche_›s
 && codec->ˇche_›s->
wrôe
) {

996 
ªt
 = 
codec
->
ˇche_›s
->
	`wrôe
(codec, 
ªg
, 
vÆue
);

997 
	`muãx_u∆ock
(&
codec
->
ˇche_rw_muãx
);

998  
ªt
;

1001 
	`muãx_u∆ock
(&
codec
->
ˇche_rw_muãx
);

1002  -
ENOSYS
;

1003 
	}
}

1004 
EXPORT_SYMBOL_GPL
(
¢d_soc_ˇche_wrôe
);

1015 
	$¢d_soc_ˇche_sync
(
¢d_soc_codec
 *
codec
)

1017 
ªt
;

1018 c⁄° *
«me
;

1020 i‡(!
codec
->
ˇche_sync
) {

1024 i‡(!
codec
->
ˇche_›s
 || !codec->ˇche_›s->
sync
)

1025  -
ENOSYS
;

1027 i‡(
codec
->
ˇche_›s
->
«me
)

1028 
«me
 = 
codec
->
ˇche_›s
->name;

1030 
«me
 = "unknown";

1032 i‡(
codec
->
ˇche_›s
->
«me
)

1033 
	`dev_dbg
(
codec
->
dev
, "Syncing %s cache for %s codec\n",

1034 
codec
->
ˇche_›s
->
«me
, codec->name);

1035 
	`åa˚_¢d_soc_ˇche_sync
(
codec
, 
«me
, "start");

1036 
ªt
 = 
codec
->
ˇche_›s
->
	`sync
(codec);

1037 i‡(!
ªt
)

1038 
codec
->
ˇche_sync
 = 0;

1039 
	`åa˚_¢d_soc_ˇche_sync
(
codec
, 
«me
, "end");

1040  
ªt
;

1041 
	}
}

1042 
EXPORT_SYMBOL_GPL
(
¢d_soc_ˇche_sync
);

1044 
	$¢d_soc_gë_ªg_ac˚ss_ödex
(
¢d_soc_codec
 *
codec
,

1045 
ªg
)

1047 c⁄° 
¢d_soc_codec_drivî
 *
codec_drv
;

1048 
mö
, 
max
, 
ödex
;

1050 
codec_drv
 = 
codec
->
drivî
;

1051 
mö
 = 0;

1052 
max
 = 
codec_drv
->
ªg_ac˚ss_size
 - 1;

1054 
ödex
 = (
mö
 + 
max
) / 2;

1055 i‡(
codec_drv
->
ªg_ac˚ss_deÁu…
[
ödex
].
ªg
 ==Ñeg)

1056  
ödex
;

1057 i‡(
codec_drv
->
ªg_ac˚ss_deÁu…
[
ödex
].
ªg
 <Ñeg)

1058 
mö
 = 
ödex
 + 1;

1060 
max
 = 
ödex
;

1061 } 
mö
 <
max
);

1063 
	}
}

1065 
	$¢d_soc_deÁu…_vﬁ©ûe_ªgi°î
(
¢d_soc_codec
 *
codec
,

1066 
ªg
)

1068 
ödex
;

1070 i‡(
ªg
 >
codec
->
drivî
->
ªg_ˇche_size
)

1072 
ödex
 = 
	`¢d_soc_gë_ªg_ac˚ss_ödex
(
codec
, 
ªg
);

1073 i‡(
ödex
 < 0)

1075  
codec
->
drivî
->
ªg_ac˚ss_deÁu…
[
ödex
].
vﬁ
;

1076 
	}
}

1077 
EXPORT_SYMBOL_GPL
(
¢d_soc_deÁu…_vﬁ©ûe_ªgi°î
);

1079 
	$¢d_soc_deÁu…_ªadabÀ_ªgi°î
(
¢d_soc_codec
 *
codec
,

1080 
ªg
)

1082 
ödex
;

1084 i‡(
ªg
 >
codec
->
drivî
->
ªg_ˇche_size
)

1086 
ödex
 = 
	`¢d_soc_gë_ªg_ac˚ss_ödex
(
codec
, 
ªg
);

1087 i‡(
ödex
 < 0)

1089  
codec
->
drivî
->
ªg_ac˚ss_deÁu…
[
ödex
].
ªad
;

1090 
	}
}

1091 
EXPORT_SYMBOL_GPL
(
¢d_soc_deÁu…_ªadabÀ_ªgi°î
);

1093 
	$¢d_soc_deÁu…_wrôabÀ_ªgi°î
(
¢d_soc_codec
 *
codec
,

1094 
ªg
)

1096 
ödex
;

1098 i‡(
ªg
 >
codec
->
drivî
->
ªg_ˇche_size
)

1100 
ödex
 = 
	`¢d_soc_gë_ªg_ac˚ss_ödex
(
codec
, 
ªg
);

1101 i‡(
ödex
 < 0)

1103  
codec
->
drivî
->
ªg_ac˚ss_deÁu…
[
ödex
].
wrôe
;

1104 
	}
}

1105 
EXPORT_SYMBOL_GPL
(
¢d_soc_deÁu…_wrôabÀ_ªgi°î
);

	@soc-core.c

25 
	~<löux/moduÀ.h
>

26 
	~<löux/moduÀ∑øm.h
>

27 
	~<löux/öô.h
>

28 
	~<löux/dñay.h
>

29 
	~<löux/pm.h
>

30 
	~<löux/bô›s.h
>

31 
	~<löux/debugfs.h
>

32 
	~<löux/∂©f‹m_devi˚.h
>

33 
	~<löux/˘y≥.h
>

34 
	~<löux/¶ab.h
>

35 
	~<sound/ac97_codec.h
>

36 
	~<sound/c‹e.h
>

37 
	~<sound/jack.h
>

38 
	~<sound/pcm.h
>

39 
	~<sound/pcm_∑øms.h
>

40 
	~<sound/soc.h
>

41 
	~<sound/öôvÆ.h
>

43 
	#CREATE_TRACE_POINTS


	)

44 
	~<åa˚/evíts/asoc.h
>

46 
	#NAME_SIZE
 32

	)

48 
DECLARE_WAIT_QUEUE_HEAD
(
soc_pm_waôq
);

50 #ifde‡
CONFIG_DEBUG_FS


51 
díåy
 *
	g¢d_soc_debugfs_roŸ
;

52 
EXPORT_SYMBOL_GPL
(
¢d_soc_debugfs_roŸ
);

55 
DEFINE_MUTEX
(
˛õ¡_muãx
);

56 
LIST_HEAD
(
ˇrd_li°
);

57 
LIST_HEAD
(
dai_li°
);

58 
LIST_HEAD
(
∂©f‹m_li°
);

59 
LIST_HEAD
(
codec_li°
);

61 
soc_√w_pcm
(
¢d_soc_pcm_ru¡ime
 *
πd
, 
num
);

68 
	gpmdown_time
 = 5000;

69 
moduÀ_∑øm
(
pmdown_time
, , 0);

70 
MODULE_PARM_DESC
(
pmdown_time
, "DAPM streamÖowerdownÅime (msecs)");

74 
	$mö_byãs_√eded
(
vÆ
)

76 
c
 = 0;

77 
i
;

79 
i
 = ( 
vÆ
 * 8Ë- 1; i >0; --i, ++
c
)

80 i‡(
vÆ
 & (1UL << 
i
))

82 
c
 = ( 
vÆ
 * 8) - c;

83 i‡(!
c
 || (c % 8))

84 
c
 = (c + 8) / 8;

86 
c
 /= 8;

87  
c
;

88 
	}
}

92 
	$f‹m©_ªgi°î_°r
(
¢d_soc_codec
 *
codec
,

93 
ªg
, *
buf
, 
size_t
 
Àn
)

95 
w‹dsize
 = 
	`mö_byãs_√eded
(
codec
->
drivî
->
ªg_ˇche_size
) * 2;

96 
ªgsize
 = 
codec
->
drivî
->
ªg_w‹d_size
 * 2;

97 
ªt
;

98 
tmpbuf
[
Àn
 + 1];

99 
ªgbuf
[
ªgsize
 + 1];

103 
	`WARN_ON
(
Àn
 > 63);

106 i‡(
w‹dsize
 + 
ªgsize
 + 2 + 1 !
Àn
)

107  -
EINVAL
;

109 
ªt
 = 
	`¢d_soc_ªad
(
codec
, 
ªg
);

110 i‡(
ªt
 < 0) {

111 
	`mem£t
(
ªgbuf
, 'X', 
ªgsize
);

112 
ªgbuf
[
ªgsize
] = '\0';

114 
	`¢¥ötf
(
ªgbuf
, 
ªgsize
 + 1, "%.*x",Ñegsize, 
ªt
);

118 
	`¢¥ötf
(
tmpbuf
, 
Àn
 + 1, "%.*x: %s\n", 
w‹dsize
, 
ªg
, 
ªgbuf
);

120 
	`mem˝y
(
buf
, 
tmpbuf
, 
Àn
);

123 
	}
}

126 
ssize_t
 
	$soc_codec_ªg_show
(
¢d_soc_codec
 *
codec
, *
buf
,

127 
size_t
 
cou¡
, 
loff_t
 
pos
)

129 
i
, 
°ï
 = 1;

130 
w‹dsize
, 
ªgsize
;

131 
Àn
;

132 
size_t
 
tŸÆ
 = 0;

133 
loff_t
 
p
 = 0;

135 
w‹dsize
 = 
	`mö_byãs_√eded
(
codec
->
drivî
->
ªg_ˇche_size
) * 2;

136 
ªgsize
 = 
codec
->
drivî
->
ªg_w‹d_size
 * 2;

138 
Àn
 = 
w‹dsize
 + 
ªgsize
 + 2 + 1;

140 i‡(!
codec
->
drivî
->
ªg_ˇche_size
)

143 i‡(
codec
->
drivî
->
ªg_ˇche_°ï
)

144 
°ï
 = 
codec
->
drivî
->
ªg_ˇche_°ï
;

146 
i
 = 0; i < 
codec
->
drivî
->
ªg_ˇche_size
; i +
°ï
) {

147 i‡(!
	`¢d_soc_codec_ªadabÀ_ªgi°î
(
codec
, 
i
))

149 i‡(
codec
->
drivî
->
di•œy_ªgi°î
) {

150 
cou¡
 +
codec
->
drivî
->
	`di•œy_ªgi°î
(codec, 
buf
 + count,

151 
PAGE_SIZE
 - 
cou¡
, 
i
);

155 i‡(
p
 >
pos
) {

156 i‡(
tŸÆ
 + 
Àn
 >
cou¡
 - 1)

158 
	`f‹m©_ªgi°î_°r
(
codec
, 
i
, 
buf
 + 
tŸÆ
, 
Àn
);

159 
tŸÆ
 +
Àn
;

161 
p
 +
Àn
;

165 
tŸÆ
 = 
	`mö
—ŸÆ, 
cou¡
 - 1);

167  
tŸÆ
;

168 
	}
}

170 
ssize_t
 
	$codec_ªg_show
(
devi˚
 *
dev
,

171 
devi˚_©åibuã
 *
©å
, *
buf
)

173 
¢d_soc_pcm_ru¡ime
 *
πd
 =

174 
	`c⁄èöî_of
(
dev
, 
¢d_soc_pcm_ru¡ime
, dev);

176  
	`soc_codec_ªg_show
(
πd
->
codec
, 
buf
, 
PAGE_SIZE
, 0);

177 
	}
}

179 
DEVICE_ATTR
(
codec_ªg
, 0444, 
codec_ªg_show
, 
NULL
);

181 
ssize_t
 
	$pmdown_time_show
(
devi˚
 *
dev
,

182 
devi˚_©åibuã
 *
©å
, *
buf
)

184 
¢d_soc_pcm_ru¡ime
 *
πd
 =

185 
	`c⁄èöî_of
(
dev
, 
¢d_soc_pcm_ru¡ime
, dev);

187  
	`•rötf
(
buf
, "%ld\n", 
πd
->
pmdown_time
);

188 
	}
}

190 
ssize_t
 
	$pmdown_time_£t
(
devi˚
 *
dev
,

191 
devi˚_©åibuã
 *
©å
,

192 c⁄° *
buf
, 
size_t
 
cou¡
)

194 
¢d_soc_pcm_ru¡ime
 *
πd
 =

195 
	`c⁄èöî_of
(
dev
, 
¢d_soc_pcm_ru¡ime
, dev);

196 
ªt
;

198 
ªt
 = 
	`°ri˘_°πﬁ
(
buf
, 10, &
πd
->
pmdown_time
);

199 i‡(
ªt
)

200  
ªt
;

202  
cou¡
;

203 
	}
}

205 
DEVICE_ATTR
(
pmdown_time
, 0644, 
pmdown_time_show
, 
pmdown_time_£t
);

207 #ifde‡
CONFIG_DEBUG_FS


208 
	$codec_ªg_›í_fûe
(
öode
 *öode, 
fûe
 *file)

210 
fûe
->
¥iv©e_d©a
 = 
öode
->
i_¥iv©e
;

212 
	}
}

214 
ssize_t
 
	$codec_ªg_ªad_fûe
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

215 
size_t
 
cou¡
, 
loff_t
 *
µos
)

217 
ssize_t
 
ªt
;

218 
¢d_soc_codec
 *
codec
 = 
fûe
->
¥iv©e_d©a
;

219 *
buf
;

221 i‡(*
µos
 < 0 || !
cou¡
)

222  -
EINVAL
;

224 
buf
 = 
	`kmÆloc
(
cou¡
, 
GFP_KERNEL
);

225 i‡(!
buf
)

226  -
ENOMEM
;

228 
ªt
 = 
	`soc_codec_ªg_show
(
codec
, 
buf
, 
cou¡
, *
µos
);

229 i‡(
ªt
 >= 0) {

230 i‡(
	`c›y_to_u£r
(
u£r_buf
, 
buf
, 
ªt
)) {

231 
	`k‰ì
(
buf
);

232  -
EFAULT
;

234 *
µos
 +
ªt
;

237 
	`k‰ì
(
buf
);

238  
ªt
;

239 
	}
}

241 
ssize_t
 
	$codec_ªg_wrôe_fûe
(
fûe
 *file,

242 c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

244 
buf
[32];

245 
size_t
 
buf_size
;

246 *
°¨t
 = 
buf
;

247 
ªg
, 
vÆue
;

248 
¢d_soc_codec
 *
codec
 = 
fûe
->
¥iv©e_d©a
;

250 
buf_size
 = 
	`mö
(
cou¡
, ((
buf
)-1));

251 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
buf_size
))

252  -
EFAULT
;

253 
buf
[
buf_size
] = 0;

255 *
°¨t
 == ' ')

256 
°¨t
++;

257 
ªg
 = 
	`sim∂e_°πoul
(
°¨t
, &start, 16);

258 *
°¨t
 == ' ')

259 
°¨t
++;

260 i‡(
	`°ri˘_°πoul
(
°¨t
, 16, &
vÆue
))

261  -
EINVAL
;

264 
	`add_èöt
(
TAINT_USER
);

266 
	`¢d_soc_wrôe
(
codec
, 
ªg
, 
vÆue
);

267  
buf_size
;

268 
	}
}

270 c⁄° 
fûe_›î©i⁄s
 
	gcodec_ªg_f›s
 = {

271 .
›í
 = 
codec_ªg_›í_fûe
,

272 .
	gªad
 = 
codec_ªg_ªad_fûe
,

273 .
	gwrôe
 = 
codec_ªg_wrôe_fûe
,

274 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

277 
	$soc_öô_codec_debugfs
(
¢d_soc_codec
 *
codec
)

279 
díåy
 *
debugfs_ˇrd_roŸ
 = 
codec
->
ˇrd
->debugfs_card_root;

281 
codec
->
debugfs_codec_roŸ
 = 
	`debugfs_¸óã_dú
(codec->
«me
,

282 
debugfs_ˇrd_roŸ
);

283 i‡(!
codec
->
debugfs_codec_roŸ
) {

284 
	`¥ötk
(
KERN_WARNING


289 
	`debugfs_¸óã_boﬁ
("ˇche_sync", 0444, 
codec
->
debugfs_codec_roŸ
,

290 &
codec
->
ˇche_sync
);

291 
	`debugfs_¸óã_boﬁ
("ˇche_⁄ly", 0444, 
codec
->
debugfs_codec_roŸ
,

292 &
codec
->
ˇche_⁄ly
);

294 
codec
->
debugfs_ªg
 = 
	`debugfs_¸óã_fûe
("codec_reg", 0644,

295 
codec
->
debugfs_codec_roŸ
,

296 
codec
, &
codec_ªg_f›s
);

297 i‡(!
codec
->
debugfs_ªg
)

298 
	`¥ötk
(
KERN_WARNING


301 
	`¢d_soc_d≠m_debugfs_öô
(&
codec
->
d≠m
, codec->
debugfs_codec_roŸ
);

302 
	}
}

304 
	$soc_˛ónup_codec_debugfs
(
¢d_soc_codec
 *
codec
)

306 
	`debugfs_ªmove_ªcursive
(
codec
->
debugfs_codec_roŸ
);

307 
	}
}

309 
ssize_t
 
	$codec_li°_ªad_fûe
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

310 
size_t
 
cou¡
, 
loff_t
 *
µos
)

312 *
buf
 = 
	`kmÆloc
(
PAGE_SIZE
, 
GFP_KERNEL
);

313 
ssize_t
 
Àn
, 
ªt
 = 0;

314 
¢d_soc_codec
 *
codec
;

316 i‡(!
buf
)

317  -
ENOMEM
;

319 
	`li°_f‹_óch_íåy
(
codec
, &
codec_li°
, 
li°
) {

320 
Àn
 = 
	`¢¥ötf
(
buf
 + 
ªt
, 
PAGE_SIZE
 -Ñet, "%s\n",

321 
codec
->
«me
);

322 i‡(
Àn
 >= 0)

323 
ªt
 +
Àn
;

324 i‡(
ªt
 > 
PAGE_SIZE
) {

325 
ªt
 = 
PAGE_SIZE
;

330 i‡(
ªt
 >= 0)

331 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
,Ñet);

333 
	`k‰ì
(
buf
);

335  
ªt
;

336 
	}
}

338 c⁄° 
fûe_›î©i⁄s
 
	gcodec_li°_f›s
 = {

339 .
ªad
 = 
codec_li°_ªad_fûe
,

340 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

343 
ssize_t
 
	$dai_li°_ªad_fûe
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

344 
size_t
 
cou¡
, 
loff_t
 *
µos
)

346 *
buf
 = 
	`kmÆloc
(
PAGE_SIZE
, 
GFP_KERNEL
);

347 
ssize_t
 
Àn
, 
ªt
 = 0;

348 
¢d_soc_dai
 *
dai
;

350 i‡(!
buf
)

351  -
ENOMEM
;

353 
	`li°_f‹_óch_íåy
(
dai
, &
dai_li°
, 
li°
) {

354 
Àn
 = 
	`¢¥ötf
(
buf
 + 
ªt
, 
PAGE_SIZE
 -Ñë, "%s\n", 
dai
->
«me
);

355 i‡(
Àn
 >= 0)

356 
ªt
 +
Àn
;

357 i‡(
ªt
 > 
PAGE_SIZE
) {

358 
ªt
 = 
PAGE_SIZE
;

363 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
,Ñet);

365 
	`k‰ì
(
buf
);

367  
ªt
;

368 
	}
}

370 c⁄° 
fûe_›î©i⁄s
 
	gdai_li°_f›s
 = {

371 .
ªad
 = 
dai_li°_ªad_fûe
,

372 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

375 
ssize_t
 
	$∂©f‹m_li°_ªad_fûe
(
fûe
 *file,

376 
__u£r
 *
u£r_buf
,

377 
size_t
 
cou¡
, 
loff_t
 *
µos
)

379 *
buf
 = 
	`kmÆloc
(
PAGE_SIZE
, 
GFP_KERNEL
);

380 
ssize_t
 
Àn
, 
ªt
 = 0;

381 
¢d_soc_∂©f‹m
 *
∂©f‹m
;

383 i‡(!
buf
)

384  -
ENOMEM
;

386 
	`li°_f‹_óch_íåy
(
∂©f‹m
, &
∂©f‹m_li°
, 
li°
) {

387 
Àn
 = 
	`¢¥ötf
(
buf
 + 
ªt
, 
PAGE_SIZE
 -Ñet, "%s\n",

388 
∂©f‹m
->
«me
);

389 i‡(
Àn
 >= 0)

390 
ªt
 +
Àn
;

391 i‡(
ªt
 > 
PAGE_SIZE
) {

392 
ªt
 = 
PAGE_SIZE
;

397 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
,Ñet);

399 
	`k‰ì
(
buf
);

401  
ªt
;

402 
	}
}

404 c⁄° 
fûe_›î©i⁄s
 
	g∂©f‹m_li°_f›s
 = {

405 .
ªad
 = 
∂©f‹m_li°_ªad_fûe
,

406 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

409 
	$soc_öô_ˇrd_debugfs
(
¢d_soc_ˇrd
 *
ˇrd
)

411 
ˇrd
->
debugfs_ˇrd_roŸ
 = 
	`debugfs_¸óã_dú
(ˇrd->
«me
,

412 
¢d_soc_debugfs_roŸ
);

413 i‡(!
ˇrd
->
debugfs_ˇrd_roŸ
) {

414 
	`dev_w¨n
(
ˇrd
->
dev
,

419 
ˇrd
->
debugfs_p›_time
 = 
	`debugfs_¸óã_u32
("dapm_pop_time", 0644,

420 
ˇrd
->
debugfs_ˇrd_roŸ
,

421 &
ˇrd
->
p›_time
);

422 i‡(!
ˇrd
->
debugfs_p›_time
)

423 
	`dev_w¨n
(
ˇrd
->
dev
,

425 
	}
}

427 
	$soc_˛ónup_ˇrd_debugfs
(
¢d_soc_ˇrd
 *
ˇrd
)

429 
	`debugfs_ªmove_ªcursive
(
ˇrd
->
debugfs_ˇrd_roŸ
);

430 
	}
}

434 
ölöe
 
	$soc_öô_codec_debugfs
(
¢d_soc_codec
 *
codec
)

436 
	}
}

438 
ölöe
 
	$soc_˛ónup_codec_debugfs
(
¢d_soc_codec
 *
codec
)

440 
	}
}

442 
ölöe
 
	$soc_öô_ˇrd_debugfs
(
¢d_soc_ˇrd
 *
ˇrd
)

444 
	}
}

446 
ölöe
 
	$soc_˛ónup_ˇrd_debugfs
(
¢d_soc_ˇrd
 *
ˇrd
)

448 
	}
}

451 #ifde‡
CONFIG_SND_SOC_AC97_BUS


453 
	$soc_ac97_dev_uƒegi°î
(
¢d_soc_codec
 *
codec
)

455 i‡(
codec
->
ac97
->
dev
.
bus
)

456 
	`devi˚_uƒegi°î
(&
codec
->
ac97
->
dev
);

458 
	}
}

461 
	$soc_ac97_devi˚_ªÀa£
(
devi˚
 *
dev
){
	}
}

464 
	$soc_ac97_dev_ªgi°î
(
¢d_soc_codec
 *
codec
)

466 
îr
;

468 
codec
->
ac97
->
dev
.
bus
 = &
ac97_bus_ty≥
;

469 
codec
->
ac97
->
dev
.
∑ª¡
 = codec->
ˇrd
->dev;

470 
codec
->
ac97
->
dev
.
ªÀa£
 = 
soc_ac97_devi˚_ªÀa£
;

472 
	`dev_£t_«me
(&
codec
->
ac97
->
dev
, "%d-%d:%s",

473 
codec
->
ˇrd
->
¢d_ˇrd
->
numbî
, 0, codec->
«me
);

474 
îr
 = 
	`devi˚_ªgi°î
(&
codec
->
ac97
->
dev
);

475 i‡(
îr
 < 0) {

476 
	`¢d_¥ötk
(
KERN_ERR
 "Can'tÑegisterác97 bus\n");

477 
codec
->
ac97
->
dev
.
bus
 = 
NULL
;

478  
îr
;

481 
	}
}

484 #ifde‡
CONFIG_PM_SLEEP


486 
	$¢d_soc_su•íd
(
devi˚
 *
dev
)

488 
¢d_soc_ˇrd
 *
ˇrd
 = 
	`dev_gë_drvd©a
(
dev
);

489 
¢d_soc_codec
 *
codec
;

490 
i
;

495 i‡(
	`li°_em±y
(&
ˇrd
->
codec_dev_li°
))

501 
	`¢d_powî_lock
(
ˇrd
->
¢d_ˇrd
);

502 
	`¢d_powî_waô
(
ˇrd
->
¢d_ˇrd
, 
SNDRV_CTL_POWER_D0
);

503 
	`¢d_powî_u∆ock
(
ˇrd
->
¢d_ˇrd
);

506 
	`¢d_powî_ch™ge_°©e
(
ˇrd
->
¢d_ˇrd
, 
SNDRV_CTL_POWER_D3hŸ
);

509 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

510 
¢d_soc_dai
 *
dai
 = 
ˇrd
->
πd
[
i
].
codec_dai
;

511 
¢d_soc_dai_drivî
 *
drv
 = 
dai
->
drivî
;

513 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

516 i‡(
drv
->
›s
->
digôÆ_muã
 && 
dai
->
∂ayback_a˘ive
)

517 
drv
->
›s
->
	`digôÆ_muã
(
dai
, 1);

521 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

522 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

525 
	`¢d_pcm_su•íd_Æl
(
ˇrd
->
πd
[
i
].
pcm
);

528 i‡(
ˇrd
->
su•íd_¥e
)

529 
ˇrd
->
	`su•íd_¥e
(card);

531 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

532 
¢d_soc_dai
 *
˝u_dai
 = 
ˇrd
->
πd
[
i
].cpu_dai;

533 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
ˇrd
->
πd
[
i
].platform;

535 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

538 i‡(
˝u_dai
->
drivî
->
su•íd
 && !˝u_dai->drivî->
ac97_c⁄åﬁ
)

539 
˝u_dai
->
drivî
->
	`su•íd
(cpu_dai);

540 i‡(
∂©f‹m
->
drivî
->
su•íd
 && !∂©f‹m->
su•íded
) {

541 
∂©f‹m
->
drivî
->
	`su•íd
(
˝u_dai
);

542 
∂©f‹m
->
su•íded
 = 1;

547 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

548 
	`Êush_dñayed_w‹k_sync
(&
ˇrd
->
πd
[
i
].
dñayed_w‹k
);

549 
ˇrd
->
πd
[
i
].
codec
->
d≠m
.
su•íd_büs_Àvñ
 = c¨d->πd[i].codec->d≠m.
büs_Àvñ
;

552 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

553 
¢d_soc_dai_drivî
 *
drivî
 = 
ˇrd
->
πd
[
i
].
codec_dai
->driver;

555 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

558 i‡(
drivî
->
∂ayback
.
°ªam_«me
 !
NULL
)

559 
	`¢d_soc_d≠m_°ªam_evít
(&
ˇrd
->
πd
[
i
], 
drivî
->
∂ayback
.
°ªam_«me
,

560 
SND_SOC_DAPM_STREAM_SUSPEND
);

562 i‡(
drivî
->
ˇ±uª
.
°ªam_«me
 !
NULL
)

563 
	`¢d_soc_d≠m_°ªam_evít
(&
ˇrd
->
πd
[
i
], 
drivî
->
ˇ±uª
.
°ªam_«me
,

564 
SND_SOC_DAPM_STREAM_SUSPEND
);

568 
	`li°_f‹_óch_íåy
(
codec
, &
ˇrd
->
codec_dev_li°
, 
ˇrd_li°
) {

571 i‡(!
codec
->
su•íded
 && codec->
drivî
->
su•íd
) {

572 
codec
->
d≠m
.
büs_Àvñ
) {

573 
SND_SOC_BIAS_STANDBY
:

574 
SND_SOC_BIAS_OFF
:

575 
codec
->
drivî
->
	`su•íd
(codec, 
PMSG_SUSPEND
);

576 
codec
->
su•íded
 = 1;

577 
codec
->
ˇche_sync
 = 1;

580 
	`dev_dbg
(
codec
->
dev
, "CODEC is on over suspend\n");

586 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

587 
¢d_soc_dai
 *
˝u_dai
 = 
ˇrd
->
πd
[
i
].cpu_dai;

589 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

592 i‡(
˝u_dai
->
drivî
->
su•íd
 && cpu_dai->drivî->
ac97_c⁄åﬁ
)

593 
˝u_dai
->
drivî
->
	`su•íd
(cpu_dai);

596 i‡(
ˇrd
->
su•íd_po°
)

597 
ˇrd
->
	`su•íd_po°
(card);

600 
	}
}

601 
EXPORT_SYMBOL_GPL
(
¢d_soc_su•íd
);

606 
	$soc_ªsume_de„ºed
(
w‹k_°ru˘
 *
w‹k
)

608 
¢d_soc_ˇrd
 *
ˇrd
 =

609 
	`c⁄èöî_of
(
w‹k
, 
¢d_soc_ˇrd
, 
de„ºed_ªsume_w‹k
);

610 
¢d_soc_codec
 *
codec
;

611 
i
;

617 
	`dev_dbg
(
ˇrd
->
dev
, "startingÑesume work\n");

620 
	`¢d_powî_ch™ge_°©e
(
ˇrd
->
¢d_ˇrd
, 
SNDRV_CTL_POWER_D2
);

622 i‡(
ˇrd
->
ªsume_¥e
)

623 
ˇrd
->
	`ªsume_¥e
(card);

626 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

627 
¢d_soc_dai
 *
˝u_dai
 = 
ˇrd
->
πd
[
i
].cpu_dai;

629 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

632 i‡(
˝u_dai
->
drivî
->
ªsume
 && cpu_dai->drivî->
ac97_c⁄åﬁ
)

633 
˝u_dai
->
drivî
->
	`ªsume
(cpu_dai);

636 
	`li°_f‹_óch_íåy
(
codec
, &
ˇrd
->
codec_dev_li°
, 
ˇrd_li°
) {

641 i‡(
codec
->
drivî
->
ªsume
 && codec->
su•íded
) {

642 
codec
->
d≠m
.
büs_Àvñ
) {

643 
SND_SOC_BIAS_STANDBY
:

644 
SND_SOC_BIAS_OFF
:

645 
codec
->
drivî
->
	`ªsume
(codec);

646 
codec
->
su•íded
 = 0;

649 
	`dev_dbg
(
codec
->
dev
, "CODEC was on over suspend\n");

655 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

656 
¢d_soc_dai_drivî
 *
drivî
 = 
ˇrd
->
πd
[
i
].
codec_dai
->driver;

658 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

661 i‡(
drivî
->
∂ayback
.
°ªam_«me
 !
NULL
)

662 
	`¢d_soc_d≠m_°ªam_evít
(&
ˇrd
->
πd
[
i
], 
drivî
->
∂ayback
.
°ªam_«me
,

663 
SND_SOC_DAPM_STREAM_RESUME
);

665 i‡(
drivî
->
ˇ±uª
.
°ªam_«me
 !
NULL
)

666 
	`¢d_soc_d≠m_°ªam_evít
(&
ˇrd
->
πd
[
i
], 
drivî
->
ˇ±uª
.
°ªam_«me
,

667 
SND_SOC_DAPM_STREAM_RESUME
);

671 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

672 
¢d_soc_dai
 *
dai
 = 
ˇrd
->
πd
[
i
].
codec_dai
;

673 
¢d_soc_dai_drivî
 *
drv
 = 
dai
->
drivî
;

675 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

678 i‡(
drv
->
›s
->
digôÆ_muã
 && 
dai
->
∂ayback_a˘ive
)

679 
drv
->
›s
->
	`digôÆ_muã
(
dai
, 0);

682 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

683 
¢d_soc_dai
 *
˝u_dai
 = 
ˇrd
->
πd
[
i
].cpu_dai;

684 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
ˇrd
->
πd
[
i
].platform;

686 i‡(
ˇrd
->
πd
[
i
].
dai_lök
->
ign‹e_su•íd
)

689 i‡(
˝u_dai
->
drivî
->
ªsume
 && !˝u_dai->drivî->
ac97_c⁄åﬁ
)

690 
˝u_dai
->
drivî
->
	`ªsume
(cpu_dai);

691 i‡(
∂©f‹m
->
drivî
->
ªsume
 &&Öœtf‹m->
su•íded
) {

692 
∂©f‹m
->
drivî
->
	`ªsume
(
˝u_dai
);

693 
∂©f‹m
->
su•íded
 = 0;

697 i‡(
ˇrd
->
ªsume_po°
)

698 
ˇrd
->
	`ªsume_po°
(card);

700 
	`dev_dbg
(
ˇrd
->
dev
, "resume work completed\n");

703 
	`¢d_powî_ch™ge_°©e
(
ˇrd
->
¢d_ˇrd
, 
SNDRV_CTL_POWER_D0
);

704 
	}
}

707 
	$¢d_soc_ªsume
(
devi˚
 *
dev
)

709 
¢d_soc_ˇrd
 *
ˇrd
 = 
	`dev_gë_drvd©a
(
dev
);

710 
i
, 
ac97_c⁄åﬁ
 = 0;

715 i‡(
	`li°_em±y
(&
ˇrd
->
codec_dev_li°
))

723 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

724 
¢d_soc_dai
 *
˝u_dai
 = 
ˇrd
->
πd
[
i
].cpu_dai;

725 
ac97_c⁄åﬁ
 |
˝u_dai
->
drivî
->ac97_control;

727 i‡(
ac97_c⁄åﬁ
) {

728 
	`dev_dbg
(
dev
, "Resuming AC97 immediately\n");

729 
	`soc_ªsume_de„ºed
(&
ˇrd
->
de„ºed_ªsume_w‹k
);

731 
	`dev_dbg
(
dev
, "SchedulingÑesume work\n");

732 i‡(!
	`scheduÀ_w‹k
(&
ˇrd
->
de„ºed_ªsume_w‹k
))

733 
	`dev_îr
(
dev
, "resume work item may beÜost\n");

737 
	}
}

738 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªsume
);

740 
	#¢d_soc_su•íd
 
NULL


	)

741 
	#¢d_soc_ªsume
 
NULL


	)

744 
¢d_soc_dai_›s
 
	gnuŒ_dai_›s
 = {

747 
	$soc_böd_dai_lök
(
¢d_soc_ˇrd
 *
ˇrd
, 
num
)

749 
¢d_soc_dai_lök
 *
dai_lök
 = &
ˇrd
->dai_lök[
num
];

750 
¢d_soc_pcm_ru¡ime
 *
πd
 = &
ˇrd
->πd[
num
];

751 
¢d_soc_codec
 *
codec
;

752 
¢d_soc_∂©f‹m
 *
∂©f‹m
;

753 
¢d_soc_dai
 *
codec_dai
, *
˝u_dai
;

754 c⁄° *
∂©f‹m_«me
;

756 i‡(
πd
->
com∂ëe
)

758 
	`dev_dbg
(
ˇrd
->
dev
, "bödög %†© idx %d\n", 
dai_lök
->
«me
, 
num
);

761 i‡(
πd
->
˝u_dai
) {

762 
föd_codec
;

765 
	`li°_f‹_óch_íåy
(
˝u_dai
, &
dai_li°
, 
li°
) {

766 i‡(!
	`°rcmp
(
˝u_dai
->
«me
, 
dai_lök
->
˝u_dai_«me
)) {

767 
πd
->
˝u_dai
 = cpu_dai;

768 
föd_codec
;

771 
	`dev_dbg
(
ˇrd
->
dev
, "CPU DAI %sÇotÑegistered\n",

772 
dai_lök
->
˝u_dai_«me
);

774 
föd_codec
:

776 i‡(
πd
->
codec
) {

777 
föd_∂©f‹m
;

781 
	`li°_f‹_óch_íåy
(
codec
, &
codec_li°
, 
li°
) {

782 i‡(!
	`°rcmp
(
codec
->
«me
, 
dai_lök
->
codec_«me
)) {

783 
πd
->
codec
 = codec;

786 
	`li°_f‹_óch_íåy
(
codec_dai
, &
dai_li°
, 
li°
) {

787 i‡(
codec
->
dev
 =
codec_dai
->dev &&

788 !
	`°rcmp
(
codec_dai
->
«me
, 
dai_lök
->
codec_dai_«me
)) {

789 
πd
->
codec_dai
 = codec_dai;

790 
föd_∂©f‹m
;

793 
	`dev_dbg
(
ˇrd
->
dev
, "CODEC DAI %sÇotÑegistered\n",

794 
dai_lök
->
codec_dai_«me
);

796 
föd_∂©f‹m
;

799 
	`dev_dbg
(
ˇrd
->
dev
, "CODEC %sÇotÑegistered\n",

800 
dai_lök
->
codec_«me
);

802 
föd_∂©f‹m
:

804 i‡(
πd
->
∂©f‹m
)

805 
out
;

808 
∂©f‹m_«me
 = 
dai_lök
->platform_name;

809 i‡(!
∂©f‹m_«me
)

810 
∂©f‹m_«me
 = "snd-soc-dummy";

813 
	`li°_f‹_óch_íåy
(
∂©f‹m
, &
∂©f‹m_li°
, 
li°
) {

814 i‡(!
	`°rcmp
(
∂©f‹m
->
«me
, 
∂©f‹m_«me
)) {

815 
πd
->
∂©f‹m
 =Ölatform;

816 
out
;

820 
	`dev_dbg
(
ˇrd
->
dev
, "platform %sÇotÑegistered\n",

821 
dai_lök
->
∂©f‹m_«me
);

824 
out
:

826 i‡(
πd
->
codec
 &&Ñtd->
codec_dai
 &&Ñtd->
∂©f‹m
 &&Ñtd->
˝u_dai
) {

827 
πd
->
com∂ëe
 = 1;

828 
ˇrd
->
num_πd
++;

831 
	}
}

833 
	$soc_ªmove_codec
(
¢d_soc_codec
 *
codec
)

835 
îr
;

837 i‡(
codec
->
drivî
->
ªmove
) {

838 
îr
 = 
codec
->
drivî
->
	`ªmove
(codec);

839 i‡(
îr
 < 0)

840 
	`dev_îr
(
codec
->
dev
,

842 
codec
->
«me
, 
îr
);

846 
	`¢d_soc_d≠m_‰ì
(&
codec
->
d≠m
);

848 
	`soc_˛ónup_codec_debugfs
(
codec
);

849 
codec
->
¥obed
 = 0;

850 
	`li°_dñ
(&
codec
->
ˇrd_li°
);

851 
	`moduÀ_put
(
codec
->
dev
->
drivî
->
ow√r
);

852 
	}
}

854 
	$soc_ªmove_dai_lök
(
¢d_soc_ˇrd
 *
ˇrd
, 
num
, 
‹dî
)

856 
¢d_soc_pcm_ru¡ime
 *
πd
 = &
ˇrd
->πd[
num
];

857 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

858 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

859 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai, *
˝u_dai
 =Ñtd->cpu_dai;

860 
îr
;

863 i‡(
πd
->
dev_ªgi°îed
) {

864 
	`devi˚_ªmove_fûe
(&
πd
->
dev
, &
dev_©å_pmdown_time
);

865 
	`devi˚_ªmove_fûe
(&
πd
->
dev
, &
dev_©å_codec_ªg
);

866 
	`devi˚_uƒegi°î
(&
πd
->
dev
);

867 
πd
->
dev_ªgi°îed
 = 0;

871 i‡(
codec_dai
 && codec_dai->
¥obed
 &&

872 
codec_dai
->
drivî
->
ªmove_‹dî
 =
‹dî
) {

873 i‡(
codec_dai
->
drivî
->
ªmove
) {

874 
îr
 = 
codec_dai
->
drivî
->
	`ªmove
(codec_dai);

875 i‡(
îr
 < 0)

876 
	`¥ötk
(
KERN_ERR
 "asoc: faûedÅÿªmovê%s\n", 
codec_dai
->
«me
);

878 
codec_dai
->
¥obed
 = 0;

879 
	`li°_dñ
(&
codec_dai
->
ˇrd_li°
);

883 i‡(
∂©f‹m
 &&Öœtf‹m->
¥obed
 &&

884 
∂©f‹m
->
drivî
->
ªmove_‹dî
 =
‹dî
) {

885 i‡(
∂©f‹m
->
drivî
->
ªmove
) {

886 
îr
 = 
∂©f‹m
->
drivî
->
	`ªmove
(platform);

887 i‡(
îr
 < 0)

888 
	`¥ötk
(
KERN_ERR
 "asoc: faûedÅÿªmovê%s\n", 
∂©f‹m
->
«me
);

890 
∂©f‹m
->
¥obed
 = 0;

891 
	`li°_dñ
(&
∂©f‹m
->
ˇrd_li°
);

892 
	`moduÀ_put
(
∂©f‹m
->
dev
->
drivî
->
ow√r
);

896 i‡(
codec
 && codec->
¥obed
 &&

897 
codec
->
drivî
->
ªmove_‹dî
 =
‹dî
)

898 
	`soc_ªmove_codec
(
codec
);

901 i‡(
˝u_dai
 && cpu_dai->
¥obed
 &&

902 
˝u_dai
->
drivî
->
ªmove_‹dî
 =
‹dî
) {

903 i‡(
˝u_dai
->
drivî
->
ªmove
) {

904 
îr
 = 
˝u_dai
->
drivî
->
	`ªmove
(cpu_dai);

905 i‡(
îr
 < 0)

906 
	`¥ötk
(
KERN_ERR
 "asoc: faûedÅÿªmovê%s\n", 
˝u_dai
->
«me
);

908 
˝u_dai
->
¥obed
 = 0;

909 
	`li°_dñ
(&
˝u_dai
->
ˇrd_li°
);

910 
	`moduÀ_put
(
˝u_dai
->
dev
->
drivî
->
ow√r
);

912 
	}
}

914 
	$soc_ªmove_dai_löks
(
¢d_soc_ˇrd
 *
ˇrd
)

916 
dai
, 
‹dî
;

918 
‹dî
 = 
SND_SOC_COMP_ORDER_FIRST
; ordî <
SND_SOC_COMP_ORDER_LAST
;

919 
‹dî
++) {

920 
dai
 = 0; daò< 
ˇrd
->
num_πd
; dai++)

921 
	`soc_ªmove_dai_lök
(
ˇrd
, 
dai
, 
‹dî
);

923 
ˇrd
->
num_πd
 = 0;

924 
	}
}

926 
	$soc_£t_«me_¥efix
(
¢d_soc_ˇrd
 *
ˇrd
,

927 
¢d_soc_codec
 *
codec
)

929 
i
;

931 i‡(
ˇrd
->
codec_c⁄f
 =
NULL
)

934 
i
 = 0; i < 
ˇrd
->
num_c⁄figs
; i++) {

935 
¢d_soc_codec_c⁄f
 *
m≠
 = &
ˇrd
->
codec_c⁄f
[
i
];

936 i‡(
m≠
->
dev_«me
 && !
	`°rcmp
(
codec
->
«me
, map->dev_name)) {

937 
codec
->
«me_¥efix
 = 
m≠
->name_prefix;

941 
	}
}

943 
	$soc_¥obe_codec
(
¢d_soc_ˇrd
 *
ˇrd
,

944 
¢d_soc_codec
 *
codec
)

946 
ªt
 = 0;

947 c⁄° 
¢d_soc_codec_drivî
 *
drivî
 = 
codec
->driver;

949 
codec
->
ˇrd
 = card;

950 
codec
->
d≠m
.
ˇrd
 = card;

951 
	`soc_£t_«me_¥efix
(
ˇrd
, 
codec
);

953 i‡(!
	`åy_moduÀ_gë
(
codec
->
dev
->
drivî
->
ow√r
))

954  -
ENODEV
;

956 
	`soc_öô_codec_debugfs
(
codec
);

958 i‡(
drivî
->
d≠m_widgës
)

959 
	`¢d_soc_d≠m_√w_c⁄åﬁs
(&
codec
->
d≠m
, 
drivî
->
d≠m_widgës
,

960 
drivî
->
num_d≠m_widgës
);

962 
codec
->
d≠m
.
idÀ_büs_off
 = 
drivî
->idle_bias_off;

964 i‡(
drivî
->
¥obe
) {

965 
ªt
 = 
drivî
->
	`¥obe
(
codec
);

966 i‡(
ªt
 < 0) {

967 
	`dev_îr
(
codec
->
dev
,

969 
codec
->
«me
, 
ªt
);

970 
îr_¥obe
;

974 i‡(
drivî
->
c⁄åﬁs
)

975 
	`¢d_soc_add_c⁄åﬁs
(
codec
, 
drivî
->
c⁄åﬁs
,

976 
drivî
->
num_c⁄åﬁs
);

977 i‡(
drivî
->
d≠m_rouãs
)

978 
	`¢d_soc_d≠m_add_rouãs
(&
codec
->
d≠m
, 
drivî
->
d≠m_rouãs
,

979 
drivî
->
num_d≠m_rouãs
);

982 
codec
->
¥obed
 = 1;

983 
	`li°_add
(&
codec
->
ˇrd_li°
, &
ˇrd
->
codec_dev_li°
);

984 
	`li°_add
(&
codec
->
d≠m
.
li°
, &
ˇrd
->
d≠m_li°
);

988 
îr_¥obe
:

989 
	`soc_˛ónup_codec_debugfs
(
codec
);

990 
	`moduÀ_put
(
codec
->
dev
->
drivî
->
ow√r
);

992  
ªt
;

993 
	}
}

995 
	$soc_¥obe_∂©f‹m
(
¢d_soc_ˇrd
 *
ˇrd
,

996 
¢d_soc_∂©f‹m
 *
∂©f‹m
)

998 
ªt
 = 0;

999 c⁄° 
¢d_soc_∂©f‹m_drivî
 *
drivî
 = 
∂©f‹m
->driver;

1001 
∂©f‹m
->
ˇrd
 = card;

1002 
∂©f‹m
->
d≠m
.
ˇrd
 = card;

1004 i‡(!
	`åy_moduÀ_gë
(
∂©f‹m
->
dev
->
drivî
->
ow√r
))

1005  -
ENODEV
;

1007 i‡(
drivî
->
d≠m_widgës
)

1008 
	`¢d_soc_d≠m_√w_c⁄åﬁs
(&
∂©f‹m
->
d≠m
,

1009 
drivî
->
d≠m_widgës
, drivî->
num_d≠m_widgës
);

1011 i‡(
drivî
->
¥obe
) {

1012 
ªt
 = 
drivî
->
	`¥obe
(
∂©f‹m
);

1013 i‡(
ªt
 < 0) {

1014 
	`dev_îr
(
∂©f‹m
->
dev
,

1016 
∂©f‹m
->
«me
, 
ªt
);

1017 
îr_¥obe
;

1021 i‡(
drivî
->
c⁄åﬁs
)

1022 
	`¢d_soc_add_∂©f‹m_c⁄åﬁs
(
∂©f‹m
, 
drivî
->
c⁄åﬁs
,

1023 
drivî
->
num_c⁄åﬁs
);

1024 i‡(
drivî
->
d≠m_rouãs
)

1025 
	`¢d_soc_d≠m_add_rouãs
(&
∂©f‹m
->
d≠m
, 
drivî
->
d≠m_rouãs
,

1026 
drivî
->
num_d≠m_rouãs
);

1029 
∂©f‹m
->
¥obed
 = 1;

1030 
	`li°_add
(&
∂©f‹m
->
ˇrd_li°
, &
ˇrd
->
∂©f‹m_dev_li°
);

1031 
	`li°_add
(&
∂©f‹m
->
d≠m
.
li°
, &
ˇrd
->
d≠m_li°
);

1035 
îr_¥obe
:

1036 
	`moduÀ_put
(
∂©f‹m
->
dev
->
drivî
->
ow√r
);

1038  
ªt
;

1039 
	}
}

1041 
	$πd_ªÀa£
(
devi˚
 *
dev
Ë{
	}
}

1043 
	$soc_po°_comp⁄ít_öô
(
¢d_soc_ˇrd
 *
ˇrd
,

1044 
¢d_soc_codec
 *
codec
,

1045 
num
, 
daûess
)

1047 
¢d_soc_dai_lök
 *
dai_lök
 = 
NULL
;

1048 
¢d_soc_aux_dev
 *
aux_dev
 = 
NULL
;

1049 
¢d_soc_pcm_ru¡ime
 *
πd
;

1050 c⁄° *
ãmp
, *
«me
;

1051 
ªt
 = 0;

1053 i‡(!
daûess
) {

1054 
dai_lök
 = &
ˇrd
->dai_lök[
num
];

1055 
πd
 = &
ˇrd
->πd[
num
];

1056 
«me
 = 
dai_lök
->name;

1058 
aux_dev
 = &
ˇrd
->aux_dev[
num
];

1059 
πd
 = &
ˇrd
->
πd_aux
[
num
];

1060 
«me
 = 
aux_dev
->name;

1062 
πd
->
ˇrd
 = card;

1065 
	`¢d_soc_d≠m_√w_widgës
(&
codec
->
d≠m
);

1068 
ãmp
 = 
codec
->
«me_¥efix
;

1069 
codec
->
«me_¥efix
 = 
NULL
;

1072 i‡(!
daûess
 && 
dai_lök
->
öô
)

1073 
ªt
 = 
dai_lök
->
	`öô
(
πd
);

1074 i‡(
daûess
 && 
aux_dev
->
öô
)

1075 
ªt
 = 
aux_dev
->
	`öô
(&
codec
->
d≠m
);

1076 i‡(
ªt
 < 0) {

1077 
	`dev_îr
(
ˇrd
->
dev
, "asoc: faûedÅÿöô %s: %d\n", 
«me
, 
ªt
);

1078  
ªt
;

1080 
codec
->
«me_¥efix
 = 
ãmp
;

1083 
πd
->
codec
 = codec;

1084 
πd
->
dev
.
∑ª¡
 = 
ˇrd
->dev;

1085 
πd
->
dev
.
ªÀa£
 = 
πd_ªÀa£
;

1086 
πd
->
dev
.
öô_«me
 = 
«me
;

1087 
	`muãx_öô
(&
πd
->
pcm_muãx
);

1088 
ªt
 = 
	`devi˚_ªgi°î
(&
πd
->
dev
);

1089 i‡(
ªt
 < 0) {

1090 
	`dev_îr
(
ˇrd
->
dev
,

1091 "asoc: faûedÅÿªgi°îÑu¡imêdevi˚: %d\n", 
ªt
);

1092  
ªt
;

1094 
πd
->
dev_ªgi°îed
 = 1;

1097 
ªt
 = 
	`¢d_soc_d≠m_sys_add
(&
πd
->
dev
);

1098 i‡(
ªt
 < 0)

1099 
	`dev_îr
(
codec
->
dev
,

1101 
ªt
);

1104 
ªt
 = 
	`devi˚_¸óã_fûe
(&
πd
->
dev
, &
dev_©å_codec_ªg
);

1105 i‡(
ªt
 < 0)

1106 
	`dev_îr
(
codec
->
dev
,

1107 "asoc: faûedÅÿadd code¯sysf†fûes: %d\n", 
ªt
);

1110 
	}
}

1112 
	$soc_¥obe_dai_lök
(
¢d_soc_ˇrd
 *
ˇrd
, 
num
, 
‹dî
)

1114 
¢d_soc_dai_lök
 *
dai_lök
 = &
ˇrd
->dai_lök[
num
];

1115 
¢d_soc_pcm_ru¡ime
 *
πd
 = &
ˇrd
->πd[
num
];

1116 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

1117 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

1118 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai, *
˝u_dai
 =Ñtd->cpu_dai;

1119 
ªt
;

1121 
	`dev_dbg
(
ˇrd
->
dev
, "probe %s daiÜink %dÜate %d\n",

1122 
ˇrd
->
«me
, 
num
, 
‹dî
);

1125 
codec_dai
->
codec
 = codec;

1126 
˝u_dai
->
∂©f‹m
 =Ölatform;

1127 
codec_dai
->
ˇrd
 = card;

1128 
˝u_dai
->
ˇrd
 = card;

1131 
πd
->
pmdown_time
 =Ömdown_time;

1134 i‡(!
˝u_dai
->
¥obed
 &&

1135 
˝u_dai
->
drivî
->
¥obe_‹dî
 =
‹dî
) {

1136 i‡(!
	`åy_moduÀ_gë
(
˝u_dai
->
dev
->
drivî
->
ow√r
))

1137  -
ENODEV
;

1139 i‡(
˝u_dai
->
drivî
->
¥obe
) {

1140 
ªt
 = 
˝u_dai
->
drivî
->
	`¥obe
(cpu_dai);

1141 i‡(
ªt
 < 0) {

1142 
	`¥ötk
(
KERN_ERR
 "asoc: failedÅoÖrobe CPU DAI %s\n",

1143 
˝u_dai
->
«me
);

1144 
	`moduÀ_put
(
˝u_dai
->
dev
->
drivî
->
ow√r
);

1145  
ªt
;

1148 
˝u_dai
->
¥obed
 = 1;

1150 
	`li°_add
(&
˝u_dai
->
ˇrd_li°
, &
ˇrd
->
dai_dev_li°
);

1154 i‡(!
codec
->
¥obed
 &&

1155 
codec
->
drivî
->
¥obe_‹dî
 =
‹dî
) {

1156 
ªt
 = 
	`soc_¥obe_codec
(
ˇrd
, 
codec
);

1157 i‡(
ªt
 < 0)

1158  
ªt
;

1162 i‡(!
∂©f‹m
->
¥obed
 &&

1163 
∂©f‹m
->
drivî
->
¥obe_‹dî
 =
‹dî
) {

1164 
ªt
 = 
	`soc_¥obe_∂©f‹m
(
ˇrd
, 
∂©f‹m
);

1165 i‡(
ªt
 < 0)

1166  
ªt
;

1170 i‡(!
codec_dai
->
¥obed
 && codec_dai->
drivî
->
¥obe_‹dî
 =
‹dî
) {

1171 i‡(
codec_dai
->
drivî
->
¥obe
) {

1172 
ªt
 = 
codec_dai
->
drivî
->
	`¥obe
(codec_dai);

1173 i‡(
ªt
 < 0) {

1174 
	`¥ötk
(
KERN_ERR
 "asoc: failedÅoÖrobe CODEC DAI %s\n",

1175 
codec_dai
->
«me
);

1176  
ªt
;

1181 
codec_dai
->
¥obed
 = 1;

1182 
	`li°_add
(&
codec_dai
->
ˇrd_li°
, &
ˇrd
->
dai_dev_li°
);

1186 i‡(
‹dî
 !
SND_SOC_COMP_ORDER_LAST
)

1189 
ªt
 = 
	`soc_po°_comp⁄ít_öô
(
ˇrd
, 
codec
, 
num
, 0);

1190 i‡(
ªt
)

1191  
ªt
;

1193 
ªt
 = 
	`devi˚_¸óã_fûe
(&
πd
->
dev
, &
dev_©å_pmdown_time
);

1194 i‡(
ªt
 < 0)

1195 
	`¥ötk
(
KERN_WARNING
 "asoc: failedÅoáddÖmdown_time sysfs\n");

1198 
ªt
 = 
	`soc_√w_pcm
(
πd
, 
num
);

1199 i‡(
ªt
 < 0) {

1200 
	`¥ötk
(
KERN_ERR
 "asoc: c™'à¸óãÖcm %s\n", 
dai_lök
->
°ªam_«me
);

1201  
ªt
;

1205 i‡(
πd
->
codec_dai
->
drivî
->
ac97_c⁄åﬁ
)

1206 
	`¢d_ac97_dev_add_pd©a
(
codec
->
ac97
, 
πd
->
˝u_dai
->
ac97_pd©a
);

1209 
	}
}

1211 #ifde‡
CONFIG_SND_SOC_AC97_BUS


1212 
	$soc_ªgi°î_ac97_dai_lök
(
¢d_soc_pcm_ru¡ime
 *
πd
)

1214 
ªt
;

1219 i‡(
πd
->
codec_dai
->
drivî
->
ac97_c⁄åﬁ
 && !πd->
codec
->
ac97_ªgi°îed
) {

1228 i‡(!
πd
->
codec
->
ac97_¸óãd
)

1231 
ªt
 = 
	`soc_ac97_dev_ªgi°î
(
πd
->
codec
);

1232 i‡(
ªt
 < 0) {

1233 
	`¥ötk
(
KERN_ERR
 "asoc: AC97 deviceÑegister failed\n");

1234  
ªt
;

1237 
πd
->
codec
->
ac97_ªgi°îed
 = 1;

1240 
	}
}

1242 
	$soc_uƒegi°î_ac97_dai_lök
(
¢d_soc_codec
 *
codec
)

1244 i‡(
codec
->
ac97_ªgi°îed
) {

1245 
	`soc_ac97_dev_uƒegi°î
(
codec
);

1246 
codec
->
ac97_ªgi°îed
 = 0;

1248 
	}
}

1251 
	$soc_¥obe_aux_dev
(
¢d_soc_ˇrd
 *
ˇrd
, 
num
)

1253 
¢d_soc_aux_dev
 *
aux_dev
 = &
ˇrd
->aux_dev[
num
];

1254 
¢d_soc_codec
 *
codec
;

1255 
ªt
 = -
ENODEV
;

1258 
	`li°_f‹_óch_íåy
(
codec
, &
codec_li°
, 
li°
) {

1259 i‡(!
	`°rcmp
(
codec
->
«me
, 
aux_dev
->
codec_«me
)) {

1260 i‡(
codec
->
¥obed
) {

1261 
	`dev_îr
(
codec
->
dev
,

1263 
ªt
 = -
EBUSY
;

1264 
out
;

1266 
found
;

1270 
	`dev_îr
(
ˇrd
->
dev
, "asoc: code¯%†nŸ found", 
aux_dev
->
codec_«me
);

1271 
out
;

1273 
found
:

1274 
ªt
 = 
	`soc_¥obe_codec
(
ˇrd
, 
codec
);

1275 i‡(
ªt
 < 0)

1276  
ªt
;

1278 
ªt
 = 
	`soc_po°_comp⁄ít_öô
(
ˇrd
, 
codec
, 
num
, 1);

1280 
out
:

1281  
ªt
;

1282 
	}
}

1284 
	$soc_ªmove_aux_dev
(
¢d_soc_ˇrd
 *
ˇrd
, 
num
)

1286 
¢d_soc_pcm_ru¡ime
 *
πd
 = &
ˇrd
->
πd_aux
[
num
];

1287 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

1290 i‡(
πd
->
dev_ªgi°îed
) {

1291 
	`devi˚_ªmove_fûe
(&
πd
->
dev
, &
dev_©å_codec_ªg
);

1292 
	`devi˚_uƒegi°î
(&
πd
->
dev
);

1293 
πd
->
dev_ªgi°îed
 = 0;

1296 i‡(
codec
 && codec->
¥obed
)

1297 
	`soc_ªmove_codec
(
codec
);

1298 
	}
}

1300 
	$¢d_soc_öô_codec_ˇche
(
¢d_soc_codec
 *
codec
,

1301 
¢d_soc_com¥ess_ty≥
 
com¥ess_ty≥
)

1303 
ªt
;

1305 i‡(
codec
->
ˇche_öô
)

1309 i‡(
com¥ess_ty≥
 && 
codec
->compress_type != compress_type)

1310 
codec
->
com¥ess_ty≥
 = compress_type;

1311 
ªt
 = 
	`¢d_soc_ˇche_öô
(
codec
);

1312 i‡(
ªt
 < 0) {

1313 
	`dev_îr
(
codec
->
dev
, "FailedÅo set cache compressionÅype: %d\n",

1314 
ªt
);

1315  
ªt
;

1317 
codec
->
ˇche_öô
 = 1;

1319 
	}
}

1321 
	$¢d_soc_ö°™tüã_ˇrd
(
¢d_soc_ˇrd
 *
ˇrd
)

1323 
¢d_soc_codec
 *
codec
;

1324 
¢d_soc_codec_c⁄f
 *
codec_c⁄f
;

1325 
¢d_soc_com¥ess_ty≥
 
com¥ess_ty≥
;

1326 
¢d_soc_dai_lök
 *
dai_lök
;

1327 
ªt
, 
i
, 
‹dî
;

1329 
	`muãx_lock
(&
ˇrd
->
muãx
);

1331 i‡(
ˇrd
->
ö°™tüãd
) {

1332 
	`muãx_u∆ock
(&
ˇrd
->
muãx
);

1337 
i
 = 0; i < 
ˇrd
->
num_löks
; i++)

1338 
	`soc_böd_dai_lök
(
ˇrd
, 
i
);

1341 i‡(
ˇrd
->
num_πd
 !ˇrd->
num_löks
) {

1342 
	`muãx_u∆ock
(&
ˇrd
->
muãx
);

1347 
	`li°_f‹_óch_íåy
(
codec
, &
codec_li°
, 
li°
) {

1348 i‡(
codec
->
ˇche_öô
)

1351 
com¥ess_ty≥
 = 0;

1353 
i
 = 0; i < 
ˇrd
->
num_c⁄figs
; ++i) {

1354 
codec_c⁄f
 = &
ˇrd
->codec_c⁄f[
i
];

1355 i‡(!
	`°rcmp
(
codec
->
«me
, 
codec_c⁄f
->
dev_«me
)) {

1356 
com¥ess_ty≥
 = 
codec_c⁄f
->compress_type;

1357 i‡(
com¥ess_ty≥
 && compress_type

1358 !
codec
->
com¥ess_ty≥
)

1362 
ªt
 = 
	`¢d_soc_öô_codec_ˇche
(
codec
, 
com¥ess_ty≥
);

1363 i‡(
ªt
 < 0) {

1364 
	`muãx_u∆ock
(&
ˇrd
->
muãx
);

1370 
ªt
 = 
	`¢d_ˇrd_¸óã
(
SNDRV_DEFAULT_IDX1
, 
SNDRV_DEFAULT_STR1
,

1371 
ˇrd
->
ow√r
, 0, &ˇrd->
¢d_ˇrd
);

1372 i‡(
ªt
 < 0) {

1373 
	`¥ötk
(
KERN_ERR
 "asoc: can't create sound card for card %s\n",

1374 
ˇrd
->
«me
);

1375 
	`muãx_u∆ock
(&
ˇrd
->
muãx
);

1378 
ˇrd
->
¢d_ˇrd
->
dev
 = card->dev;

1380 
ˇrd
->
d≠m
.
büs_Àvñ
 = 
SND_SOC_BIAS_OFF
;

1381 
ˇrd
->
d≠m
.
dev
 = card->dev;

1382 
ˇrd
->
d≠m
.card = card;

1383 
	`li°_add
(&
ˇrd
->
d≠m
.
li°
, &ˇrd->
d≠m_li°
);

1385 #ifde‡
CONFIG_DEBUG_FS


1386 
	`¢d_soc_d≠m_debugfs_öô
(&
ˇrd
->
d≠m
, c¨d->
debugfs_ˇrd_roŸ
);

1389 #ifde‡
CONFIG_PM_SLEEP


1391 
	`INIT_WORK
(&
ˇrd
->
de„ºed_ªsume_w‹k
, 
soc_ªsume_de„ºed
);

1394 i‡(
ˇrd
->
d≠m_widgës
)

1395 
	`¢d_soc_d≠m_√w_c⁄åﬁs
(&
ˇrd
->
d≠m
, c¨d->
d≠m_widgës
,

1396 
ˇrd
->
num_d≠m_widgës
);

1399 i‡(
ˇrd
->
¥obe
) {

1400 
ªt
 = 
ˇrd
->
	`¥obe
(card);

1401 i‡(
ªt
 < 0)

1402 
ˇrd_¥obe_îr‹
;

1406 
‹dî
 = 
SND_SOC_COMP_ORDER_FIRST
; ordî <
SND_SOC_COMP_ORDER_LAST
;

1407 
‹dî
++) {

1408 
i
 = 0; i < 
ˇrd
->
num_löks
; i++) {

1409 
ªt
 = 
	`soc_¥obe_dai_lök
(
ˇrd
, 
i
, 
‹dî
);

1410 i‡(
ªt
 < 0) {

1411 
	`¥_îr
("asoc: failedÅo instantiate card %s: %d\n",

1412 
ˇrd
->
«me
, 
ªt
);

1413 
¥obe_dai_îr
;

1418 
i
 = 0; i < 
ˇrd
->
num_aux_devs
; i++) {

1419 
ªt
 = 
	`soc_¥obe_aux_dev
(
ˇrd
, 
i
);

1420 i‡(
ªt
 < 0) {

1421 
	`¥_îr
("asoc: failedÅoáddáuxiliary devices %s: %d\n",

1422 
ˇrd
->
«me
, 
ªt
);

1423 
¥obe_aux_dev_îr
;

1428 i‡(
ˇrd
->
c⁄åﬁs
)

1429 
	`¢d_soc_add_c⁄åﬁs
(
	`li°_fú°_íåy
(&
ˇrd
->
codec_dev_li°
,

1430 
¢d_soc_codec
,

1431 
ˇrd_li°
),

1432 
ˇrd
->
c⁄åﬁs
,

1433 
ˇrd
->
num_c⁄åﬁs
);

1435 i‡(
ˇrd
->
d≠m_rouãs
)

1436 
	`¢d_soc_d≠m_add_rouãs
(&
ˇrd
->
d≠m
, c¨d->
d≠m_rouãs
,

1437 
ˇrd
->
num_d≠m_rouãs
);

1439 
	`¢d_soc_d≠m_√w_widgës
(&
ˇrd
->
d≠m
);

1441 
i
 = 0; i < 
ˇrd
->
num_löks
; i++) {

1442 
dai_lök
 = &
ˇrd
->dai_lök[
i
];

1443 
	`¥ötk
(
KERN_ERR
 "!!! dai_fmt: %#x\n", 
dai_lök
->
dai_fmt
);

1445 i‡(
dai_lök
->
dai_fmt
) {

1446 
ªt
 = 
	`¢d_soc_dai_£t_fmt
(
ˇrd
->
πd
[
i
].
codec_dai
,

1447 
dai_lök
->
dai_fmt
);

1448 i‡(
ªt
 != 0)

1449 
	`dev_w¨n
(
ˇrd
->
πd
[
i
].
codec_dai
->
dev
,

1451 
ªt
);

1453 
ªt
 = 
	`¢d_soc_dai_£t_fmt
(
ˇrd
->
πd
[
i
].
˝u_dai
,

1454 
dai_lök
->
dai_fmt
);

1455 i‡(
ªt
 != 0)

1456 
	`dev_w¨n
(
ˇrd
->
πd
[
i
].
˝u_dai
->
dev
,

1458 
ªt
);

1462 
	`¢¥ötf
(
ˇrd
->
¢d_ˇrd
->
sh‹äame
, (card->snd_card->shortname),

1463 "%s", 
ˇrd
->
«me
);

1464 
	`¢¥ötf
(
ˇrd
->
¢d_ˇrd
->
l⁄g«me
, (card->snd_card->longname),

1465 "%s", 
ˇrd
->
l⁄g_«me
 ? c¨d->l⁄g_«mê: c¨d->
«me
);

1466 
	`¢¥ötf
(
ˇrd
->
¢d_ˇrd
->
drivî
, (card->snd_card->driver),

1467 "%s", 
ˇrd
->
drivî_«me
 ? c¨d->drivî_«mê: c¨d->
«me
);

1468 
i
 = 0; i < 
	`ARRAY_SIZE
(
ˇrd
->
¢d_ˇrd
->
drivî
); i++) {

1469 
ˇrd
->
¢d_ˇrd
->
drivî
[
i
]) {

1475 i‡(!
	`iß um
(
ˇrd
->
¢d_ˇrd
->
drivî
[
i
]))

1476 
ˇrd
->
¢d_ˇrd
->
drivî
[
i
] = '_';

1481 i‡(
ˇrd
->
œã_¥obe
) {

1482 
ªt
 = 
ˇrd
->
	`œã_¥obe
(card);

1483 i‡(
ªt
 < 0) {

1484 
	`dev_îr
(
ˇrd
->
dev
, "%sÜate_probe() failed: %d\n",

1485 
ˇrd
->
«me
, 
ªt
);

1486 
¥obe_aux_dev_îr
;

1490 
	`¢d_soc_d≠m_√w_widgës
(&
ˇrd
->
d≠m
);

1492 
ªt
 = 
	`¢d_ˇrd_ªgi°î
(
ˇrd
->
¢d_ˇrd
);

1493 i‡(
ªt
 < 0) {

1494 
	`¥ötk
(
KERN_ERR
 "asoc: faûedÅÿªgi°î soundˇrd f‹ %s\n", 
ˇrd
->
«me
);

1495 
¥obe_aux_dev_îr
;

1498 #ifde‡
CONFIG_SND_SOC_AC97_BUS


1500 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

1501 
ªt
 = 
	`soc_ªgi°î_ac97_dai_lök
(&
ˇrd
->
πd
[
i
]);

1502 i‡(
ªt
 < 0) {

1503 
	`¥ötk
(
KERN_ERR
 "asoc: faûedÅÿªgi°î AC97 %s\n", 
ˇrd
->
«me
);

1504 --
i
 >= 0)

1505 
	`soc_uƒegi°î_ac97_dai_lök
(
ˇrd
->
πd
[
i
].
codec
);

1506 
¥obe_aux_dev_îr
;

1511 
ˇrd
->
ö°™tüãd
 = 1;

1512 
	`¢d_soc_d≠m_sync
(&
ˇrd
->
d≠m
);

1513 
	`muãx_u∆ock
(&
ˇrd
->
muãx
);

1516 
¥obe_aux_dev_îr
:

1517 
i
 = 0; i < 
ˇrd
->
num_aux_devs
; i++)

1518 
	`soc_ªmove_aux_dev
(
ˇrd
, 
i
);

1520 
¥obe_dai_îr
:

1521 
	`soc_ªmove_dai_löks
(
ˇrd
);

1523 
ˇrd_¥obe_îr‹
:

1524 i‡(
ˇrd
->
ªmove
)

1525 
ˇrd
->
	`ªmove
(card);

1527 
	`¢d_ˇrd_‰ì
(
ˇrd
->
¢d_ˇrd
);

1529 
	`muãx_u∆ock
(&
ˇrd
->
muãx
);

1530 
	}
}

1536 
	$¢d_soc_ö°™tüã_ˇrds
()

1538 
¢d_soc_ˇrd
 *
ˇrd
;

1539 
	`li°_f‹_óch_íåy
(
ˇrd
, &
ˇrd_li°
, 
li°
)

1540 
	`¢d_soc_ö°™tüã_ˇrd
(
ˇrd
);

1541 
	}
}

1544 
	$soc_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

1546 
¢d_soc_ˇrd
 *
ˇrd
 = 
	`∂©f‹m_gë_drvd©a
(
pdev
);

1547 
ªt
 = 0;

1553 i‡(!
ˇrd
)

1554  -
EINVAL
;

1557 
ˇrd
->
dev
 = &
pdev
->dev;

1559 
ªt
 = 
	`¢d_soc_ªgi°î_ˇrd
(
ˇrd
);

1560 i‡(
ªt
 != 0) {

1561 
	`dev_îr
(&
pdev
->
dev
, "FailedÅoÑegister card\n");

1562  
ªt
;

1566 
	}
}

1568 
	$soc_˛ónup_ˇrd_ªsour˚s
(
¢d_soc_ˇrd
 *
ˇrd
)

1570 
i
;

1573 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

1574 
¢d_soc_pcm_ru¡ime
 *
πd
 = &
ˇrd
->πd[
i
];

1575 
	`Êush_dñayed_w‹k_sync
(&
πd
->
dñayed_w‹k
);

1579 
i
 = 0; i < 
ˇrd
->
num_aux_devs
; i++)

1580 
	`soc_ªmove_aux_dev
(
ˇrd
, 
i
);

1583 
	`soc_ªmove_dai_löks
(
ˇrd
);

1585 
	`soc_˛ónup_ˇrd_debugfs
(
ˇrd
);

1588 i‡(
ˇrd
->
ªmove
)

1589 
ˇrd
->
	`ªmove
(card);

1591 
	`¢d_soc_d≠m_‰ì
(&
ˇrd
->
d≠m
);

1593 
	`k‰ì
(
ˇrd
->
πd
);

1594 
	`¢d_ˇrd_‰ì
(
ˇrd
->
¢d_ˇrd
);

1597 
	}
}

1600 
	$soc_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

1602 
¢d_soc_ˇrd
 *
ˇrd
 = 
	`∂©f‹m_gë_drvd©a
(
pdev
);

1604 
	`¢d_soc_uƒegi°î_ˇrd
(
ˇrd
);

1606 
	}
}

1608 
	$¢d_soc_powîoff
(
devi˚
 *
dev
)

1610 
¢d_soc_ˇrd
 *
ˇrd
 = 
	`dev_gë_drvd©a
(
dev
);

1611 
i
;

1613 i‡(!
ˇrd
->
ö°™tüãd
)

1618 
i
 = 0; i < 
ˇrd
->
num_πd
; i++) {

1619 
¢d_soc_pcm_ru¡ime
 *
πd
 = &
ˇrd
->πd[
i
];

1620 
	`Êush_dñayed_w‹k_sync
(&
πd
->
dñayed_w‹k
);

1623 
	`¢d_soc_d≠m_shutdown
(
ˇrd
);

1626 
	}
}

1627 
EXPORT_SYMBOL_GPL
(
¢d_soc_powîoff
);

1629 c⁄° 
dev_pm_›s
 
	g¢d_soc_pm_›s
 = {

1630 .
su•íd
 = 
¢d_soc_su•íd
,

1631 .
	gªsume
 = 
¢d_soc_ªsume
,

1632 .
	gpowîoff
 = 
¢d_soc_powîoff
,

1634 
EXPORT_SYMBOL_GPL
(
¢d_soc_pm_›s
);

1637 
∂©f‹m_drivî
 
	gsoc_drivî
 = {

1638 .
drivî
 = {

1639 .
«me
 = "soc-audio",

1640 .
	gow√r
 = 
THIS_MODULE
,

1641 .
	gpm
 = &
¢d_soc_pm_›s
,

1643 .
	g¥obe
 = 
soc_¥obe
,

1644 .
	gªmove
 = 
soc_ªmove
,

1655 
	$¢d_soc_codec_vﬁ©ûe_ªgi°î
(
¢d_soc_codec
 *
codec
,

1656 
ªg
)

1658 i‡(
codec
->
vﬁ©ûe_ªgi°î
)

1659  
codec
->
	`vﬁ©ûe_ªgi°î
(codec, 
ªg
);

1662 
	}
}

1663 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_vﬁ©ûe_ªgi°î
);

1673 
	$¢d_soc_codec_ªadabÀ_ªgi°î
(
¢d_soc_codec
 *
codec
,

1674 
ªg
)

1676 i‡(
codec
->
ªadabÀ_ªgi°î
)

1677  
codec
->
	`ªadabÀ_ªgi°î
(codec, 
ªg
);

1680 
	}
}

1681 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_ªadabÀ_ªgi°î
);

1691 
	$¢d_soc_codec_wrôabÀ_ªgi°î
(
¢d_soc_codec
 *
codec
,

1692 
ªg
)

1694 i‡(
codec
->
wrôabÀ_ªgi°î
)

1695  
codec
->
	`wrôabÀ_ªgi°î
(codec, 
ªg
);

1698 
	}
}

1699 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_wrôabÀ_ªgi°î
);

1701 
	$¢d_soc_∂©f‹m_ªad
(
¢d_soc_∂©f‹m
 *
∂©f‹m
,

1702 
ªg
)

1704 
ªt
;

1706 i‡(!
∂©f‹m
->
drivî
->
ªad
) {

1707 
	`dev_îr
(
∂©f‹m
->
dev
, "platform hasÇoÑead back\n");

1711 
ªt
 = 
∂©f‹m
->
drivî
->
	`ªad
’œtf‹m, 
ªg
);

1712 
	`dev_dbg
(
∂©f‹m
->
dev
, "ªad %x => %x\n", 
ªg
, 
ªt
);

1713 
	`åa˚_¢d_soc_¥eg_ªad
(
∂©f‹m
, 
ªg
, 
ªt
);

1715  
ªt
;

1716 
	}
}

1717 
EXPORT_SYMBOL_GPL
(
¢d_soc_∂©f‹m_ªad
);

1719 
	$¢d_soc_∂©f‹m_wrôe
(
¢d_soc_∂©f‹m
 *
∂©f‹m
,

1720 
ªg
, 
vÆ
)

1722 i‡(!
∂©f‹m
->
drivî
->
wrôe
) {

1723 
	`dev_îr
(
∂©f‹m
->
dev
, "platform hasÇo write back\n");

1727 
	`dev_dbg
(
∂©f‹m
->
dev
, "wrôê%x = %x\n", 
ªg
, 
vÆ
);

1728 
	`åa˚_¢d_soc_¥eg_wrôe
(
∂©f‹m
, 
ªg
, 
vÆ
);

1729  
∂©f‹m
->
drivî
->
	`wrôe
’œtf‹m, 
ªg
, 
vÆ
);

1730 
	}
}

1731 
EXPORT_SYMBOL_GPL
(
¢d_soc_∂©f‹m_wrôe
);

1741 
	$¢d_soc_√w_ac97_codec
(
¢d_soc_codec
 *
codec
,

1742 
¢d_ac97_bus_›s
 *
›s
, 
num
)

1744 
	`muãx_lock
(&
codec
->
muãx
);

1746 
codec
->
ac97
 = 
	`kzÆloc
((
¢d_ac97
), 
GFP_KERNEL
);

1747 i‡(
codec
->
ac97
 =
NULL
) {

1748 
	`muãx_u∆ock
(&
codec
->
muãx
);

1749  -
ENOMEM
;

1752 
codec
->
ac97
->
bus
 = 
	`kzÆloc
((
¢d_ac97_bus
), 
GFP_KERNEL
);

1753 i‡(
codec
->
ac97
->
bus
 =
NULL
) {

1754 
	`k‰ì
(
codec
->
ac97
);

1755 
codec
->
ac97
 = 
NULL
;

1756 
	`muãx_u∆ock
(&
codec
->
muãx
);

1757  -
ENOMEM
;

1760 
codec
->
ac97
->
bus
->
›s
 = ops;

1761 
codec
->
ac97
->
num
 =Çum;

1767 
codec
->
ac97_¸óãd
 = 1;

1769 
	`muãx_u∆ock
(&
codec
->
muãx
);

1771 
	}
}

1772 
EXPORT_SYMBOL_GPL
(
¢d_soc_√w_ac97_codec
);

1780 
	$¢d_soc_‰ì_ac97_codec
(
¢d_soc_codec
 *
codec
)

1782 
	`muãx_lock
(&
codec
->
muãx
);

1783 #ifde‡
CONFIG_SND_SOC_AC97_BUS


1784 
	`soc_uƒegi°î_ac97_dai_lök
(
codec
);

1786 
	`k‰ì
(
codec
->
ac97
->
bus
);

1787 
	`k‰ì
(
codec
->
ac97
);

1788 
codec
->
ac97
 = 
NULL
;

1789 
codec
->
ac97_¸óãd
 = 0;

1790 
	`muãx_u∆ock
(&
codec
->
muãx
);

1791 
	}
}

1792 
EXPORT_SYMBOL_GPL
(
¢d_soc_‰ì_ac97_codec
);

1794 
	$¢d_soc_ªad
(
¢d_soc_codec
 *
codec
, 
ªg
)

1796 
ªt
;

1798 
ªt
 = 
codec
->
	`ªad
(codec, 
ªg
);

1799 
	`dev_dbg
(
codec
->
dev
, "ªad %x => %x\n", 
ªg
, 
ªt
);

1800 
	`åa˚_¢d_soc_ªg_ªad
(
codec
, 
ªg
, 
ªt
);

1802  
ªt
;

1803 
	}
}

1804 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªad
);

1806 
	$¢d_soc_wrôe
(
¢d_soc_codec
 *
codec
,

1807 
ªg
, 
vÆ
)

1809 
	`dev_dbg
(
codec
->
dev
, "wrôê%x = %x\n", 
ªg
, 
vÆ
);

1810 
	`åa˚_¢d_soc_ªg_wrôe
(
codec
, 
ªg
, 
vÆ
);

1811  
codec
->
	`wrôe
(codec, 
ªg
, 
vÆ
);

1812 
	}
}

1813 
EXPORT_SYMBOL_GPL
(
¢d_soc_wrôe
);

1815 
	$¢d_soc_bulk_wrôe_øw
(
¢d_soc_codec
 *
codec
,

1816 
ªg
, c⁄° *
d©a
, 
size_t
 
Àn
)

1818  
codec
->
	`bulk_wrôe_øw
(codec, 
ªg
, 
d©a
, 
Àn
);

1819 
	}
}

1820 
EXPORT_SYMBOL_GPL
(
¢d_soc_bulk_wrôe_øw
);

1833 
	$¢d_soc_upd©e_bôs
(
¢d_soc_codec
 *
codec
, 
ªg
,

1834 
mask
, 
vÆue
)

1836 
ch™ge
;

1837 
ﬁd
, 
√w
;

1838 
ªt
;

1840 
ªt
 = 
	`¢d_soc_ªad
(
codec
, 
ªg
);

1841 i‡(
ªt
 < 0)

1842  
ªt
;

1844 
ﬁd
 = 
ªt
;

1845 
√w
 = (
ﬁd
 & ~
mask
Ë| (
vÆue
 & mask);

1846 
ch™ge
 = 
ﬁd
 !
√w
;

1847 i‡(
ch™ge
) {

1848 
ªt
 = 
	`¢d_soc_wrôe
(
codec
, 
ªg
, 
√w
);

1849 i‡(
ªt
 < 0)

1850  
ªt
;

1853  
ch™ge
;

1854 
	}
}

1855 
EXPORT_SYMBOL_GPL
(
¢d_soc_upd©e_bôs
);

1868 
	$¢d_soc_upd©e_bôs_locked
(
¢d_soc_codec
 *
codec
,

1869 
ªg
, 
mask
,

1870 
vÆue
)

1872 
ch™ge
;

1874 
	`muãx_lock
(&
codec
->
muãx
);

1875 
ch™ge
 = 
	`¢d_soc_upd©e_bôs
(
codec
, 
ªg
, 
mask
, 
vÆue
);

1876 
	`muãx_u∆ock
(&
codec
->
muãx
);

1878  
ch™ge
;

1879 
	}
}

1880 
EXPORT_SYMBOL_GPL
(
¢d_soc_upd©e_bôs_locked
);

1894 
	$¢d_soc_ã°_bôs
(
¢d_soc_codec
 *
codec
, 
ªg
,

1895 
mask
, 
vÆue
)

1897 
ch™ge
;

1898 
ﬁd
, 
√w
;

1900 
ﬁd
 = 
	`¢d_soc_ªad
(
codec
, 
ªg
);

1901 
√w
 = (
ﬁd
 & ~
mask
Ë| 
vÆue
;

1902 
ch™ge
 = 
ﬁd
 !
√w
;

1904  
ch™ge
;

1905 
	}
}

1906 
EXPORT_SYMBOL_GPL
(
¢d_soc_ã°_bôs
);

1915 
	$¢d_soc_£t_ru¡ime_hw∑øms
(
¢d_pcm_sub°ªam
 *
sub°ªam
,

1916 c⁄° 
¢d_pcm_h¨dw¨e
 *
hw
)

1918 
¢d_pcm_ru¡ime
 *
ru¡ime
 = 
sub°ªam
->runtime;

1919 
ru¡ime
->
hw
.
öfo
 = hw->info;

1920 
ru¡ime
->
hw
.
f‹m©s
 = hw->formats;

1921 
ru¡ime
->
hw
.
≥riod_byãs_mö
 = hw->period_bytes_min;

1922 
ru¡ime
->
hw
.
≥riod_byãs_max
 = hw->period_bytes_max;

1923 
ru¡ime
->
hw
.
≥riods_mö
 = hw->periods_min;

1924 
ru¡ime
->
hw
.
≥riods_max
 = hw->periods_max;

1925 
ru¡ime
->
hw
.
buf„r_byãs_max
 = hw->buffer_bytes_max;

1926 
ru¡ime
->
hw
.
fifo_size
 = hw->fifo_size;

1928 
	}
}

1929 
EXPORT_SYMBOL_GPL
(
¢d_soc_£t_ru¡ime_hw∑øms
);

1942 
¢d_kc⁄åﬁ
 *
	$¢d_soc_˙ew
(c⁄° 
¢d_kc⁄åﬁ_√w
 *
_ãm∂©e
,

1943 *
d©a
, *
l⁄g_«me
,

1944 c⁄° *
¥efix
)

1946 
¢d_kc⁄åﬁ_√w
 
ãm∂©e
;

1947 
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
;

1948 *
«me
 = 
NULL
;

1949 
«me_Àn
;

1951 
	`mem˝y
(&
ãm∂©e
, 
_ãm∂©e
, (template));

1952 
ãm∂©e
.
ödex
 = 0;

1954 i‡(!
l⁄g_«me
)

1955 
l⁄g_«me
 = 
ãm∂©e
.
«me
;

1957 i‡(
¥efix
) {

1958 
«me_Àn
 = 
	`°æí
(
l⁄g_«me
Ë+ såÀn(
¥efix
) + 2;

1959 
«me
 = 
	`kmÆloc
(
«me_Àn
, 
GFP_KERNEL
);

1960 i‡(!
«me
)

1961  
NULL
;

1963 
	`¢¥ötf
(
«me
, 
«me_Àn
, "%†%s", 
¥efix
, 
l⁄g_«me
);

1965 
ãm∂©e
.
«me
 =Çame;

1967 
ãm∂©e
.
«me
 = 
l⁄g_«me
;

1970 
kc⁄åﬁ
 = 
	`¢d_˘l_√w1
(&
ãm∂©e
, 
d©a
);

1972 
	`k‰ì
(
«me
);

1974  
kc⁄åﬁ
;

1975 
	}
}

1976 
EXPORT_SYMBOL_GPL
(
¢d_soc_˙ew
);

1989 
	$¢d_soc_add_c⁄åﬁs
(
¢d_soc_codec
 *
codec
,

1990 c⁄° 
¢d_kc⁄åﬁ_√w
 *
c⁄åﬁs
, 
num_c⁄åﬁs
)

1992 
¢d_ˇrd
 *
ˇrd
 = 
codec
->card->snd_card;

1993 
îr
, 
i
;

1995 
i
 = 0; i < 
num_c⁄åﬁs
; i++) {

1996 c⁄° 
¢d_kc⁄åﬁ_√w
 *
c⁄åﬁ
 = &
c⁄åﬁs
[
i
];

1997 
îr
 = 
	`¢d_˘l_add
(
ˇrd
, 
	`¢d_soc_˙ew
(
c⁄åﬁ
, 
codec
,

1998 
c⁄åﬁ
->
«me
,

1999 
codec
->
«me_¥efix
));

2000 i‡(
îr
 < 0) {

2001 
	`dev_îr
(
codec
->
dev
, "%s: FailedÅoádd %s: %d\n",

2002 
codec
->
«me
, 
c⁄åﬁ
->«me, 
îr
);

2003  
îr
;

2008 
	}
}

2009 
EXPORT_SYMBOL_GPL
(
¢d_soc_add_c⁄åﬁs
);

2021 
	$¢d_soc_add_∂©f‹m_c⁄åﬁs
(
¢d_soc_∂©f‹m
 *
∂©f‹m
,

2022 c⁄° 
¢d_kc⁄åﬁ_√w
 *
c⁄åﬁs
, 
num_c⁄åﬁs
)

2024 
¢d_ˇrd
 *
ˇrd
 = 
∂©f‹m
->card->snd_card;

2025 
îr
, 
i
;

2027 
i
 = 0; i < 
num_c⁄åﬁs
; i++) {

2028 c⁄° 
¢d_kc⁄åﬁ_√w
 *
c⁄åﬁ
 = &
c⁄åﬁs
[
i
];

2029 
îr
 = 
	`¢d_˘l_add
(
ˇrd
, 
	`¢d_soc_˙ew
(
c⁄åﬁ
, 
∂©f‹m
,

2030 
c⁄åﬁ
->
«me
, 
NULL
));

2031 i‡(
îr
 < 0) {

2032 
	`dev_îr
(
∂©f‹m
->
dev
, "FaûedÅÿadd %†%d\n",
c⁄åﬁ
->
«me
, 
îr
);

2033  
îr
;

2038 
	}
}

2039 
EXPORT_SYMBOL_GPL
(
¢d_soc_add_∂©f‹m_c⁄åﬁs
);

2051 
	$¢d_soc_öfo_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2052 
¢d_˘l_ñem_öfo
 *
uöfo
)

2054 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2056 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_ENUMERATED
;

2057 
uöfo
->
cou¡
 = 
e
->
shi·_l
 =e->
shi·_r
 ? 1 : 2;

2058 
uöfo
->
vÆue
.
íumî©ed
.
ôems
 = 
e
->
max
;

2060 i‡(
uöfo
->
vÆue
.
íumî©ed
.
ôem
 > 
e
->
max
 - 1)

2061 
uöfo
->
vÆue
.
íumî©ed
.
ôem
 = 
e
->
max
 - 1;

2062 
	`°r˝y
(
uöfo
->
vÆue
.
íumî©ed
.
«me
,

2063 
e
->
ãxts
[
uöfo
->
vÆue
.
íumî©ed
.
ôem
]);

2065 
	}
}

2066 
EXPORT_SYMBOL_GPL
(
¢d_soc_öfo_íum_doubÀ
);

2077 
	$¢d_soc_gë_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2078 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2080 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2081 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2082 
vÆ
, 
bômask
;

2084 
bômask
 = 1; bômask < 
e
->
max
; bitmask <<= 1)

2086 
vÆ
 = 
	`¢d_soc_ªad
(
codec
, 
e
->
ªg
);

2087 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0]

2088 (
vÆ
 >> 
e
->
shi·_l
Ë& (
bômask
 - 1);

2089 i‡(
e
->
shi·_l
 !e->
shi·_r
)

2090 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] =

2091 (
vÆ
 >> 
e
->
shi·_r
Ë& (
bômask
 - 1);

2094 
	}
}

2095 
EXPORT_SYMBOL_GPL
(
¢d_soc_gë_íum_doubÀ
);

2106 
	$¢d_soc_put_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2107 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2109 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2110 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2111 
vÆ
;

2112 
mask
, 
bômask
;

2114 
bômask
 = 1; bômask < 
e
->
max
; bitmask <<= 1)

2116 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] > 
e
->
max
 - 1)

2117  -
EINVAL
;

2118 
vÆ
 = 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] << 
e
->
shi·_l
;

2119 
mask
 = (
bômask
 - 1Ë<< 
e
->
shi·_l
;

2120 i‡(
e
->
shi·_l
 !e->
shi·_r
) {

2121 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] > 
e
->
max
 - 1)

2122  -
EINVAL
;

2123 
vÆ
 |
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] << 
e
->
shi·_r
;

2124 
mask
 |(
bômask
 - 1Ë<< 
e
->
shi·_r
;

2127  
	`¢d_soc_upd©e_bôs_locked
(
codec
, 
e
->
ªg
, 
mask
, 
vÆ
);

2128 
	}
}

2129 
EXPORT_SYMBOL_GPL
(
¢d_soc_put_íum_doubÀ
);

2143 
	$¢d_soc_gë_vÆue_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2144 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2146 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2147 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2148 
ªg_vÆ
, 
vÆ
, 
mux
;

2150 
ªg_vÆ
 = 
	`¢d_soc_ªad
(
codec
, 
e
->
ªg
);

2151 
vÆ
 = (
ªg_vÆ
 >> 
e
->
shi·_l
Ë&É->
mask
;

2152 
mux
 = 0; mux < 
e
->
max
; mux++) {

2153 i‡(
vÆ
 =
e
->
vÆues
[
mux
])

2156 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] = 
mux
;

2157 i‡(
e
->
shi·_l
 !e->
shi·_r
) {

2158 
vÆ
 = (
ªg_vÆ
 >> 
e
->
shi·_r
Ë&É->
mask
;

2159 
mux
 = 0; mux < 
e
->
max
; mux++) {

2160 i‡(
vÆ
 =
e
->
vÆues
[
mux
])

2163 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] = 
mux
;

2167 
	}
}

2168 
EXPORT_SYMBOL_GPL
(
¢d_soc_gë_vÆue_íum_doubÀ
);

2182 
	$¢d_soc_put_vÆue_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2183 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2185 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2186 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2187 
vÆ
;

2188 
mask
;

2190 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] > 
e
->
max
 - 1)

2191  -
EINVAL
;

2192 
vÆ
 = 
e
->
vÆues
[
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0]] <<É->
shi·_l
;

2193 
mask
 = 
e
->mask <<É->
shi·_l
;

2194 i‡(
e
->
shi·_l
 !e->
shi·_r
) {

2195 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] > 
e
->
max
 - 1)

2196  -
EINVAL
;

2197 
vÆ
 |
e
->
vÆues
[
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1]] <<É->
shi·_r
;

2198 
mask
 |
e
->mask <<É->
shi·_r
;

2201  
	`¢d_soc_upd©e_bôs_locked
(
codec
, 
e
->
ªg
, 
mask
, 
vÆ
);

2202 
	}
}

2203 
EXPORT_SYMBOL_GPL
(
¢d_soc_put_vÆue_íum_doubÀ
);

2215 
	$¢d_soc_öfo_íum_ext
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2216 
¢d_˘l_ñem_öfo
 *
uöfo
)

2218 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2220 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_ENUMERATED
;

2221 
uöfo
->
cou¡
 = 1;

2222 
uöfo
->
vÆue
.
íumî©ed
.
ôems
 = 
e
->
max
;

2224 i‡(
uöfo
->
vÆue
.
íumî©ed
.
ôem
 > 
e
->
max
 - 1)

2225 
uöfo
->
vÆue
.
íumî©ed
.
ôem
 = 
e
->
max
 - 1;

2226 
	`°r˝y
(
uöfo
->
vÆue
.
íumî©ed
.
«me
,

2227 
e
->
ãxts
[
uöfo
->
vÆue
.
íumî©ed
.
ôem
]);

2229 
	}
}

2230 
EXPORT_SYMBOL_GPL
(
¢d_soc_öfo_íum_ext
);

2241 
	$¢d_soc_öfo_vﬁsw_ext
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2242 
¢d_˘l_ñem_öfo
 *
uöfo
)

2244 
max
 = 
kc⁄åﬁ
->
¥iv©e_vÆue
;

2246 i‡(
max
 =1 && !
	`°r°r
(
kc⁄åﬁ
->
id
.
«me
, " Volume"))

2247 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_BOOLEAN
;

2249 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_INTEGER
;

2251 
uöfo
->
cou¡
 = 1;

2252 
uöfo
->
vÆue
.
öãgî
.
mö
 = 0;

2253 
uöfo
->
vÆue
.
öãgî
.
max
 = max;

2255 
	}
}

2256 
EXPORT_SYMBOL_GPL
(
¢d_soc_öfo_vﬁsw_ext
);

2268 
	$¢d_soc_öfo_vﬁsw
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2269 
¢d_˘l_ñem_öfo
 *
uöfo
)

2271 
soc_mixî_c⁄åﬁ
 *
mc
 =

2272 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2273 
∂©f‹m_max
;

2275 i‡(!
mc
->
∂©f‹m_max
)

2276 
mc
->
∂©f‹m_max
 = mc->
max
;

2277 
∂©f‹m_max
 = 
mc
->platform_max;

2279 i‡(
∂©f‹m_max
 =1 && !
	`°r°r
(
kc⁄åﬁ
->
id
.
«me
, " Volume"))

2280 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_BOOLEAN
;

2282 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_INTEGER
;

2284 
uöfo
->
cou¡
 = 
	`¢d_soc_vﬁsw_is_°îeo
(
mc
) ? 2 : 1;

2285 
uöfo
->
vÆue
.
öãgî
.
mö
 = 0;

2286 
uöfo
->
vÆue
.
öãgî
.
max
 = 
∂©f‹m_max
;

2288 
	}
}

2289 
EXPORT_SYMBOL_GPL
(
¢d_soc_öfo_vﬁsw
);

2301 
	$¢d_soc_gë_vﬁsw
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2302 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2304 
soc_mixî_c⁄åﬁ
 *
mc
 =

2305 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2306 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2307 
ªg
 = 
mc
->reg;

2308 
ªg2
 = 
mc
->
ºeg
;

2309 
shi·
 = 
mc
->shift;

2310 
rshi·
 = 
mc
->rshift;

2311 
max
 = 
mc
->max;

2312 
mask
 = (1 << 
	`Ês
(
max
)) - 1;

2313 
övît
 = 
mc
->invert;

2315 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0] =

2316 (
	`¢d_soc_ªad
(
codec
, 
ªg
Ë>> 
shi·
Ë& 
mask
;

2317 i‡(
övît
)

2318 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0] =

2319 
max
 - 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0];

2321 i‡(
	`¢d_soc_vﬁsw_is_°îeo
(
mc
)) {

2322 i‡(
ªg
 =
ªg2
)

2323 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1] =

2324 (
	`¢d_soc_ªad
(
codec
, 
ªg
Ë>> 
rshi·
Ë& 
mask
;

2326 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1] =

2327 (
	`¢d_soc_ªad
(
codec
, 
ªg2
Ë>> 
shi·
Ë& 
mask
;

2328 i‡(
övît
)

2329 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1] =

2330 
max
 - 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1];

2334 
	}
}

2335 
EXPORT_SYMBOL_GPL
(
¢d_soc_gë_vﬁsw
);

2347 
	$¢d_soc_put_vﬁsw
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2348 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2350 
soc_mixî_c⁄åﬁ
 *
mc
 =

2351 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2352 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2353 
ªg
 = 
mc
->reg;

2354 
ªg2
 = 
mc
->
ºeg
;

2355 
shi·
 = 
mc
->shift;

2356 
rshi·
 = 
mc
->rshift;

2357 
max
 = 
mc
->max;

2358 
mask
 = (1 << 
	`Ês
(
max
)) - 1;

2359 
övît
 = 
mc
->invert;

2360 
îr
;

2361 
boﬁ
 
ty≥_2r
 = 0;

2362 
vÆ2
 = 0;

2363 
vÆ
, 
vÆ_mask
;

2365 
vÆ
 = (
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[0] & 
mask
);

2366 i‡(
övît
)

2367 
vÆ
 = 
max
 - val;

2368 
vÆ_mask
 = 
mask
 << 
shi·
;

2369 
vÆ
 = vÆ << 
shi·
;

2370 i‡(
	`¢d_soc_vﬁsw_is_°îeo
(
mc
)) {

2371 
vÆ2
 = (
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[1] & 
mask
);

2372 i‡(
övît
)

2373 
vÆ2
 = 
max
 - val2;

2374 i‡(
ªg
 =
ªg2
) {

2375 
vÆ_mask
 |
mask
 << 
rshi·
;

2376 
vÆ
 |
vÆ2
 << 
rshi·
;

2378 
vÆ2
 = vÆ2 << 
shi·
;

2379 
ty≥_2r
 = 1;

2382 
îr
 = 
	`¢d_soc_upd©e_bôs_locked
(
codec
, 
ªg
, 
vÆ_mask
, 
vÆ
);

2383 i‡(
îr
 < 0)

2384  
îr
;

2386 i‡(
ty≥_2r
)

2387 
îr
 = 
	`¢d_soc_upd©e_bôs_locked
(
codec
, 
ªg2
, 
vÆ_mask
, 
vÆ2
);

2389  
îr
;

2390 
	}
}

2391 
EXPORT_SYMBOL_GPL
(
¢d_soc_put_vﬁsw
);

2402 
	$¢d_soc_öfo_vﬁsw_s8
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2403 
¢d_˘l_ñem_öfo
 *
uöfo
)

2405 
soc_mixî_c⁄åﬁ
 *
mc
 =

2406 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2407 
∂©f‹m_max
;

2408 
mö
 = 
mc
->min;

2410 i‡(!
mc
->
∂©f‹m_max
)

2411 
mc
->
∂©f‹m_max
 = mc->
max
;

2412 
∂©f‹m_max
 = 
mc
->platform_max;

2414 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_INTEGER
;

2415 
uöfo
->
cou¡
 = 2;

2416 
uöfo
->
vÆue
.
öãgî
.
mö
 = 0;

2417 
uöfo
->
vÆue
.
öãgî
.
max
 = 
∂©f‹m_max
 - 
mö
;

2419 
	}
}

2420 
EXPORT_SYMBOL_GPL
(
¢d_soc_öfo_vﬁsw_s8
);

2431 
	$¢d_soc_gë_vﬁsw_s8
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2432 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2434 
soc_mixî_c⁄åﬁ
 *
mc
 =

2435 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2436 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2437 
ªg
 = 
mc
->reg;

2438 
mö
 = 
mc
->min;

2439 
vÆ
 = 
	`¢d_soc_ªad
(
codec
, 
ªg
);

2441 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0] =

2442 ((sig√d )(
vÆ
 & 0xff))-
mö
;

2443 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1] =

2444 ((sig√d )((
vÆ
 >> 8Ë& 0xff))-
mö
;

2446 
	}
}

2447 
EXPORT_SYMBOL_GPL
(
¢d_soc_gë_vﬁsw_s8
);

2458 
	$¢d_soc_put_vﬁsw_s8
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2459 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2461 
soc_mixî_c⁄åﬁ
 *
mc
 =

2462 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2463 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2464 
ªg
 = 
mc
->reg;

2465 
mö
 = 
mc
->min;

2466 
vÆ
;

2468 
vÆ
 = (
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[0]+
mö
) & 0xff;

2469 
vÆ
 |((
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[1]+
mö
) & 0xff) << 8;

2471  
	`¢d_soc_upd©e_bôs_locked
(
codec
, 
ªg
, 0xffff, 
vÆ
);

2472 
	}
}

2473 
EXPORT_SYMBOL_GPL
(
¢d_soc_put_vﬁsw_s8
);

2484 
	$¢d_soc_limô_vﬁume
(
¢d_soc_codec
 *
codec
,

2485 c⁄° *
«me
, 
max
)

2487 
¢d_ˇrd
 *
ˇrd
 = 
codec
->card->snd_card;

2488 
¢d_kc⁄åﬁ
 *
k˘l
;

2489 
soc_mixî_c⁄åﬁ
 *
mc
;

2490 
found
 = 0;

2491 
ªt
 = -
EINVAL
;

2494 i‡(
	`u∆ikñy
(!
«me
 || 
max
 <= 0))

2495  -
EINVAL
;

2497 
	`li°_f‹_óch_íåy
(
k˘l
, &
ˇrd
->
c⁄åﬁs
, 
li°
) {

2498 i‡(!
	`°∫cmp
(
k˘l
->
id
.
«me
,Çame, (kctl->id.name))) {

2499 
found
 = 1;

2503 i‡(
found
) {

2504 
mc
 = (
soc_mixî_c⁄åﬁ
 *)
k˘l
->
¥iv©e_vÆue
;

2505 i‡(
max
 <
mc
->max) {

2506 
mc
->
∂©f‹m_max
 = 
max
;

2507 
ªt
 = 0;

2510  
ªt
;

2511 
	}
}

2512 
EXPORT_SYMBOL_GPL
(
¢d_soc_limô_vﬁume
);

2522 
	$¢d_soc_öfo_vﬁsw_2r_sx
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2523 
¢d_˘l_ñem_öfo
 *
uöfo
)

2525 
soc_mixî_c⁄åﬁ
 *
mc
 =

2526 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2527 
max
 = 
mc
->max;

2528 
mö
 = 
mc
->min;

2530 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_INTEGER
;

2531 
uöfo
->
cou¡
 = 2;

2532 
uöfo
->
vÆue
.
öãgî
.
mö
 = 0;

2533 
uöfo
->
vÆue
.
öãgî
.
max
 = max-
mö
;

2536 
	}
}

2537 
EXPORT_SYMBOL_GPL
(
¢d_soc_öfo_vﬁsw_2r_sx
);

2547 
	$¢d_soc_gë_vﬁsw_2r_sx
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2548 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2550 
soc_mixî_c⁄åﬁ
 *
mc
 =

2551 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2552 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2553 
mask
 = (1<<
mc
->
shi·
)-1;

2554 
mö
 = 
mc
->min;

2555 
vÆ
 = 
	`¢d_soc_ªad
(
codec
, 
mc
->
ªg
Ë& 
mask
;

2556 
vÆr
 = 
	`¢d_soc_ªad
(
codec
, 
mc
->
ºeg
Ë& 
mask
;

2558 
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[0] = ((
vÆ
 & 0xff)-
mö
Ë& 
mask
;

2559 
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[1] = ((
vÆr
 & 0xff)-
mö
Ë& 
mask
;

2561 
	}
}

2562 
EXPORT_SYMBOL_GPL
(
¢d_soc_gë_vﬁsw_2r_sx
);

2572 
	$¢d_soc_put_vﬁsw_2r_sx
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2573 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2575 
soc_mixî_c⁄åﬁ
 *
mc
 =

2576 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2577 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2578 
mask
 = (1<<
mc
->
shi·
)-1;

2579 
mö
 = 
mc
->min;

2580 
ªt
;

2581 
vÆ
, 
vÆr
, 
ovÆ
, 
ovÆr
;

2583 
vÆ
 = ((
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[0]+
mö
) & 0xff);

2584 
vÆ
 &
mask
;

2585 
vÆr
 = ((
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[1]+
mö
) & 0xff);

2586 
vÆr
 &
mask
;

2588 
ovÆ
 = 
	`¢d_soc_ªad
(
codec
, 
mc
->
ªg
Ë& 
mask
;

2589 
ovÆr
 = 
	`¢d_soc_ªad
(
codec
, 
mc
->
ºeg
Ë& 
mask
;

2591 
ªt
 = 0;

2592 i‡(
ovÆ
 !
vÆ
) {

2593 
ªt
 = 
	`¢d_soc_wrôe
(
codec
, 
mc
->
ªg
, 
vÆ
);

2594 i‡(
ªt
 < 0)

2595  
ªt
;

2597 i‡(
ovÆr
 !
vÆr
) {

2598 
ªt
 = 
	`¢d_soc_wrôe
(
codec
, 
mc
->
ºeg
, 
vÆr
);

2599 i‡(
ªt
 < 0)

2600  
ªt
;

2604 
	}
}

2605 
EXPORT_SYMBOL_GPL
(
¢d_soc_put_vﬁsw_2r_sx
);

2616 
	$¢d_soc_dai_£t_sys˛k
(
¢d_soc_dai
 *
dai
, 
˛k_id
,

2617 
‰eq
, 
dú
)

2619 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_sys˛k
)

2620  
dai
->
drivî
->
›s
->
	`£t_sys˛k
(dai, 
˛k_id
, 
‰eq
, 
dú
);

2621 i‡(
dai
->
codec
 && dai->codec->
drivî
->
£t_sys˛k
)

2622  
dai
->
codec
->
drivî
->
	`£t_sys˛k
(dai->codec, 
˛k_id
, 0,

2623 
‰eq
, 
dú
);

2625  -
EINVAL
;

2626 
	}
}

2627 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_sys˛k
);

2639 
	$¢d_soc_codec_£t_sys˛k
(
¢d_soc_codec
 *
codec
, 
˛k_id
,

2640 
sour˚
, 
‰eq
, 
dú
)

2642 i‡(
codec
->
drivî
->
£t_sys˛k
)

2643  
codec
->
drivî
->
	`£t_sys˛k
(codec, 
˛k_id
, 
sour˚
,

2644 
‰eq
, 
dú
);

2646  -
EINVAL
;

2647 
	}
}

2648 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_£t_sys˛k
);

2660 
	$¢d_soc_dai_£t_˛kdiv
(
¢d_soc_dai
 *
dai
,

2661 
div_id
, 
div
)

2663 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_˛kdiv
)

2664  
dai
->
drivî
->
›s
->
	`£t_˛kdiv
(dai, 
div_id
, 
div
);

2666  -
EINVAL
;

2667 
	}
}

2668 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_˛kdiv
);

2680 
	$¢d_soc_dai_£t_∂l
(
¢d_soc_dai
 *
dai
, 
∂l_id
, 
sour˚
,

2681 
‰eq_ö
, 
‰eq_out
)

2683 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_∂l
)

2684  
dai
->
drivî
->
›s
->
	`£t_∂l
(dai, 
∂l_id
, 
sour˚
,

2685 
‰eq_ö
, 
‰eq_out
);

2686 i‡(
dai
->
codec
 && dai->codec->
drivî
->
£t_∂l
)

2687  
dai
->
codec
->
drivî
->
	`£t_∂l
(dai->codec, 
∂l_id
, 
sour˚
,

2688 
‰eq_ö
, 
‰eq_out
);

2690  -
EINVAL
;

2691 
	}
}

2692 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_∂l
);

2704 
	$¢d_soc_codec_£t_∂l
(
¢d_soc_codec
 *
codec
, 
∂l_id
, 
sour˚
,

2705 
‰eq_ö
, 
‰eq_out
)

2707 i‡(
codec
->
drivî
->
£t_∂l
)

2708  
codec
->
drivî
->
	`£t_∂l
(codec, 
∂l_id
, 
sour˚
,

2709 
‰eq_ö
, 
‰eq_out
);

2711  -
EINVAL
;

2712 
	}
}

2713 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_£t_∂l
);

2722 
	$¢d_soc_dai_£t_fmt
(
¢d_soc_dai
 *
dai
, 
fmt
)

2724 
	`¥ötk
(
KERN_ERR
 "~~~~~~~ fmt: %#x, %s\n", 
fmt
, 
__func__
);

2725 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_fmt
)

2726  
dai
->
drivî
->
›s
->
	`£t_fmt
(dai, 
fmt
);

2728  -
EINVAL
;

2729 
	}
}

2730 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_fmt
);

2743 
	$¢d_soc_dai_£t_tdm_¶Ÿ
(
¢d_soc_dai
 *
dai
,

2744 
tx_mask
, 
rx_mask
, 
¶Ÿs
, 
¶Ÿ_width
)

2746 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_tdm_¶Ÿ
)

2747  
dai
->
drivî
->
›s
->
	`£t_tdm_¶Ÿ
(dai, 
tx_mask
, 
rx_mask
,

2748 
¶Ÿs
, 
¶Ÿ_width
);

2750  -
EINVAL
;

2751 
	}
}

2752 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_tdm_¶Ÿ
);

2766 
	$¢d_soc_dai_£t_ch™√l_m≠
(
¢d_soc_dai
 *
dai
,

2767 
tx_num
, *
tx_¶Ÿ
,

2768 
rx_num
, *
rx_¶Ÿ
)

2770 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_ch™√l_m≠
)

2771  
dai
->
drivî
->
›s
->
	`£t_ch™√l_m≠
(dai, 
tx_num
, 
tx_¶Ÿ
,

2772 
rx_num
, 
rx_¶Ÿ
);

2774  -
EINVAL
;

2775 
	}
}

2776 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_ch™√l_m≠
);

2785 
	$¢d_soc_dai_£t_åi°©e
(
¢d_soc_dai
 *
dai
, 
åi°©e
)

2787 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
£t_åi°©e
)

2788  
dai
->
drivî
->
›s
->
	`£t_åi°©e
(dai, 
åi°©e
);

2790  -
EINVAL
;

2791 
	}
}

2792 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_£t_åi°©e
);

2801 
	$¢d_soc_dai_digôÆ_muã
(
¢d_soc_dai
 *
dai
, 
muã
)

2803 i‡(
dai
->
drivî
 && dai->drivî->
›s
->
digôÆ_muã
)

2804  
dai
->
drivî
->
›s
->
	`digôÆ_muã
(dai, 
muã
);

2806  -
EINVAL
;

2807 
	}
}

2808 
EXPORT_SYMBOL_GPL
(
¢d_soc_dai_digôÆ_muã
);

2816 
	$¢d_soc_ªgi°î_ˇrd
(
¢d_soc_ˇrd
 *
ˇrd
)

2818 
i
;

2820 i‡(!
ˇrd
->
«me
 || !ˇrd->
dev
)

2821  -
EINVAL
;

2823 
	`dev_£t_drvd©a
(
ˇrd
->
dev
, card);

2825 
	`¢d_soc_öôülize_ˇrd_li°s
(
ˇrd
);

2827 
	`soc_öô_ˇrd_debugfs
(
ˇrd
);

2829 
ˇrd
->
πd
 = 
	`kzÆloc
((
¢d_soc_pcm_ru¡ime
) *

2830 (
ˇrd
->
num_löks
 + c¨d->
num_aux_devs
),

2831 
GFP_KERNEL
);

2832 i‡(
ˇrd
->
πd
 =
NULL
)

2833  -
ENOMEM
;

2834 
ˇrd
->
πd_aux
 = &ˇrd->
πd
[ˇrd->
num_löks
];

2836 
i
 = 0; i < 
ˇrd
->
num_löks
; i++)

2837 
ˇrd
->
πd
[
i
].
dai_lök
 = &card->dai_link[i];

2839 
	`INIT_LIST_HEAD
(&
ˇrd
->
li°
);

2840 
	`INIT_LIST_HEAD
(&
ˇrd
->
d≠m_dúty
);

2841 
ˇrd
->
ö°™tüãd
 = 0;

2842 
	`muãx_öô
(&
ˇrd
->
muãx
);

2844 
	`muãx_lock
(&
˛õ¡_muãx
);

2845 
	`li°_add
(&
ˇrd
->
li°
, &
ˇrd_li°
);

2846 
	`¢d_soc_ö°™tüã_ˇrds
();

2847 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

2849 
	`dev_dbg
(
ˇrd
->
dev
, "Regi°îed c¨d '%s'\n", c¨d->
«me
);

2852 
	}
}

2853 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªgi°î_ˇrd
);

2861 
	$¢d_soc_uƒegi°î_ˇrd
(
¢d_soc_ˇrd
 *
ˇrd
)

2863 i‡(
ˇrd
->
ö°™tüãd
)

2864 
	`soc_˛ónup_ˇrd_ªsour˚s
(
ˇrd
);

2865 
	`muãx_lock
(&
˛õ¡_muãx
);

2866 
	`li°_dñ
(&
ˇrd
->
li°
);

2867 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

2868 
	`dev_dbg
(
ˇrd
->
dev
, "Uƒegi°îed c¨d '%s'\n", c¨d->
«me
);

2871 
	}
}

2872 
EXPORT_SYMBOL_GPL
(
¢d_soc_uƒegi°î_ˇrd
);

2878 *
	$fmt_sögÀ_«me
(
devi˚
 *
dev
, *
id
)

2880 *
found
, 
«me
[
NAME_SIZE
];

2881 
id1
, 
id2
;

2883 i‡(
	`dev_«me
(
dev
Ë=
NULL
)

2884  
NULL
;

2886 
	`°æ˝y
(
«me
, 
	`dev_«me
(
dev
), 
NAME_SIZE
);

2889 
found
 = 
	`°r°r
(
«me
, 
dev
->
drivî
->name);

2890 i‡(
found
) {

2892 i‡(
	`ssˇnf
(&
found
[
	`°æí
(
dev
->
drivî
->
«me
)], ".%d", 
id
) == 1) {

2895 i‡(*
id
 == -1)

2896 
found
[
	`°æí
(
dev
->
drivî
->
«me
)] = '\0';

2901 i‡(
	`ssˇnf
(
«me
, "%x-%x", &
id1
, &
id2
) == 2) {

2902 
tmp
[
NAME_SIZE
];

2905 *
id
 = ((
id1
 & 0xffffË<< 16Ë+ 
id2
;

2908 
	`¢¥ötf
(
tmp
, 
NAME_SIZE
, "%s.%s", 
dev
->
drivî
->
«me
,Çame);

2909 
	`°æ˝y
(
«me
, 
tmp
, 
NAME_SIZE
);

2911 *
id
 = 0;

2914  
	`k°rdup
(
«me
, 
GFP_KERNEL
);

2915 
	}
}

2921 
ölöe
 *
	$fmt_mu…ùÀ_«me
(
devi˚
 *
dev
,

2922 
¢d_soc_dai_drivî
 *
dai_drv
)

2924 i‡(
dai_drv
->
«me
 =
NULL
) {

2925 
	`¥ötk
(
KERN_ERR
 "asoc:Érror - multiple DAI %sÑegistered withÇoÇame\n",

2926 
	`dev_«me
(
dev
));

2927  
NULL
;

2930  
	`k°rdup
(
dai_drv
->
«me
, 
GFP_KERNEL
);

2931 
	}
}

2938 
	$¢d_soc_ªgi°î_dai
(
devi˚
 *
dev
,

2939 
¢d_soc_dai_drivî
 *
dai_drv
)

2941 
¢d_soc_dai
 *
dai
;

2943 
	`dev_dbg
(
dev
, "daòªgi°î %s\n", 
	`dev_«me
(dev));

2945 
dai
 = 
	`kzÆloc
((
¢d_soc_dai
), 
GFP_KERNEL
);

2946 i‡(
dai
 =
NULL
)

2947  -
ENOMEM
;

2950 
dai
->
«me
 = 
	`fmt_sögÀ_«me
(
dev
, &dai->
id
);

2951 i‡(
dai
->
«me
 =
NULL
) {

2952 
	`k‰ì
(
dai
);

2953  -
ENOMEM
;

2956 
dai
->
dev
 = dev;

2957 
dai
->
drivî
 = 
dai_drv
;

2958 i‡(!
dai
->
drivî
->
›s
)

2959 
dai
->
drivî
->
›s
 = &
nuŒ_dai_›s
;

2961 
	`muãx_lock
(&
˛õ¡_muãx
);

2962 
	`li°_add
(&
dai
->
li°
, &
dai_li°
);

2963 
	`¢d_soc_ö°™tüã_ˇrds
();

2964 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

2966 
	`¥_debug
("Regi°îed DAI '%s'\n", 
dai
->
«me
);

2969 
	}
}

2970 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªgi°î_dai
);

2977 
	$¢d_soc_uƒegi°î_dai
(
devi˚
 *
dev
)

2979 
¢d_soc_dai
 *
dai
;

2981 
	`li°_f‹_óch_íåy
(
dai
, &
dai_li°
, 
li°
) {

2982 i‡(
dev
 =
dai
->dev)

2983 
found
;

2987 
found
:

2988 
	`muãx_lock
(&
˛õ¡_muãx
);

2989 
	`li°_dñ
(&
dai
->
li°
);

2990 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

2992 
	`¥_debug
("Uƒegi°îed DAI '%s'\n", 
dai
->
«me
);

2993 
	`k‰ì
(
dai
->
«me
);

2994 
	`k‰ì
(
dai
);

2995 
	}
}

2996 
EXPORT_SYMBOL_GPL
(
¢d_soc_uƒegi°î_dai
);

3004 
	$¢d_soc_ªgi°î_dais
(
devi˚
 *
dev
,

3005 
¢d_soc_dai_drivî
 *
dai_drv
, 
size_t
 
cou¡
)

3007 
¢d_soc_dai
 *
dai
;

3008 
i
, 
ªt
 = 0;

3010 
	`dev_dbg
(
dev
, "daòªgi°î %†#%Zu\n", 
	`dev_«me
(dev), 
cou¡
);

3012 
i
 = 0; i < 
cou¡
; i++) {

3014 
dai
 = 
	`kzÆloc
((
¢d_soc_dai
), 
GFP_KERNEL
);

3015 i‡(
dai
 =
NULL
) {

3016 
ªt
 = -
ENOMEM
;

3017 
îr
;

3021 
dai
->
«me
 = 
	`fmt_mu…ùÀ_«me
(
dev
, &
dai_drv
[
i
]);

3022 i‡(
dai
->
«me
 =
NULL
) {

3023 
	`k‰ì
(
dai
);

3024 
ªt
 = -
EINVAL
;

3025 
îr
;

3028 
dai
->
dev
 = dev;

3029 
dai
->
drivî
 = &
dai_drv
[
i
];

3030 i‡(
dai
->
drivî
->
id
)

3031 
dai
->
id
 = dai->
drivî
->id;

3033 
dai
->
id
 = 
i
;

3034 i‡(!
dai
->
drivî
->
›s
)

3035 
dai
->
drivî
->
›s
 = &
nuŒ_dai_›s
;

3037 
	`muãx_lock
(&
˛õ¡_muãx
);

3038 
	`li°_add
(&
dai
->
li°
, &
dai_li°
);

3039 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

3041 
	`¥_debug
("Regi°îed DAI '%s'\n", 
dai
->
«me
);

3044 
	`muãx_lock
(&
˛õ¡_muãx
);

3045 
	`¢d_soc_ö°™tüã_ˇrds
();

3046 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

3049 
îr
:

3050 
i
--; i >= 0; i--)

3051 
	`¢d_soc_uƒegi°î_dai
(
dev
);

3053  
ªt
;

3054 
	}
}

3055 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªgi°î_dais
);

3063 
	$¢d_soc_uƒegi°î_dais
(
devi˚
 *
dev
, 
size_t
 
cou¡
)

3065 
i
;

3067 
i
 = 0; i < 
cou¡
; i++)

3068 
	`¢d_soc_uƒegi°î_dai
(
dev
);

3069 
	}
}

3070 
EXPORT_SYMBOL_GPL
(
¢d_soc_uƒegi°î_dais
);

3077 
	$¢d_soc_ªgi°î_∂©f‹m
(
devi˚
 *
dev
,

3078 
¢d_soc_∂©f‹m_drivî
 *
∂©f‹m_drv
)

3080 
¢d_soc_∂©f‹m
 *
∂©f‹m
;

3082 
	`dev_dbg
(
dev
, "∂©f‹mÑegi°î %s\n", 
	`dev_«me
(dev));

3084 
∂©f‹m
 = 
	`kzÆloc
((
¢d_soc_∂©f‹m
), 
GFP_KERNEL
);

3085 i‡(
∂©f‹m
 =
NULL
)

3086  -
ENOMEM
;

3089 
∂©f‹m
->
«me
 = 
	`fmt_sögÀ_«me
(
dev
, &∂©f‹m->
id
);

3090 i‡(
∂©f‹m
->
«me
 =
NULL
) {

3091 
	`k‰ì
(
∂©f‹m
);

3092  -
ENOMEM
;

3095 
∂©f‹m
->
dev
 = dev;

3096 
∂©f‹m
->
drivî
 = 
∂©f‹m_drv
;

3097 
∂©f‹m
->
d≠m
.
dev
 = dev;

3098 
∂©f‹m
->
d≠m
.platform =Ölatform;

3099 
∂©f‹m
->
d≠m
.
°ªam_evít
 = 
∂©f‹m_drv
->stream_event;

3101 
	`muãx_lock
(&
˛õ¡_muãx
);

3102 
	`li°_add
(&
∂©f‹m
->
li°
, &
∂©f‹m_li°
);

3103 
	`¢d_soc_ö°™tüã_ˇrds
();

3104 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

3106 
	`¥_debug
("Regi°îedÖœtf‹m '%s'\n", 
∂©f‹m
->
«me
);

3109 
	}
}

3110 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªgi°î_∂©f‹m
);

3117 
	$¢d_soc_uƒegi°î_∂©f‹m
(
devi˚
 *
dev
)

3119 
¢d_soc_∂©f‹m
 *
∂©f‹m
;

3121 
	`li°_f‹_óch_íåy
(
∂©f‹m
, &
∂©f‹m_li°
, 
li°
) {

3122 i‡(
dev
 =
∂©f‹m
->dev)

3123 
found
;

3127 
found
:

3128 
	`muãx_lock
(&
˛õ¡_muãx
);

3129 
	`li°_dñ
(&
∂©f‹m
->
li°
);

3130 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

3132 
	`¥_debug
("Uƒegi°îedÖœtf‹m '%s'\n", 
∂©f‹m
->
«me
);

3133 
	`k‰ì
(
∂©f‹m
->
«me
);

3134 
	`k‰ì
(
∂©f‹m
);

3135 
	}
}

3136 
EXPORT_SYMBOL_GPL
(
¢d_soc_uƒegi°î_∂©f‹m
);

3138 
u64
 
	gcodec_f‹m©_m≠
[] = {

3139 
SNDRV_PCM_FMTBIT_S16_LE
 | 
SNDRV_PCM_FMTBIT_S16_BE
,

3140 
SNDRV_PCM_FMTBIT_U16_LE
 | 
SNDRV_PCM_FMTBIT_U16_BE
,

3141 
SNDRV_PCM_FMTBIT_S24_LE
 | 
SNDRV_PCM_FMTBIT_S24_BE
,

3142 
SNDRV_PCM_FMTBIT_U24_LE
 | 
SNDRV_PCM_FMTBIT_U24_BE
,

3143 
SNDRV_PCM_FMTBIT_S32_LE
 | 
SNDRV_PCM_FMTBIT_S32_BE
,

3144 
SNDRV_PCM_FMTBIT_U32_LE
 | 
SNDRV_PCM_FMTBIT_U32_BE
,

3145 
SNDRV_PCM_FMTBIT_S24_3LE
 | 
SNDRV_PCM_FMTBIT_U24_3BE
,

3146 
SNDRV_PCM_FMTBIT_U24_3LE
 | 
SNDRV_PCM_FMTBIT_U24_3BE
,

3147 
SNDRV_PCM_FMTBIT_S20_3LE
 | 
SNDRV_PCM_FMTBIT_S20_3BE
,

3148 
SNDRV_PCM_FMTBIT_U20_3LE
 | 
SNDRV_PCM_FMTBIT_U20_3BE
,

3149 
SNDRV_PCM_FMTBIT_S18_3LE
 | 
SNDRV_PCM_FMTBIT_S18_3BE
,

3150 
SNDRV_PCM_FMTBIT_U18_3LE
 | 
SNDRV_PCM_FMTBIT_U18_3BE
,

3151 
SNDRV_PCM_FMTBIT_FLOAT_LE
 | 
SNDRV_PCM_FMTBIT_FLOAT_BE
,

3152 
SNDRV_PCM_FMTBIT_FLOAT64_LE
 | 
SNDRV_PCM_FMTBIT_FLOAT64_BE
,

3153 
SNDRV_PCM_FMTBIT_IEC958_SUBFRAME_LE


3154 | 
SNDRV_PCM_FMTBIT_IEC958_SUBFRAME_BE
,

3162 
	$fixup_codec_f‹m©s
(
¢d_soc_pcm_°ªam
 *
°ªam
)

3164 
i
;

3166 
i
 = 0; i < 
	`ARRAY_SIZE
(
codec_f‹m©_m≠
); i++)

3167 i‡(
°ªam
->
f‹m©s
 & 
codec_f‹m©_m≠
[
i
])

3168 
°ªam
->
f‹m©s
 |
codec_f‹m©_m≠
[
i
];

3169 
	}
}

3176 
	$¢d_soc_ªgi°î_codec
(
devi˚
 *
dev
,

3177 c⁄° 
¢d_soc_codec_drivî
 *
codec_drv
,

3178 
¢d_soc_dai_drivî
 *
dai_drv
,

3179 
num_dai
)

3181 
size_t
 
ªg_size
;

3182 
¢d_soc_codec
 *
codec
;

3183 
ªt
, 
i
;

3185 
	`dev_dbg
(
dev
, "code¯ªgi°î %s\n", 
	`dev_«me
(dev));

3187 
codec
 = 
	`kzÆloc
((
¢d_soc_codec
), 
GFP_KERNEL
);

3188 i‡(
codec
 =
NULL
)

3189  -
ENOMEM
;

3192 
codec
->
«me
 = 
	`fmt_sögÀ_«me
(
dev
, &codec->
id
);

3193 i‡(
codec
->
«me
 =
NULL
) {

3194 
	`k‰ì
(
codec
);

3195  -
ENOMEM
;

3198 i‡(
codec_drv
->
com¥ess_ty≥
)

3199 
codec
->
com¥ess_ty≥
 = 
codec_drv
->compress_type;

3201 
codec
->
com¥ess_ty≥
 = 
SND_SOC_FLAT_COMPRESSION
;

3203 
codec
->
wrôe
 = 
codec_drv
->write;

3204 
codec
->
ªad
 = 
codec_drv
->read;

3205 
codec
->
vﬁ©ûe_ªgi°î
 = 
codec_drv
->volatile_register;

3206 
codec
->
ªadabÀ_ªgi°î
 = 
codec_drv
->readable_register;

3207 
codec
->
wrôabÀ_ªgi°î
 = 
codec_drv
->writable_register;

3208 
codec
->
d≠m
.
büs_Àvñ
 = 
SND_SOC_BIAS_OFF
;

3209 
codec
->
d≠m
.
dev
 = dev;

3210 
codec
->
d≠m
.codec = codec;

3211 
codec
->
d≠m
.
£q_nŸifõr
 = 
codec_drv
->seq_notifier;

3212 
codec
->
d≠m
.
°ªam_evít
 = 
codec_drv
->stream_event;

3213 
codec
->
dev
 = dev;

3214 
codec
->
drivî
 = 
codec_drv
;

3215 
codec
->
num_dai
 =Çum_dai;

3216 
	`muãx_öô
(&
codec
->
muãx
);

3219 i‡(
codec_drv
->
ªg_ˇche_size
 && codec_drv->
ªg_w‹d_size
) {

3220 
ªg_size
 = 
codec_drv
->
ªg_ˇche_size
 * codec_drv->
ªg_w‹d_size
;

3221 
codec
->
ªg_size
 =Ñeg_size;

3228 i‡(
codec_drv
->
ªg_ˇche_deÁu…
) {

3229 
codec
->
ªg_def_c›y
 = 
	`kmemdup
(
codec_drv
->
ªg_ˇche_deÁu…
,

3230 
ªg_size
, 
GFP_KERNEL
);

3231 i‡(!
codec
->
ªg_def_c›y
) {

3232 
ªt
 = -
ENOMEM
;

3233 
Áû
;

3238 i‡(
codec_drv
->
ªg_ac˚ss_size
 && codec_drv->
ªg_ac˚ss_deÁu…
) {

3239 i‡(!
codec
->
vﬁ©ûe_ªgi°î
)

3240 
codec
->
vﬁ©ûe_ªgi°î
 = 
¢d_soc_deÁu…_vﬁ©ûe_ªgi°î
;

3241 i‡(!
codec
->
ªadabÀ_ªgi°î
)

3242 
codec
->
ªadabÀ_ªgi°î
 = 
¢d_soc_deÁu…_ªadabÀ_ªgi°î
;

3243 i‡(!
codec
->
wrôabÀ_ªgi°î
)

3244 
codec
->
wrôabÀ_ªgi°î
 = 
¢d_soc_deÁu…_wrôabÀ_ªgi°î
;

3247 
i
 = 0; i < 
num_dai
; i++) {

3248 
	`fixup_codec_f‹m©s
(&
dai_drv
[
i
].
∂ayback
);

3249 
	`fixup_codec_f‹m©s
(&
dai_drv
[
i
].
ˇ±uª
);

3253 i‡(
num_dai
) {

3254 
ªt
 = 
	`¢d_soc_ªgi°î_dais
(
dev
, 
dai_drv
, 
num_dai
);

3255 i‡(
ªt
 < 0)

3256 
Áû
;

3259 
	`muãx_lock
(&
˛õ¡_muãx
);

3260 
	`li°_add
(&
codec
->
li°
, &
codec_li°
);

3261 
	`¢d_soc_ö°™tüã_ˇrds
();

3262 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

3264 
	`¥_debug
("Regi°îed code¯'%s'\n", 
codec
->
«me
);

3267 
Áû
:

3268 
	`k‰ì
(
codec
->
ªg_def_c›y
);

3269 
codec
->
ªg_def_c›y
 = 
NULL
;

3270 
	`k‰ì
(
codec
->
«me
);

3271 
	`k‰ì
(
codec
);

3272  
ªt
;

3273 
	}
}

3274 
EXPORT_SYMBOL_GPL
(
¢d_soc_ªgi°î_codec
);

3281 
	$¢d_soc_uƒegi°î_codec
(
devi˚
 *
dev
)

3283 
¢d_soc_codec
 *
codec
;

3284 
i
;

3286 
	`li°_f‹_óch_íåy
(
codec
, &
codec_li°
, 
li°
) {

3287 i‡(
dev
 =
codec
->dev)

3288 
found
;

3292 
found
:

3293 i‡(
codec
->
num_dai
)

3294 
i
 = 0; i < 
codec
->
num_dai
; i++)

3295 
	`¢d_soc_uƒegi°î_dai
(
dev
);

3297 
	`muãx_lock
(&
˛õ¡_muãx
);

3298 
	`li°_dñ
(&
codec
->
li°
);

3299 
	`muãx_u∆ock
(&
˛õ¡_muãx
);

3301 
	`¥_debug
("Uƒegi°îed code¯'%s'\n", 
codec
->
«me
);

3303 
	`¢d_soc_ˇche_exô
(
codec
);

3304 
	`k‰ì
(
codec
->
ªg_def_c›y
);

3305 
	`k‰ì
(
codec
->
«me
);

3306 
	`k‰ì
(
codec
);

3307 
	}
}

3308 
EXPORT_SYMBOL_GPL
(
¢d_soc_uƒegi°î_codec
);

3310 
__öô
 
	$¢d_soc_öô
()

3312 #ifde‡
CONFIG_DEBUG_FS


3313 
¢d_soc_debugfs_roŸ
 = 
	`debugfs_¸óã_dú
("asoc", 
NULL
);

3314 i‡(
	`IS_ERR
(
¢d_soc_debugfs_roŸ
) || !snd_soc_debugfs_root) {

3315 
	`¥ötk
(
KERN_WARNING


3317 
¢d_soc_debugfs_roŸ
 = 
NULL
;

3320 i‡(!
	`debugfs_¸óã_fûe
("codecs", 0444, 
¢d_soc_debugfs_roŸ
, 
NULL
,

3321 &
codec_li°_f›s
))

3322 
	`¥_w¨n
("ASoC: FailedÅo create CODECÜist debugfs file\n");

3324 i‡(!
	`debugfs_¸óã_fûe
("dais", 0444, 
¢d_soc_debugfs_roŸ
, 
NULL
,

3325 &
dai_li°_f›s
))

3326 
	`¥_w¨n
("ASoC: FailedÅo create DAIÜist debugfs file\n");

3328 i‡(!
	`debugfs_¸óã_fûe
("∂©f‹ms", 0444, 
¢d_soc_debugfs_roŸ
, 
NULL
,

3329 &
∂©f‹m_li°_f›s
))

3330 
	`¥_w¨n
("ASoC: FailedÅo createÖlatformÜist debugfs file\n");

3333 
	`¢d_soc_utû_öô
();

3335  
	`∂©f‹m_drivî_ªgi°î
(&
soc_drivî
);

3336 
	}
}

3337 
moduÀ_öô
(
¢d_soc_öô
);

3339 
__exô
 
	$¢d_soc_exô
()

3341 
	`¢d_soc_utû_exô
();

3343 #ifde‡
CONFIG_DEBUG_FS


3344 
	`debugfs_ªmove_ªcursive
(
¢d_soc_debugfs_roŸ
);

3346 
	`∂©f‹m_drivî_uƒegi°î
(&
soc_drivî
);

3347 
	}
}

3348 
moduÀ_exô
(
¢d_soc_exô
);

3351 
MODULE_AUTHOR
("Liam Girdwood,Ürg@slimlogic.co.uk");

3352 
MODULE_DESCRIPTION
("ALSA SoC Core");

3353 
MODULE_LICENSE
("GPL");

3354 
MODULE_ALIAS
("platform:soc-audio");

	@soc-dapm.c

32 
	~<löux/moduÀ.h
>

33 
	~<löux/moduÀ∑øm.h
>

34 
	~<löux/öô.h
>

35 
	~<löux/async.h
>

36 
	~<löux/dñay.h
>

37 
	~<löux/pm.h
>

38 
	~<löux/bô›s.h
>

39 
	~<löux/∂©f‹m_devi˚.h
>

40 
	~<löux/jiffõs.h
>

41 
	~<löux/debugfs.h
>

42 
	~<löux/¶ab.h
>

43 
	~<sound/c‹e.h
>

44 
	~<sound/pcm.h
>

45 
	~<sound/pcm_∑øms.h
>

46 
	~<sound/soc.h
>

47 
	~<sound/öôvÆ.h
>

49 
	~<åa˚/evíts/asoc.h
>

51 
	#DAPM_UPDATE_STAT
(
widgë
, 
vÆ
Ëwidgë->
d≠m
->
ˇrd
->
d≠m_°©s
.vÆ++;

	)

54 
	gd≠m_up_£q
[] = {

55 [
¢d_soc_d≠m_¥e
] = 0,

56 [
¢d_soc_d≠m_suµly
] = 1,

57 [
¢d_soc_d≠m_micbüs
] = 2,

58 [
¢d_soc_d≠m_aif_ö
] = 3,

59 [
¢d_soc_d≠m_aif_out
] = 3,

60 [
¢d_soc_d≠m_mic
] = 4,

61 [
¢d_soc_d≠m_mux
] = 5,

62 [
¢d_soc_d≠m_vút_mux
] = 5,

63 [
¢d_soc_d≠m_vÆue_mux
] = 5,

64 [
¢d_soc_d≠m_dac
] = 6,

65 [
¢d_soc_d≠m_mixî
] = 7,

66 [
¢d_soc_d≠m_mixî_«med_˘l
] = 7,

67 [
¢d_soc_d≠m_pga
] = 8,

68 [
¢d_soc_d≠m_adc
] = 9,

69 [
¢d_soc_d≠m_out_drv
] = 10,

70 [
¢d_soc_d≠m_hp
] = 10,

71 [
¢d_soc_d≠m_•k
] = 10,

72 [
¢d_soc_d≠m_po°
] = 11,

75 
	gd≠m_down_£q
[] = {

76 [
¢d_soc_d≠m_¥e
] = 0,

77 [
¢d_soc_d≠m_adc
] = 1,

78 [
¢d_soc_d≠m_hp
] = 2,

79 [
¢d_soc_d≠m_•k
] = 2,

80 [
¢d_soc_d≠m_out_drv
] = 2,

81 [
¢d_soc_d≠m_pga
] = 4,

82 [
¢d_soc_d≠m_mixî_«med_˘l
] = 5,

83 [
¢d_soc_d≠m_mixî
] = 5,

84 [
¢d_soc_d≠m_dac
] = 6,

85 [
¢d_soc_d≠m_mic
] = 7,

86 [
¢d_soc_d≠m_micbüs
] = 8,

87 [
¢d_soc_d≠m_mux
] = 9,

88 [
¢d_soc_d≠m_vút_mux
] = 9,

89 [
¢d_soc_d≠m_vÆue_mux
] = 9,

90 [
¢d_soc_d≠m_aif_ö
] = 10,

91 [
¢d_soc_d≠m_aif_out
] = 10,

92 [
¢d_soc_d≠m_suµly
] = 11,

93 [
¢d_soc_d≠m_po°
] = 12,

96 
	$p›_waô
(
u32
 
p›_time
)

98 i‡(
p›_time
)

99 
	`scheduÀ_timeout_unöãºu±ibÀ
(
	`m£cs_to_jiffõs
(
p›_time
));

100 
	}
}

102 
	$p›_dbg
(
devi˚
 *
dev
, 
u32
 
p›_time
, c⁄° *
fmt
, ...)

104 
va_li°
 
¨gs
;

105 *
buf
;

107 i‡(!
p›_time
)

110 
buf
 = 
	`kmÆloc
(
PAGE_SIZE
, 
GFP_KERNEL
);

111 i‡(
buf
 =
NULL
)

114 
	`va_°¨t
(
¨gs
, 
fmt
);

115 
	`v¢¥ötf
(
buf
, 
PAGE_SIZE
, 
fmt
, 
¨gs
);

116 
	`dev_öfo
(
dev
, "%s", 
buf
);

117 
	`va_íd
(
¨gs
);

119 
	`k‰ì
(
buf
);

120 
	}
}

122 
boﬁ
 
	$d≠m_dúty_widgë
(
¢d_soc_d≠m_widgë
 *
w
)

124  !
	`li°_em±y
(&
w
->
dúty
);

125 
	}
}

127 
	$d≠m_m¨k_dúty
(
¢d_soc_d≠m_widgë
 *
w
, c⁄° *
ªas⁄
)

129 i‡(!
	`d≠m_dúty_widgë
(
w
)) {

130 
	`dev_vdbg
(
w
->
d≠m
->
dev
, "Marking %s dirty dueÅo %s\n",

131 
w
->
«me
, 
ªas⁄
);

132 
	`li°_add_èû
(&
w
->
dúty
, &w->
d≠m
->
ˇrd
->
d≠m_dúty
);

134 
	}
}

135 
EXPORT_SYMBOL_GPL
(
d≠m_m¨k_dúty
);

138 
ölöe
 
¢d_soc_d≠m_widgë
 *
	$d≠m_˙ew_widgë
(

139 c⁄° 
¢d_soc_d≠m_widgë
 *
_widgë
)

141  
	`kmemdup
(
_widgë
, (*_widgë), 
GFP_KERNEL
);

142 
	}
}

145 
ölöe
 
¢d_ˇrd
 *
	$d≠m_gë_¢d_ˇrd
(

146 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

148 i‡(
d≠m
->
codec
)

149  
d≠m
->
codec
->
ˇrd
->
¢d_ˇrd
;

150 i‡(
d≠m
->
∂©f‹m
)

151  
d≠m
->
∂©f‹m
->
ˇrd
->
¢d_ˇrd
;

153 
	`BUG
();

156  
NULL
;

157 
	}
}

160 
ölöe
 
¢d_soc_ˇrd
 *
	$d≠m_gë_soc_ˇrd
(

161 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

163 i‡(
d≠m
->
codec
)

164  
d≠m
->
codec
->
ˇrd
;

165 i‡(
d≠m
->
∂©f‹m
)

166  
d≠m
->
∂©f‹m
->
ˇrd
;

168 
	`BUG
();

171  
NULL
;

172 
	}
}

174 
	$soc_widgë_ªad
(
¢d_soc_d≠m_widgë
 *
w
, 
ªg
)

176 i‡(
w
->
codec
)

177  
	`¢d_soc_ªad
(
w
->
codec
, 
ªg
);

178 i‡(
w
->
∂©f‹m
)

179  
	`¢d_soc_∂©f‹m_ªad
(
w
->
∂©f‹m
, 
ªg
);

181 
	`dev_îr
(
w
->
d≠m
->
dev
, "no valid widgetÑead method\n");

183 
	}
}

185 
	$soc_widgë_wrôe
(
¢d_soc_d≠m_widgë
 *
w
, 
ªg
, 
vÆ
)

187 i‡(
w
->
codec
)

188  
	`¢d_soc_wrôe
(
w
->
codec
, 
ªg
, 
vÆ
);

189 i‡(
w
->
∂©f‹m
)

190  
	`¢d_soc_∂©f‹m_wrôe
(
w
->
∂©f‹m
, 
ªg
, 
vÆ
);

192 
	`dev_îr
(
w
->
d≠m
->
dev
, "no valid widget write method\n");

194 
	}
}

196 
	$soc_widgë_upd©e_bôs
(
¢d_soc_d≠m_widgë
 *
w
,

197 
ªg
, 
mask
, 
vÆue
)

199 
ch™ge
;

200 
ﬁd
, 
√w
;

201 
ªt
;

203 
ªt
 = 
	`soc_widgë_ªad
(
w
, 
ªg
);

204 i‡(
ªt
 < 0)

205  
ªt
;

207 
ﬁd
 = 
ªt
;

208 
√w
 = (
ﬁd
 & ~
mask
Ë| (
vÆue
 & mask);

209 
ch™ge
 = 
ﬁd
 !
√w
;

210 i‡(
ch™ge
) {

211 
ªt
 = 
	`soc_widgë_wrôe
(
w
, 
ªg
, 
√w
);

212 i‡(
ªt
 < 0)

213  
ªt
;

216  
ch™ge
;

217 
	}
}

228 
	$¢d_soc_d≠m_£t_büs_Àvñ
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

229 
¢d_soc_büs_Àvñ
 
Àvñ
)

231 
¢d_soc_ˇrd
 *
ˇrd
 = 
d≠m
->card;

232 
ªt
 = 0;

234 
	`åa˚_¢d_soc_büs_Àvñ_°¨t
(
ˇrd
, 
Àvñ
);

236 i‡(
ˇrd
 && c¨d->
£t_büs_Àvñ
)

237 
ªt
 = 
ˇrd
->
	`£t_büs_Àvñ
(ˇrd, 
d≠m
, 
Àvñ
);

238 i‡(
ªt
 != 0)

239 
out
;

241 i‡(
d≠m
->
codec
) {

242 i‡(
d≠m
->
codec
->
drivî
->
£t_büs_Àvñ
)

243 
ªt
 = 
d≠m
->
codec
->
drivî
->
	`£t_büs_Àvñ
(dapm->codec,

244 
Àvñ
);

246 
d≠m
->
büs_Àvñ
 = 
Àvñ
;

248 i‡(
ªt
 != 0)

249 
out
;

251 i‡(
ˇrd
 && c¨d->
£t_büs_Àvñ_po°
)

252 
ªt
 = 
ˇrd
->
	`£t_büs_Àvñ_po°
(ˇrd, 
d≠m
, 
Àvñ
);

253 
out
:

254 
	`åa˚_¢d_soc_büs_Àvñ_d⁄e
(
ˇrd
, 
Àvñ
);

256  
ªt
;

257 
	}
}

260 
	$d≠m_£t_∑th_°©us
(
¢d_soc_d≠m_widgë
 *
w
,

261 
¢d_soc_d≠m_∑th
 *
p
, 
i
)

263 
w
->
id
) {

264 
¢d_soc_d≠m_swôch
:

265 
¢d_soc_d≠m_mixî
:

266 
¢d_soc_d≠m_mixî_«med_˘l
: {

267 
vÆ
;

268 
soc_mixî_c⁄åﬁ
 *
mc
 = (soc_mixer_control *)

269 
w
->
kc⁄åﬁ_√ws
[
i
].
¥iv©e_vÆue
;

270 
ªg
 = 
mc
->reg;

271 
shi·
 = 
mc
->shift;

272 
max
 = 
mc
->max;

273 
mask
 = (1 << 
	`Ês
(
max
)) - 1;

274 
övît
 = 
mc
->invert;

276 
vÆ
 = 
	`soc_widgë_ªad
(
w
, 
ªg
);

277 
vÆ
 = (vÆ >> 
shi·
Ë& 
mask
;

279 i‡((
övît
 && !
vÆ
) || (!invert && val))

280 
p
->
c⁄√˘
 = 1;

282 
p
->
c⁄√˘
 = 0;

285 
¢d_soc_d≠m_mux
: {

286 
soc_íum
 *
e
 = (soc_enum *)

287 
w
->
kc⁄åﬁ_√ws
[
i
].
¥iv©e_vÆue
;

288 
vÆ
, 
ôem
, 
bômask
;

290 
bômask
 = 1; bômask < 
e
->
max
; bitmask <<= 1)

292 
vÆ
 = 
	`soc_widgë_ªad
(
w
, 
e
->
ªg
);

293 
ôem
 = (
vÆ
 >> 
e
->
shi·_l
Ë& (
bômask
 - 1);

295 
p
->
c⁄√˘
 = 0;

296 
i
 = 0; i < 
e
->
max
; i++) {

297 i‡(!(
	`°rcmp
(
p
->
«me
, 
e
->
ãxts
[
i
])Ë&& 
ôem
 == i)

298 
p
->
c⁄√˘
 = 1;

302 
¢d_soc_d≠m_vút_mux
: {

303 
soc_íum
 *
e
 = (soc_enum *)

304 
w
->
kc⁄åﬁ_√ws
[
i
].
¥iv©e_vÆue
;

306 
p
->
c⁄√˘
 = 0;

313 i‡(!
	`°rcmp
(
p
->
«me
, 
e
->
ãxts
[0]))

314 
p
->
c⁄√˘
 = 1;

317 
¢d_soc_d≠m_vÆue_mux
: {

318 
soc_íum
 *
e
 = (soc_enum *)

319 
w
->
kc⁄åﬁ_√ws
[
i
].
¥iv©e_vÆue
;

320 
vÆ
, 
ôem
;

322 
vÆ
 = 
	`soc_widgë_ªad
(
w
, 
e
->
ªg
);

323 
vÆ
 = (vÆ >> 
e
->
shi·_l
Ë&É->
mask
;

324 
ôem
 = 0; iãm < 
e
->
max
; item++) {

325 i‡(
vÆ
 =
e
->
vÆues
[
ôem
])

329 
p
->
c⁄√˘
 = 0;

330 
i
 = 0; i < 
e
->
max
; i++) {

331 i‡(!(
	`°rcmp
(
p
->
«me
, 
e
->
ãxts
[
i
])Ë&& 
ôem
 == i)

332 
p
->
c⁄√˘
 = 1;

337 
¢d_soc_d≠m_pga
:

338 
¢d_soc_d≠m_out_drv
:

339 
¢d_soc_d≠m_ouçut
:

340 
¢d_soc_d≠m_adc
:

341 
¢d_soc_d≠m_öput
:

342 
¢d_soc_d≠m_dac
:

343 
¢d_soc_d≠m_micbüs
:

344 
¢d_soc_d≠m_vmid
:

345 
¢d_soc_d≠m_suµly
:

346 
¢d_soc_d≠m_aif_ö
:

347 
¢d_soc_d≠m_aif_out
:

348 
¢d_soc_d≠m_hp
:

349 
¢d_soc_d≠m_mic
:

350 
¢d_soc_d≠m_•k
:

351 
¢d_soc_d≠m_löe
:

352 
p
->
c⁄√˘
 = 1;

355 
¢d_soc_d≠m_¥e
:

356 
¢d_soc_d≠m_po°
:

357 
p
->
c⁄√˘
 = 0;

360 
	}
}

363 
	$d≠m_c⁄√˘_mux
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

364 
¢d_soc_d≠m_widgë
 *
§c
, ¢d_soc_d≠m_widgë *
de°
,

365 
¢d_soc_d≠m_∑th
 *
∑th
, c⁄° *
c⁄åﬁ_«me
,

366 c⁄° 
¢d_kc⁄åﬁ_√w
 *
kc⁄åﬁ
)

368 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

369 
i
;

371 
i
 = 0; i < 
e
->
max
; i++) {

372 i‡(!(
	`°rcmp
(
c⁄åﬁ_«me
, 
e
->
ãxts
[
i
]))) {

373 
	`li°_add
(&
∑th
->
li°
, &
d≠m
->
ˇrd
->
∑ths
);

374 
	`li°_add
(&
∑th
->
li°_sök
, &
de°
->
sour˚s
);

375 
	`li°_add
(&
∑th
->
li°_sour˚
, &
§c
->
söks
);

376 
∑th
->
«me
 = (*)
e
->
ãxts
[
i
];

377 
	`d≠m_£t_∑th_°©us
(
de°
, 
∑th
, 0);

382  -
ENODEV
;

383 
	}
}

386 
	$d≠m_c⁄√˘_mixî
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

387 
¢d_soc_d≠m_widgë
 *
§c
, ¢d_soc_d≠m_widgë *
de°
,

388 
¢d_soc_d≠m_∑th
 *
∑th
, c⁄° *
c⁄åﬁ_«me
)

390 
i
;

393 
i
 = 0; i < 
de°
->
num_kc⁄åﬁs
; i++) {

394 i‡(!
	`°rcmp
(
c⁄åﬁ_«me
, 
de°
->
kc⁄åﬁ_√ws
[
i
].
«me
)) {

395 
	`li°_add
(&
∑th
->
li°
, &
d≠m
->
ˇrd
->
∑ths
);

396 
	`li°_add
(&
∑th
->
li°_sök
, &
de°
->
sour˚s
);

397 
	`li°_add
(&
∑th
->
li°_sour˚
, &
§c
->
söks
);

398 
∑th
->
«me
 = 
de°
->
kc⁄åﬁ_√ws
[
i
].name;

399 
	`d≠m_£t_∑th_°©us
(
de°
, 
∑th
, 
i
);

403  -
ENODEV
;

404 
	}
}

406 
	$d≠m_is_sh¨ed_kc⁄åﬁ
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

407 
¢d_soc_d≠m_widgë
 *
kc⁄åﬁw
,

408 c⁄° 
¢d_kc⁄åﬁ_√w
 *
kc⁄åﬁ_√w
,

409 
¢d_kc⁄åﬁ
 **
kc⁄åﬁ
)

411 
¢d_soc_d≠m_widgë
 *
w
;

412 
i
;

414 *
kc⁄åﬁ
 = 
NULL
;

416 
	`li°_f‹_óch_íåy
(
w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
) {

417 i‡(
w
 =
kc⁄åﬁw
 || w->
d≠m
 != kcontrolw->dapm)

419 
i
 = 0; i < 
w
->
num_kc⁄åﬁs
; i++) {

420 i‡(&
w
->
kc⁄åﬁ_√ws
[
i
] =
kc⁄åﬁ_√w
) {

421 i‡(
w
->
kc⁄åﬁs
)

422 *
kc⁄åﬁ
 = 
w
->
kc⁄åﬁs
[
i
];

429 
	}
}

432 
	$d≠m_√w_mixî
(
¢d_soc_d≠m_widgë
 *
w
)

434 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
 = 
w
->dapm;

435 
i
, 
ªt
 = 0;

436 
size_t
 
«me_Àn
, 
¥efix_Àn
;

437 
¢d_soc_d≠m_∑th
 *
∑th
;

438 
¢d_ˇrd
 *
ˇrd
 = 
d≠m
->card->snd_card;

439 c⁄° *
¥efix
;

440 
¢d_soc_d≠m_widgë_li°
 *
wli°
;

441 
size_t
 
wli°size
;

443 i‡(
d≠m
->
codec
)

444 
¥efix
 = 
d≠m
->
codec
->
«me_¥efix
;

446 
¥efix
 = 
NULL
;

448 i‡(
¥efix
)

449 
¥efix_Àn
 = 
	`°æí
(
¥efix
) + 1;

451 
¥efix_Àn
 = 0;

454 
i
 = 0; i < 
w
->
num_kc⁄åﬁs
; i++) {

457 
	`li°_f‹_óch_íåy
(
∑th
, &
w
->
sour˚s
, 
li°_sök
) {

460 i‡(
∑th
->
«me
 !(*)
w
->
kc⁄åﬁ_√ws
[
i
].name)

463 i‡(
w
->
kc⁄åﬁs
[
i
]) {

464 
∑th
->
kc⁄åﬁ
 = 
w
->
kc⁄åﬁs
[
i
];

468 
wli°size
 = (
¢d_soc_d≠m_widgë_li°
) +

469 (
¢d_soc_d≠m_widgë
 *),

470 
wli°
 = 
	`kzÆloc
(
wli°size
, 
GFP_KERNEL
);

471 i‡(
wli°
 =
NULL
) {

472 
	`dev_îr
(
d≠m
->
dev
,

474 
w
->
«me
);

475  -
ENOMEM
;

477 
wli°
->
num_widgës
 = 1;

478 
wli°
->
widgës
[0] = 
w
;

486 
«me_Àn
 = 
	`°æí
(
w
->
kc⁄åﬁ_√ws
[
i
].
«me
) + 1;

487 i‡(
w
->
id
 !
¢d_soc_d≠m_mixî_«med_˘l
)

488 
«me_Àn
 +1 + 
	`°æí
(
w
->
«me
);

490 
∑th
->
l⁄g_«me
 = 
	`kmÆloc
(
«me_Àn
, 
GFP_KERNEL
);

492 i‡(
∑th
->
l⁄g_«me
 =
NULL
) {

493 
	`k‰ì
(
wli°
);

494  -
ENOMEM
;

497 
w
->
id
) {

505 
	`¢¥ötf
(
∑th
->
l⁄g_«me
, 
«me_Àn
, "%s %s",

506 
w
->
«me
 + 
¥efix_Àn
,

507 
w
->
kc⁄åﬁ_√ws
[
i
].
«me
);

509 
¢d_soc_d≠m_mixî_«med_˘l
:

510 
	`¢¥ötf
(
∑th
->
l⁄g_«me
, 
«me_Àn
, "%s",

511 
w
->
kc⁄åﬁ_√ws
[
i
].
«me
);

515 
∑th
->
l⁄g_«me
[
«me_Àn
 - 1] = '\0';

517 
∑th
->
kc⁄åﬁ
 = 
	`¢d_soc_˙ew
(&
w
->
kc⁄åﬁ_√ws
[
i
],

518 
wli°
, 
∑th
->
l⁄g_«me
,

519 
¥efix
);

520 
ªt
 = 
	`¢d_˘l_add
(
ˇrd
, 
∑th
->
kc⁄åﬁ
);

521 i‡(
ªt
 < 0) {

522 
	`dev_îr
(
d≠m
->
dev
,

524 
∑th
->
l⁄g_«me
, 
ªt
);

525 
	`k‰ì
(
wli°
);

526 
	`k‰ì
(
∑th
->
l⁄g_«me
);

527 
∑th
->
l⁄g_«me
 = 
NULL
;

528  
ªt
;

530 
w
->
kc⁄åﬁs
[
i
] = 
∑th
->
kc⁄åﬁ
;

533  
ªt
;

534 
	}
}

537 
	$d≠m_√w_mux
(
¢d_soc_d≠m_widgë
 *
w
)

539 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
 = 
w
->dapm;

540 
¢d_soc_d≠m_∑th
 *
∑th
 = 
NULL
;

541 
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
;

542 
¢d_ˇrd
 *
ˇrd
 = 
d≠m
->card->snd_card;

543 c⁄° *
¥efix
;

544 
size_t
 
¥efix_Àn
;

545 
ªt
;

546 
¢d_soc_d≠m_widgë_li°
 *
wli°
;

547 
sh¨ed
, 
wli°íåõs
;

548 
size_t
 
wli°size
;

549 *
«me
;

551 i‡(
w
->
num_kc⁄åﬁs
 != 1) {

552 
	`dev_îr
(
d≠m
->
dev
,

554 
w
->
«me
);

555  -
EINVAL
;

558 
sh¨ed
 = 
	`d≠m_is_sh¨ed_kc⁄åﬁ
(
d≠m
, 
w
, &w->
kc⁄åﬁ_√ws
[0],

559 &
kc⁄åﬁ
);

560 i‡(
kc⁄åﬁ
) {

561 
wli°
 = 
kc⁄åﬁ
->
¥iv©e_d©a
;

562 
wli°íåõs
 = 
wli°
->
num_widgës
 + 1;

564 
wli°
 = 
NULL
;

565 
wli°íåõs
 = 1;

567 
wli°size
 = (
¢d_soc_d≠m_widgë_li°
) +

568 
wli°íåõs
 * (
¢d_soc_d≠m_widgë
 *),

569 
wli°
 = 
	`kªÆloc
(wli°, 
wli°size
, 
GFP_KERNEL
);

570 i‡(
wli°
 =
NULL
) {

571 
	`dev_îr
(
d≠m
->
dev
,

572 "asoc: c™'àÆloˇã widgëÜi° f‹ %s\n", 
w
->
«me
);

573  -
ENOMEM
;

575 
wli°
->
num_widgës
 = 
wli°íåõs
;

576 
wli°
->
widgës
[
wli°íåõs
 - 1] = 
w
;

578 i‡(!
kc⁄åﬁ
) {

579 i‡(
d≠m
->
codec
)

580 
¥efix
 = 
d≠m
->
codec
->
«me_¥efix
;

582 
¥efix
 = 
NULL
;

584 i‡(
sh¨ed
) {

585 
«me
 = 
w
->
kc⁄åﬁ_√ws
[0].name;

586 
¥efix_Àn
 = 0;

588 
«me
 = 
w
->name;

589 i‡(
¥efix
)

590 
¥efix_Àn
 = 
	`°æí
(
¥efix
) + 1;

592 
¥efix_Àn
 = 0;

600 
kc⁄åﬁ
 = 
	`¢d_soc_˙ew
(&
w
->
kc⁄åﬁ_√ws
[0], 
wli°
,

601 
«me
 + 
¥efix_Àn
, 
¥efix
);

602 
ªt
 = 
	`¢d_˘l_add
(
ˇrd
, 
kc⁄åﬁ
);

603 i‡(
ªt
 < 0) {

604 
	`dev_îr
(
d≠m
->
dev
, "failedÅoádd kcontrol %s: %d\n",

605 
w
->
«me
, 
ªt
);

606 
	`k‰ì
(
wli°
);

607  
ªt
;

611 
kc⁄åﬁ
->
¥iv©e_d©a
 = 
wli°
;

613 
w
->
kc⁄åﬁs
[0] = 
kc⁄åﬁ
;

615 
	`li°_f‹_óch_íåy
(
∑th
, &
w
->
sour˚s
, 
li°_sök
)

616 
∑th
->
kc⁄åﬁ
 = kcontrol;

619 
	}
}

622 
	$d≠m_√w_pga
(
¢d_soc_d≠m_widgë
 *
w
)

624 i‡(
w
->
num_kc⁄åﬁs
)

625 
	`dev_îr
(
w
->
d≠m
->
dev
,

626 "asoc: PGA c⁄åﬁ†nŸ suµ‹ãd: '%s'\n", 
w
->
«me
);

629 
	}
}

632 
ölöe
 
	$d≠m_˛ór_wÆk
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

634 
¢d_soc_d≠m_∑th
 *
p
;

636 
	`li°_f‹_óch_íåy
(
p
, &
d≠m
->
ˇrd
->
∑ths
, 
li°
)

637 
p
->
wÆked
 = 0;

638 
	}
}

644 
	$¢d_soc_d≠m_su•íd_check
(
¢d_soc_d≠m_widgë
 *
widgë
)

646 
Àvñ
 = 
	`¢d_powî_gë_°©e
(
widgë
->
d≠m
->
ˇrd
->
¢d_ˇrd
);

648 
Àvñ
) {

649 
SNDRV_CTL_POWER_D3hŸ
:

650 
SNDRV_CTL_POWER_D3cﬁd
:

651 i‡(
widgë
->
ign‹e_su•íd
)

652 
	`dev_dbg
(
widgë
->
d≠m
->
dev
, "%s ignoring suspend\n",

653 
widgë
->
«me
);

654  
widgë
->
ign‹e_su•íd
;

658 
	}
}

664 
	$is_c⁄√˘ed_ouçut_ï
(
¢d_soc_d≠m_widgë
 *
widgë
)

666 
¢d_soc_d≠m_∑th
 *
∑th
;

667 
c⁄
 = 0;

669 i‡(
widgë
->
ouçuts
 >= 0)

670  
widgë
->
ouçuts
;

672 
	`DAPM_UPDATE_STAT
(
widgë
, 
∑th_checks
);

674 i‡(
widgë
->
id
 =
¢d_soc_d≠m_suµly
)

677 
widgë
->
id
) {

678 
¢d_soc_d≠m_adc
:

679 
¢d_soc_d≠m_aif_out
:

680 i‡(
widgë
->
a˘ive
) {

681 
widgë
->
ouçuts
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

682  
widgë
->
ouçuts
;

688 i‡(
widgë
->
c⁄√˘ed
) {

690 i‡(
widgë
->
id
 =
¢d_soc_d≠m_ouçut
 && !widgë->
ext
) {

691 
widgë
->
ouçuts
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

692  
widgë
->
ouçuts
;

696 i‡(
widgë
->
id
 =
¢d_soc_d≠m_hp
 ||

697 
widgë
->
id
 =
¢d_soc_d≠m_•k
 ||

698 (
widgë
->
id
 =
¢d_soc_d≠m_löe
 &&

699 !
	`li°_em±y
(&
widgë
->
sour˚s
))) {

700 
widgë
->
ouçuts
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

701  
widgë
->
ouçuts
;

705 
	`li°_f‹_óch_íåy
(
∑th
, &
widgë
->
söks
, 
li°_sour˚
) {

706 
	`DAPM_UPDATE_STAT
(
widgë
, 
√ighbour_checks
);

708 i‡(
∑th
->
wók
)

711 i‡(
∑th
->
wÆked
)

714 i‡(
∑th
->
sök
 &&Ö©h->
c⁄√˘
) {

715 
∑th
->
wÆked
 = 1;

716 
c⁄
 +
	`is_c⁄√˘ed_ouçut_ï
(
∑th
->
sök
);

720 
widgë
->
ouçuts
 = 
c⁄
;

722  
c⁄
;

723 
	}
}

729 
	$is_c⁄√˘ed_öput_ï
(
¢d_soc_d≠m_widgë
 *
widgë
)

731 
¢d_soc_d≠m_∑th
 *
∑th
;

732 
c⁄
 = 0;

734 i‡(
widgë
->
öputs
 >= 0)

735  
widgë
->
öputs
;

737 
	`DAPM_UPDATE_STAT
(
widgë
, 
∑th_checks
);

739 i‡(
widgë
->
id
 =
¢d_soc_d≠m_suµly
)

743 
widgë
->
id
) {

744 
¢d_soc_d≠m_dac
:

745 
¢d_soc_d≠m_aif_ö
:

746 i‡(
widgë
->
a˘ive
) {

747 
widgë
->
öputs
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

748  
widgë
->
öputs
;

754 i‡(
widgë
->
c⁄√˘ed
) {

756 i‡(
widgë
->
id
 =
¢d_soc_d≠m_öput
 && !widgë->
ext
) {

757 
widgë
->
öputs
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

758  
widgë
->
öputs
;

762 i‡(
widgë
->
id
 =
¢d_soc_d≠m_vmid
) {

763 
widgë
->
öputs
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

764  
widgë
->
öputs
;

768 i‡(
widgë
->
id
 =
¢d_soc_d≠m_mic
 ||

769 (
widgë
->
id
 =
¢d_soc_d≠m_löe
 &&

770 !
	`li°_em±y
(&
widgë
->
söks
))) {

771 
widgë
->
öputs
 = 
	`¢d_soc_d≠m_su•íd_check
(widget);

772  
widgë
->
öputs
;

777 
	`li°_f‹_óch_íåy
(
∑th
, &
widgë
->
sour˚s
, 
li°_sök
) {

778 
	`DAPM_UPDATE_STAT
(
widgë
, 
√ighbour_checks
);

780 i‡(
∑th
->
wók
)

783 i‡(
∑th
->
wÆked
)

786 i‡(
∑th
->
sour˚
 &&Ö©h->
c⁄√˘
) {

787 
∑th
->
wÆked
 = 1;

788 
c⁄
 +
	`is_c⁄√˘ed_öput_ï
(
∑th
->
sour˚
);

792 
widgë
->
öputs
 = 
c⁄
;

794  
c⁄
;

795 
	}
}

800 
	$d≠m_ªg_evít
(
¢d_soc_d≠m_widgë
 *
w
,

801 
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
, 
evít
)

803 
vÆ
;

805 i‡(
	`SND_SOC_DAPM_EVENT_ON
(
evít
))

806 
vÆ
 = 
w
->
⁄_vÆ
;

808 
vÆ
 = 
w
->
off_vÆ
;

810 
	`soc_widgë_upd©e_bôs
(
w
, -(w->
ªg
 + 1),

811 
w
->
mask
 << w->
shi·
, 
vÆ
 << w->shift);

814 
	}
}

815 
EXPORT_SYMBOL_GPL
(
d≠m_ªg_evít
);

817 
	$d≠m_widgë_powî_check
(
¢d_soc_d≠m_widgë
 *
w
)

819 i‡(
w
->
powî_checked
)

820  
w
->
√w_powî
;

822 i‡(
w
->
f‹˚
)

823 
w
->
√w_powî
 = 1;

825 
w
->
√w_powî
 = w->
	`powî_check
(w);

827 
w
->
powî_checked
 = 
åue
;

829  
w
->
√w_powî
;

830 
	}
}

834 
	$d≠m_gíîic_check_powî
(
¢d_soc_d≠m_widgë
 *
w
)

836 
ö
, 
out
;

838 
	`DAPM_UPDATE_STAT
(
w
, 
powî_checks
);

840 
ö
 = 
	`is_c⁄√˘ed_öput_ï
(
w
);

841 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

842 
out
 = 
	`is_c⁄√˘ed_ouçut_ï
(
w
);

843 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

844  
out
 !0 && 
ö
 != 0;

845 
	}
}

848 
	$d≠m_adc_check_powî
(
¢d_soc_d≠m_widgë
 *
w
)

850 
ö
;

852 
	`DAPM_UPDATE_STAT
(
w
, 
powî_checks
);

854 i‡(
w
->
a˘ive
) {

855 
ö
 = 
	`is_c⁄√˘ed_öput_ï
(
w
);

856 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

857  
ö
 != 0;

859  
	`d≠m_gíîic_check_powî
(
w
);

861 
	}
}

864 
	$d≠m_dac_check_powî
(
¢d_soc_d≠m_widgë
 *
w
)

866 
out
;

868 
	`DAPM_UPDATE_STAT
(
w
, 
powî_checks
);

870 i‡(
w
->
a˘ive
) {

871 
out
 = 
	`is_c⁄√˘ed_ouçut_ï
(
w
);

872 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

873  
out
 != 0;

875  
	`d≠m_gíîic_check_powî
(
w
);

877 
	}
}

880 
	$d≠m_suµly_check_powî
(
¢d_soc_d≠m_widgë
 *
w
)

882 
¢d_soc_d≠m_∑th
 *
∑th
;

884 
	`DAPM_UPDATE_STAT
(
w
, 
powî_checks
);

887 
	`li°_f‹_óch_íåy
(
∑th
, &
w
->
söks
, 
li°_sour˚
) {

888 
	`DAPM_UPDATE_STAT
(
w
, 
√ighbour_checks
);

890 i‡(
∑th
->
wók
)

893 i‡(
∑th
->
c⁄√˘ed
 &&

894 !
∑th
->
	`c⁄√˘ed
’©h->
sour˚
,Ö©h->
sök
))

897 i‡(!
∑th
->
sök
)

900 i‡(
	`d≠m_widgë_powî_check
(
∑th
->
sök
))

904 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

907 
	}
}

909 
	$d≠m_Æways_⁄_check_powî
(
¢d_soc_d≠m_widgë
 *
w
)

912 
	}
}

914 
	$d≠m_£q_com∑ª
(
¢d_soc_d≠m_widgë
 *
a
,

915 
¢d_soc_d≠m_widgë
 *
b
,

916 
boﬁ
 
powî_up
)

918 *
s‹t
;

920 i‡(
powî_up
)

921 
s‹t
 = 
d≠m_up_£q
;

923 
s‹t
 = 
d≠m_down_£q
;

925 i‡(
s‹t
[
a
->
id
] !s‹t[
b
->id])

926  
s‹t
[
a
->
id
] - s‹t[
b
->id];

927 i‡(
a
->
sub£q
 !
b
->subseq) {

928 i‡(
powî_up
)

929  
a
->
sub£q
 - 
b
->subseq;

931  
b
->
sub£q
 - 
a
->subseq;

933 i‡(
a
->
ªg
 !
b
->reg)

934  
a
->
ªg
 - 
b
->reg;

935 i‡(
a
->
d≠m
 !
b
->dapm)

936  ()
a
->
d≠m
 - ()
b
->dapm;

939 
	}
}

942 
	$d≠m_£q_ö£π
(
¢d_soc_d≠m_widgë
 *
√w_widgë
,

943 
li°_hód
 *
li°
,

944 
boﬁ
 
powî_up
)

946 
¢d_soc_d≠m_widgë
 *
w
;

948 
	`li°_f‹_óch_íåy
(
w
, 
li°
, 
powî_li°
)

949 i‡(
	`d≠m_£q_com∑ª
(
√w_widgë
, 
w
, 
powî_up
) < 0) {

950 
	`li°_add_èû
(&
√w_widgë
->
powî_li°
, &
w
->power_list);

954 
	`li°_add_èû
(&
√w_widgë
->
powî_li°
, 
li°
);

955 
	}
}

957 
	$d≠m_£q_check_evít
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

958 
¢d_soc_d≠m_widgë
 *
w
, 
evít
)

960 
¢d_soc_ˇrd
 *
ˇrd
 = 
d≠m
->card;

961 c⁄° *
ev_«me
;

962 
powî
, 
ªt
;

964 
evít
) {

965 
SND_SOC_DAPM_PRE_PMU
:

966 
ev_«me
 = "PRE_PMU";

967 
powî
 = 1;

969 
SND_SOC_DAPM_POST_PMU
:

970 
ev_«me
 = "POST_PMU";

971 
powî
 = 1;

973 
SND_SOC_DAPM_PRE_PMD
:

974 
ev_«me
 = "PRE_PMD";

975 
powî
 = 0;

977 
SND_SOC_DAPM_POST_PMD
:

978 
ev_«me
 = "POST_PMD";

979 
powî
 = 0;

982 
	`BUG
();

986 i‡(
w
->
powî
 !=Öower)

989 i‡(
w
->
evít
 && (w->
evít_Êags
 &Évent)) {

990 
	`p›_dbg
(
d≠m
->
dev
, 
ˇrd
->
p›_time
, "popÅest : %s %s\n",

991 
w
->
«me
, 
ev_«me
);

992 
	`åa˚_¢d_soc_d≠m_widgë_evít_°¨t
(
w
, 
evít
);

993 
ªt
 = 
w
->
	`evít
(w, 
NULL
, 
evít
);

994 
	`åa˚_¢d_soc_d≠m_widgë_evít_d⁄e
(
w
, 
evít
);

995 i‡(
ªt
 < 0)

996 
	`¥_îr
("%s: %sÉvent failed: %d\n",

997 
ev_«me
, 
w
->
«me
, 
ªt
);

999 
	}
}

1002 
	$d≠m_£q_run_cﬂÀs˚d
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

1003 
li°_hód
 *
≥ndög
)

1005 
¢d_soc_ˇrd
 *
ˇrd
 = 
d≠m
->card;

1006 
¢d_soc_d≠m_widgë
 *
w
;

1007 
ªg
, 
powî
;

1008 
vÆue
 = 0;

1009 
mask
 = 0;

1010 
cur_mask
;

1012 
ªg
 = 
	`li°_fú°_íåy
(
≥ndög
, 
¢d_soc_d≠m_widgë
,

1013 
powî_li°
)->
ªg
;

1015 
	`li°_f‹_óch_íåy
(
w
, 
≥ndög
, 
powî_li°
) {

1016 
cur_mask
 = 1 << 
w
->
shi·
;

1017 
	`BUG_ON
(
ªg
 !
w
->reg);

1019 i‡(
w
->
övît
)

1020 
powî
 = !
w
->power;

1022 
powî
 = 
w
->power;

1024 
mask
 |
cur_mask
;

1025 i‡(
powî
)

1026 
vÆue
 |
cur_mask
;

1028 
	`p›_dbg
(
d≠m
->
dev
, 
ˇrd
->
p›_time
,

1030 
w
->
«me
, 
ªg
, 
vÆue
, 
mask
);

1033 
	`d≠m_£q_check_evít
(
d≠m
, 
w
, 
SND_SOC_DAPM_PRE_PMU
);

1034 
	`d≠m_£q_check_evít
(
d≠m
, 
w
, 
SND_SOC_DAPM_PRE_PMD
);

1037 i‡(
ªg
 >= 0) {

1041 
w
 = 
	`li°_fú°_íåy
(
≥ndög
, 
¢d_soc_d≠m_widgë
,

1042 
powî_li°
);

1044 
	`p›_dbg
(
d≠m
->
dev
, 
ˇrd
->
p›_time
,

1046 
vÆue
, 
mask
, 
ªg
, 
ˇrd
->
p›_time
);

1047 
	`p›_waô
(
ˇrd
->
p›_time
);

1048 
	`soc_widgë_upd©e_bôs
(
w
, 
ªg
, 
mask
, 
vÆue
);

1051 
	`li°_f‹_óch_íåy
(
w
, 
≥ndög
, 
powî_li°
) {

1052 
	`d≠m_£q_check_evít
(
d≠m
, 
w
, 
SND_SOC_DAPM_POST_PMU
);

1053 
	`d≠m_£q_check_evít
(
d≠m
, 
w
, 
SND_SOC_DAPM_POST_PMD
);

1055 
	}
}

1065 
	$d≠m_£q_run
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

1066 
li°_hód
 *
li°
, 
evít
, 
boﬁ
 
powî_up
)

1068 
¢d_soc_d≠m_widgë
 *
w
, *
n
;

1069 
	`LIST_HEAD
(
≥ndög
);

1070 
cur_s‹t
 = -1;

1071 
cur_sub£q
 = -1;

1072 
cur_ªg
 = 
SND_SOC_NOPM
;

1073 
¢d_soc_d≠m_c⁄ãxt
 *
cur_d≠m
 = 
NULL
;

1074 
ªt
, 
i
;

1075 *
s‹t
;

1077 i‡(
powî_up
)

1078 
s‹t
 = 
d≠m_up_£q
;

1080 
s‹t
 = 
d≠m_down_£q
;

1082 
	`li°_f‹_óch_íåy_ß„
(
w
, 
n
, 
li°
, 
powî_li°
) {

1083 
ªt
 = 0;

1086 i‡(
s‹t
[
w
->
id
] !
cur_s‹t
 || w->
ªg
 !
cur_ªg
 ||

1087 
w
->
d≠m
 !
cur_d≠m
 || w->
sub£q
 !
cur_sub£q
) {

1088 i‡(!
	`li°_em±y
(&
≥ndög
))

1089 
	`d≠m_£q_run_cﬂÀs˚d
(
cur_d≠m
, &
≥ndög
);

1091 i‡(
cur_d≠m
 && cur_d≠m->
£q_nŸifõr
) {

1092 
i
 = 0; i < 
	`ARRAY_SIZE
(
d≠m_up_£q
); i++)

1093 i‡(
s‹t
[
i
] =
cur_s‹t
)

1094 
cur_d≠m
->
	`£q_nŸifõr
(cur_dapm,

1095 
i
,

1096 
cur_sub£q
);

1099 
	`INIT_LIST_HEAD
(&
≥ndög
);

1100 
cur_s‹t
 = -1;

1101 
cur_sub£q
 = 
INT_MIN
;

1102 
cur_ªg
 = 
SND_SOC_NOPM
;

1103 
cur_d≠m
 = 
NULL
;

1106 
w
->
id
) {

1107 
¢d_soc_d≠m_¥e
:

1108 i‡(!
w
->
evít
)

1109 
	`li°_f‹_óch_íåy_ß„_c⁄töue
(
w
, 
n
, 
li°
,

1110 
powî_li°
);

1112 i‡(
evít
 =
SND_SOC_DAPM_STREAM_START
)

1113 
ªt
 = 
w
->
	`evít
(w,

1114 
NULL
, 
SND_SOC_DAPM_PRE_PMU
);

1115 i‡(
evít
 =
SND_SOC_DAPM_STREAM_STOP
)

1116 
ªt
 = 
w
->
	`evít
(w,

1117 
NULL
, 
SND_SOC_DAPM_PRE_PMD
);

1120 
¢d_soc_d≠m_po°
:

1121 i‡(!
w
->
evít
)

1122 
	`li°_f‹_óch_íåy_ß„_c⁄töue
(
w
, 
n
, 
li°
,

1123 
powî_li°
);

1125 i‡(
evít
 =
SND_SOC_DAPM_STREAM_START
)

1126 
ªt
 = 
w
->
	`evít
(w,

1127 
NULL
, 
SND_SOC_DAPM_POST_PMU
);

1128 i‡(
evít
 =
SND_SOC_DAPM_STREAM_STOP
)

1129 
ªt
 = 
w
->
	`evít
(w,

1130 
NULL
, 
SND_SOC_DAPM_POST_PMD
);

1135 
cur_s‹t
 = 
s‹t
[
w
->
id
];

1136 
cur_sub£q
 = 
w
->
sub£q
;

1137 
cur_ªg
 = 
w
->
ªg
;

1138 
cur_d≠m
 = 
w
->
d≠m
;

1139 
	`li°_move
(&
w
->
powî_li°
, &
≥ndög
);

1143 i‡(
ªt
 < 0)

1144 
	`dev_îr
(
w
->
d≠m
->
dev
,

1145 "FaûedÅÿ≠∂y widgëÖowî: %d\n", 
ªt
);

1148 i‡(!
	`li°_em±y
(&
≥ndög
))

1149 
	`d≠m_£q_run_cﬂÀs˚d
(
cur_d≠m
, &
≥ndög
);

1151 i‡(
cur_d≠m
 && cur_d≠m->
£q_nŸifõr
) {

1152 
i
 = 0; i < 
	`ARRAY_SIZE
(
d≠m_up_£q
); i++)

1153 i‡(
s‹t
[
i
] =
cur_s‹t
)

1154 
cur_d≠m
->
	`£q_nŸifõr
(cur_dapm,

1155 
i
, 
cur_sub£q
);

1157 
	}
}

1159 
	$d≠m_widgë_upd©e
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

1161 
¢d_soc_d≠m_upd©e
 *
upd©e
 = 
d≠m
->update;

1162 
¢d_soc_d≠m_widgë
 *
w
;

1163 
ªt
;

1165 i‡(!
upd©e
)

1168 
w
 = 
upd©e
->
widgë
;

1170 i‡(
w
->
evít
 &&

1171 (
w
->
evít_Êags
 & 
SND_SOC_DAPM_PRE_REG
)) {

1172 
ªt
 = 
w
->
	`evít
(w, 
upd©e
->
kc⁄åﬁ
, 
SND_SOC_DAPM_PRE_REG
);

1173 i‡(
ªt
 != 0)

1174 
	`¥_îr
("%s DAPMÖre-event failed: %d\n",

1175 
w
->
«me
, 
ªt
);

1178 
ªt
 = 
	`¢d_soc_upd©e_bôs
(
w
->
codec
, 
upd©e
->
ªg
, upd©e->
mask
,

1179 
upd©e
->
vÆ
);

1180 i‡(
ªt
 < 0)

1181 
	`¥_îr
("%†DAPM upd©êÁûed: %d\n", 
w
->
«me
, 
ªt
);

1183 i‡(
w
->
evít
 &&

1184 (
w
->
evít_Êags
 & 
SND_SOC_DAPM_POST_REG
)) {

1185 
ªt
 = 
w
->
	`evít
(w, 
upd©e
->
kc⁄åﬁ
, 
SND_SOC_DAPM_POST_REG
);

1186 i‡(
ªt
 != 0)

1187 
	`¥_îr
("%s DAPMÖost-event failed: %d\n",

1188 
w
->
«me
, 
ªt
);

1190 
	}
}

1195 
	$d≠m_¥e_£quí˚_async
(*
d©a
, 
async_cookõ_t
 
cookõ
)

1197 
¢d_soc_d≠m_c⁄ãxt
 *
d
 = 
d©a
;

1198 
ªt
;

1201 i‡(
d
->
büs_Àvñ
 =
SND_SOC_BIAS_OFF
 &&

1202 
d
->
èrgë_büs_Àvñ
 !
SND_SOC_BIAS_OFF
) {

1203 
ªt
 = 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d
, 
SND_SOC_BIAS_STANDBY
);

1204 i‡(
ªt
 != 0)

1205 
	`dev_îr
(
d
->
dev
,

1206 "FaûedÅÿtu∫ o¿büs: %d\n", 
ªt
);

1210 i‡(
d
->
büs_Àvñ
 !d->
èrgë_büs_Àvñ
) {

1211 
ªt
 = 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d
, 
SND_SOC_BIAS_PREPARE
);

1212 i‡(
ªt
 != 0)

1213 
	`dev_îr
(
d
->
dev
,

1214 "FaûedÅÿ¥ï¨êbüs: %d\n", 
ªt
);

1216 
	}
}

1221 
	$d≠m_po°_£quí˚_async
(*
d©a
, 
async_cookõ_t
 
cookõ
)

1223 
¢d_soc_d≠m_c⁄ãxt
 *
d
 = 
d©a
;

1224 
ªt
;

1227 i‡(
d
->
büs_Àvñ
 =
SND_SOC_BIAS_PREPARE
 &&

1228 (
d
->
èrgë_büs_Àvñ
 =
SND_SOC_BIAS_STANDBY
 ||

1229 
d
->
èrgë_büs_Àvñ
 =
SND_SOC_BIAS_OFF
)) {

1230 
ªt
 = 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d
, 
SND_SOC_BIAS_STANDBY
);

1231 i‡(
ªt
 != 0)

1232 
	`dev_îr
(
d
->
dev
, "FailedÅoápply standby bias: %d\n",

1233 
ªt
);

1237 i‡(
d
->
büs_Àvñ
 =
SND_SOC_BIAS_STANDBY
 &&

1238 
d
->
èrgë_büs_Àvñ
 =
SND_SOC_BIAS_OFF
) {

1239 
ªt
 = 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d
, 
SND_SOC_BIAS_OFF
);

1240 i‡(
ªt
 != 0)

1241 
	`dev_îr
(
d
->
dev
, "FaûedÅÿtu∫ of‡büs: %d\n", 
ªt
);

1245 i‡(
d
->
büs_Àvñ
 =
SND_SOC_BIAS_PREPARE
 &&

1246 
d
->
èrgë_büs_Àvñ
 =
SND_SOC_BIAS_ON
) {

1247 
ªt
 = 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d
, 
SND_SOC_BIAS_ON
);

1248 i‡(
ªt
 != 0)

1249 
	`dev_îr
(
d
->
dev
, "FailedÅoápplyáctive bias: %d\n",

1250 
ªt
);

1252 
	}
}

1254 
	$d≠m_widgë_£t_≥î_powî
(
¢d_soc_d≠m_widgë
 *
≥î
,

1255 
boﬁ
 
powî
, boﬁ 
c⁄√˘
)

1260 i‡(!
c⁄√˘
)

1265 i‡(
powî
 !
≥î
->power)

1266 
	`d≠m_m¨k_dúty
(
≥î
, "peer state change");

1267 
	}
}

1269 
	$d≠m_widgë_£t_powî
(
¢d_soc_d≠m_widgë
 *
w
, 
boﬁ
 
powî
,

1270 
li°_hód
 *
up_li°
,

1271 
li°_hód
 *
down_li°
)

1273 
¢d_soc_d≠m_∑th
 *
∑th
;

1275 i‡(
w
->
powî
 ==Öower)

1278 
	`åa˚_¢d_soc_d≠m_widgë_powî
(
w
, 
powî
);

1283 
	`li°_f‹_óch_íåy
(
∑th
, &
w
->
sour˚s
, 
li°_sök
) {

1284 i‡(
∑th
->
sour˚
) {

1285 
	`d≠m_widgë_£t_≥î_powî
(
∑th
->
sour˚
, 
powî
,

1286 
∑th
->
c⁄√˘
);

1289 
w
->
id
) {

1290 
¢d_soc_d≠m_suµly
:

1294 
	`li°_f‹_óch_íåy
(
∑th
, &
w
->
söks
, 
li°_sour˚
) {

1295 i‡(
∑th
->
sök
) {

1296 
	`d≠m_widgë_£t_≥î_powî
(
∑th
->
sök
, 
powî
,

1297 
∑th
->
c⁄√˘
);

1303 i‡(
powî
)

1304 
	`d≠m_£q_ö£π
(
w
, 
up_li°
, 
åue
);

1306 
	`d≠m_£q_ö£π
(
w
, 
down_li°
, 
Ál£
);

1308 
w
->
powî
 =Öower;

1309 
	}
}

1311 
	$d≠m_powî_⁄e_widgë
(
¢d_soc_d≠m_widgë
 *
w
,

1312 
li°_hód
 *
up_li°
,

1313 
li°_hód
 *
down_li°
)

1315 
powî
;

1317 
w
->
id
) {

1318 
¢d_soc_d≠m_¥e
:

1319 
	`d≠m_£q_ö£π
(
w
, 
down_li°
, 
Ál£
);

1321 
¢d_soc_d≠m_po°
:

1322 
	`d≠m_£q_ö£π
(
w
, 
up_li°
, 
åue
);

1326 
powî
 = 
	`d≠m_widgë_powî_check
(
w
);

1328 
	`d≠m_widgë_£t_powî
(
w
, 
powî
, 
up_li°
, 
down_li°
);

1331 
	}
}

1342 
	$d≠m_powî_widgës
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
, 
evít
)

1344 
¢d_soc_ˇrd
 *
ˇrd
 = 
d≠m
->card;

1345 
¢d_soc_d≠m_widgë
 *
w
;

1346 
¢d_soc_d≠m_c⁄ãxt
 *
d
;

1347 
	`LIST_HEAD
(
up_li°
);

1348 
	`LIST_HEAD
(
down_li°
);

1349 
	`LIST_HEAD
(
async_domaö
);

1350 
¢d_soc_büs_Àvñ
 
büs
;

1352 
	`åa˚_¢d_soc_d≠m_°¨t
(
ˇrd
);

1354 
	`li°_f‹_óch_íåy
(
d
, &
ˇrd
->
d≠m_li°
, 
li°
) {

1355 i‡(
d
->
n_widgës
 || d->
codec
 =
NULL
) {

1356 i‡(
d
->
idÀ_büs_off
)

1357 
d
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_OFF
;

1359 
d
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_STANDBY
;

1363 
	`mem£t
(&
ˇrd
->
d≠m_°©s
, 0, (card->dapm_stats));

1365 
	`li°_f‹_óch_íåy
(
w
, &
ˇrd
->
widgës
, 
li°
) {

1366 
w
->
powî_checked
 = 
Ál£
;

1367 
w
->
öputs
 = -1;

1368 
w
->
ouçuts
 = -1;

1377 
	`li°_f‹_óch_íåy
(
w
, &
ˇrd
->
d≠m_dúty
, 
dúty
) {

1378 
	`d≠m_powî_⁄e_widgë
(
w
, &
up_li°
, &
down_li°
);

1381 
	`li°_f‹_óch_íåy
(
w
, &
ˇrd
->
widgës
, 
li°
) {

1382 
	`li°_dñ_öô
(&
w
->
dúty
);

1384 i‡(
w
->
powî
) {

1385 
d
 = 
w
->
d≠m
;

1392 
w
->
id
) {

1393 
¢d_soc_d≠m_suµly
:

1394 
¢d_soc_d≠m_micbüs
:

1395 i‡(
d
->
èrgë_büs_Àvñ
 < 
SND_SOC_BIAS_STANDBY
)

1396 
d
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_STANDBY
;

1399 
d
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_ON
;

1409 i‡(!
d≠m
->
n_widgës
) {

1410 
evít
) {

1411 
SND_SOC_DAPM_STREAM_START
:

1412 
SND_SOC_DAPM_STREAM_RESUME
:

1413 
d≠m
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_ON
;

1415 
SND_SOC_DAPM_STREAM_STOP
:

1416 i‡(
d≠m
->
codec
->
a˘ive
)

1417 
d≠m
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_ON
;

1419 
d≠m
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_STANDBY
;

1421 
SND_SOC_DAPM_STREAM_SUSPEND
:

1422 
d≠m
->
èrgë_büs_Àvñ
 = 
SND_SOC_BIAS_STANDBY
;

1424 
SND_SOC_DAPM_STREAM_NOP
:

1425 
d≠m
->
èrgë_büs_Àvñ
 = d≠m->
büs_Àvñ
;

1435 
büs
 = 
SND_SOC_BIAS_OFF
;

1436 
	`li°_f‹_óch_íåy
(
d
, &
ˇrd
->
d≠m_li°
, 
li°
)

1437 i‡(
d
->
èrgë_büs_Àvñ
 > 
büs
)

1438 
büs
 = 
d
->
èrgë_büs_Àvñ
;

1439 
	`li°_f‹_óch_íåy
(
d
, &
ˇrd
->
d≠m_li°
, 
li°
)

1440 i‡(!
d
->
idÀ_büs_off
)

1441 
d
->
èrgë_büs_Àvñ
 = 
büs
;

1443 
	`åa˚_¢d_soc_d≠m_wÆk_d⁄e
(
ˇrd
);

1446 
	`li°_f‹_óch_íåy
(
d
, &
d≠m
->
ˇrd
->
d≠m_li°
, 
li°
)

1447 
	`async_scheduÀ_domaö
(
d≠m_¥e_£quí˚_async
, 
d
,

1448 &
async_domaö
);

1449 
	`async_synchr⁄ize_fuŒ_domaö
(&
async_domaö
);

1452 
	`d≠m_£q_run
(
d≠m
, &
down_li°
, 
evít
, 
Ál£
);

1454 
	`d≠m_widgë_upd©e
(
d≠m
);

1457 
	`d≠m_£q_run
(
d≠m
, &
up_li°
, 
evít
, 
åue
);

1460 
	`li°_f‹_óch_íåy
(
d
, &
d≠m
->
ˇrd
->
d≠m_li°
, 
li°
)

1461 
	`async_scheduÀ_domaö
(
d≠m_po°_£quí˚_async
, 
d
,

1462 &
async_domaö
);

1463 
	`async_synchr⁄ize_fuŒ_domaö
(&
async_domaö
);

1465 
	`p›_dbg
(
d≠m
->
dev
, 
ˇrd
->
p›_time
,

1466 "DAPM sequícög föished, waôög %dms\n", 
ˇrd
->
p›_time
);

1467 
	`p›_waô
(
ˇrd
->
p›_time
);

1469 
	`åa˚_¢d_soc_d≠m_d⁄e
(
ˇrd
);

1472 
	}
}

1474 #ifde‡
CONFIG_DEBUG_FS


1475 
	$d≠m_widgë_powî_›í_fûe
(
öode
 *öode, 
fûe
 *file)

1477 
fûe
->
¥iv©e_d©a
 = 
öode
->
i_¥iv©e
;

1479 
	}
}

1481 
ssize_t
 
	$d≠m_widgë_powî_ªad_fûe
(
fûe
 *file,

1482 
__u£r
 *
u£r_buf
,

1483 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1485 
¢d_soc_d≠m_widgë
 *
w
 = 
fûe
->
¥iv©e_d©a
;

1486 *
buf
;

1487 
ö
, 
out
;

1488 
ssize_t
 
ªt
;

1489 
¢d_soc_d≠m_∑th
 *
p
 = 
NULL
;

1491 
buf
 = 
	`kmÆloc
(
PAGE_SIZE
, 
GFP_KERNEL
);

1492 i‡(!
buf
)

1493  -
ENOMEM
;

1495 
ö
 = 
	`is_c⁄√˘ed_öput_ï
(
w
);

1496 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

1497 
out
 = 
	`is_c⁄√˘ed_ouçut_ï
(
w
);

1498 
	`d≠m_˛ór_wÆk
(
w
->
d≠m
);

1500 
ªt
 = 
	`¢¥ötf
(
buf
, 
PAGE_SIZE
, "%s: %s in %d out %d",

1501 
w
->
«me
, w->
powî
 ? "On" : "Off", 
ö
, 
out
);

1503 i‡(
w
->
ªg
 >= 0)

1504 
ªt
 +
	`¢¥ötf
(
buf
 +Ñë, 
PAGE_SIZE
 -Ñet,

1506 
w
->
ªg
, w->ªg, w->
shi·
);

1508 
ªt
 +
	`¢¥ötf
(
buf
 +Ñë, 
PAGE_SIZE
 -Ñet, "\n");

1510 i‡(
w
->
¢ame
)

1511 
ªt
 +
	`¢¥ötf
(
buf
 +Ñë, 
PAGE_SIZE
 -Ñet, " stream %s %s\n",

1512 
w
->
¢ame
,

1513 
w
->
a˘ive
 ? "active" : "inactive");

1515 
	`li°_f‹_óch_íåy
(
p
, &
w
->
sour˚s
, 
li°_sök
) {

1516 i‡(
p
->
c⁄√˘ed
 && !p->
	`c⁄√˘ed
(
w
,Ö->
sök
))

1519 i‡(
p
->
c⁄√˘
)

1520 
ªt
 +
	`¢¥ötf
(
buf
 +Ñë, 
PAGE_SIZE
 -Ñet,

1522 
p
->
«me
 ?Ö->name : "static",

1523 
p
->
sour˚
->
«me
);

1525 
	`li°_f‹_óch_íåy
(
p
, &
w
->
söks
, 
li°_sour˚
) {

1526 i‡(
p
->
c⁄√˘ed
 && !p->
	`c⁄√˘ed
(
w
,Ö->
sök
))

1529 i‡(
p
->
c⁄√˘
)

1530 
ªt
 +
	`¢¥ötf
(
buf
 +Ñë, 
PAGE_SIZE
 -Ñet,

1532 
p
->
«me
 ?Ö->name : "static",

1533 
p
->
sök
->
«me
);

1536 
ªt
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
,Ñet);

1538 
	`k‰ì
(
buf
);

1539  
ªt
;

1540 
	}
}

1542 c⁄° 
fûe_›î©i⁄s
 
	gd≠m_widgë_powî_f›s
 = {

1543 .
›í
 = 
d≠m_widgë_powî_›í_fûe
,

1544 .
	gªad
 = 
d≠m_widgë_powî_ªad_fûe
,

1545 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1548 
	$d≠m_büs_›í_fûe
(
öode
 *öode, 
fûe
 *file)

1550 
fûe
->
¥iv©e_d©a
 = 
öode
->
i_¥iv©e
;

1552 
	}
}

1554 
ssize_t
 
	$d≠m_büs_ªad_fûe
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1555 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1557 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
 = 
fûe
->
¥iv©e_d©a
;

1558 *
Àvñ
;

1560 
d≠m
->
büs_Àvñ
) {

1561 
SND_SOC_BIAS_ON
:

1562 
Àvñ
 = "On\n";

1564 
SND_SOC_BIAS_PREPARE
:

1565 
Àvñ
 = "Prepare\n";

1567 
SND_SOC_BIAS_STANDBY
:

1568 
Àvñ
 = "Standby\n";

1570 
SND_SOC_BIAS_OFF
:

1571 
Àvñ
 = "Off\n";

1574 
	`BUG
();

1575 
Àvñ
 = "Unknown\n";

1579  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
Àvñ
,

1580 
	`°æí
(
Àvñ
));

1581 
	}
}

1583 c⁄° 
fûe_›î©i⁄s
 
	gd≠m_büs_f›s
 = {

1584 .
›í
 = 
d≠m_büs_›í_fûe
,

1585 .
	gªad
 = 
d≠m_büs_ªad_fûe
,

1586 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1589 
	$¢d_soc_d≠m_debugfs_öô
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

1590 
díåy
 *
∑ª¡
)

1592 
díåy
 *
d
;

1594 
d≠m
->
debugfs_d≠m
 = 
	`debugfs_¸óã_dú
("d≠m", 
∑ª¡
);

1596 i‡(!
d≠m
->
debugfs_d≠m
) {

1597 
	`¥ötk
(
KERN_WARNING


1602 
d
 = 
	`debugfs_¸óã_fûe
("bias_level", 0444,

1603 
d≠m
->
debugfs_d≠m
, dapm,

1604 &
d≠m_büs_f›s
);

1605 i‡(!
d
)

1606 
	`dev_w¨n
(
d≠m
->
dev
,

1608 
	}
}

1610 
	$d≠m_debugfs_add_widgë
(
¢d_soc_d≠m_widgë
 *
w
)

1612 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
 = 
w
->dapm;

1613 
díåy
 *
d
;

1615 i‡(!
d≠m
->
debugfs_d≠m
 || !
w
->
«me
)

1618 
d
 = 
	`debugfs_¸óã_fûe
(
w
->
«me
, 0444,

1619 
d≠m
->
debugfs_d≠m
, 
w
,

1620 &
d≠m_widgë_powî_f›s
);

1621 i‡(!
d
)

1622 
	`dev_w¨n
(
w
->
d≠m
->
dev
,

1624 
w
->
«me
);

1625 
	}
}

1627 
	$d≠m_debugfs_˛ónup
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

1629 
	`debugfs_ªmove_ªcursive
(
d≠m
->
debugfs_d≠m
);

1630 
	}
}

1633 
	$¢d_soc_d≠m_debugfs_öô
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

1634 
díåy
 *
∑ª¡
)

1636 
	}
}

1638 
ölöe
 
	$d≠m_debugfs_add_widgë
(
¢d_soc_d≠m_widgë
 *
w
)

1640 
	}
}

1642 
ölöe
 
	$d≠m_debugfs_˛ónup
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

1644 
	}
}

1649 
	$d≠m_mux_upd©e_powî
(
¢d_soc_d≠m_widgë
 *
widgë
,

1650 
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
, 
ch™ge
,

1651 
mux
, 
soc_íum
 *
e
)

1653 
¢d_soc_d≠m_∑th
 *
∑th
;

1654 
found
 = 0;

1656 i‡(
widgë
->
id
 !
¢d_soc_d≠m_mux
 &&

1657 
widgë
->
id
 !
¢d_soc_d≠m_vút_mux
 &&

1658 
widgë
->
id
 !
¢d_soc_d≠m_vÆue_mux
)

1659  -
ENODEV
;

1661 i‡(!
ch™ge
)

1665 
	`li°_f‹_óch_íåy
(
∑th
, &
widgë
->
d≠m
->
ˇrd
->
∑ths
, 
li°
) {

1666 i‡(
∑th
->
kc⁄åﬁ
 != kcontrol)

1669 i‡(!
∑th
->
«me
 || !
e
->
ãxts
[
mux
])

1672 
found
 = 1;

1674 i‡(!(
	`°rcmp
(
∑th
->
«me
, 
e
->
ãxts
[
mux
]))) {

1675 
∑th
->
c⁄√˘
 = 1;

1676 
	`d≠m_m¨k_dúty
(
∑th
->
sour˚
, "mux connection");

1678 i‡(
∑th
->
c⁄√˘
)

1679 
	`d≠m_m¨k_dúty
(
∑th
->
sour˚
,

1681 
∑th
->
c⁄√˘
 = 0;

1685 i‡(
found
) {

1686 
	`d≠m_m¨k_dúty
(
widgë
, "mux change");

1687 
	`d≠m_powî_widgës
(
widgë
->
d≠m
, 
SND_SOC_DAPM_STREAM_NOP
);

1691 
	}
}

1694 
	$d≠m_mixî_upd©e_powî
(
¢d_soc_d≠m_widgë
 *
widgë
,

1695 
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
, 
c⁄√˘
)

1697 
¢d_soc_d≠m_∑th
 *
∑th
;

1698 
found
 = 0;

1700 i‡(
widgë
->
id
 !
¢d_soc_d≠m_mixî
 &&

1701 
widgë
->
id
 !
¢d_soc_d≠m_mixî_«med_˘l
 &&

1702 
widgë
->
id
 !
¢d_soc_d≠m_swôch
)

1703  -
ENODEV
;

1706 
	`li°_f‹_óch_íåy
(
∑th
, &
widgë
->
d≠m
->
ˇrd
->
∑ths
, 
li°
) {

1707 i‡(
∑th
->
kc⁄åﬁ
 != kcontrol)

1711 
found
 = 1;

1712 
∑th
->
c⁄√˘
 = connect;

1713 
	`d≠m_m¨k_dúty
(
∑th
->
sour˚
, "mixer connection");

1716 i‡(
found
) {

1717 
	`d≠m_m¨k_dúty
(
widgë
, "mixer update");

1718 
	`d≠m_powî_widgës
(
widgë
->
d≠m
, 
SND_SOC_DAPM_STREAM_NOP
);

1722 
	}
}

1725 
ssize_t
 
	$d≠m_widgë_show
(
devi˚
 *
dev
,

1726 
devi˚_©åibuã
 *
©å
, *
buf
)

1728 
¢d_soc_pcm_ru¡ime
 *
πd
 =

1729 
	`c⁄èöî_of
(
dev
, 
¢d_soc_pcm_ru¡ime
, dev);

1730 
¢d_soc_codec
 *
codec
 =
πd
->codec;

1731 
¢d_soc_d≠m_widgë
 *
w
;

1732 
cou¡
 = 0;

1733 *
°©e
 = "not set";

1735 
	`li°_f‹_óch_íåy
(
w
, &
codec
->
ˇrd
->
widgës
, 
li°
) {

1736 i‡(
w
->
d≠m
 !&
codec
->dapm)

1740 
w
->
id
) {

1741 
¢d_soc_d≠m_hp
:

1742 
¢d_soc_d≠m_mic
:

1743 
¢d_soc_d≠m_•k
:

1744 
¢d_soc_d≠m_löe
:

1745 
¢d_soc_d≠m_micbüs
:

1746 
¢d_soc_d≠m_dac
:

1747 
¢d_soc_d≠m_adc
:

1748 
¢d_soc_d≠m_pga
:

1749 
¢d_soc_d≠m_out_drv
:

1750 
¢d_soc_d≠m_mixî
:

1751 
¢d_soc_d≠m_mixî_«med_˘l
:

1752 
¢d_soc_d≠m_suµly
:

1753 i‡(
w
->
«me
)

1754 
cou¡
 +
	`•rötf
(
buf
 + count, "%s: %s\n",

1755 
w
->
«me
, w->
powî
 ? "On":"Off");

1762 
codec
->
d≠m
.
büs_Àvñ
) {

1763 
SND_SOC_BIAS_ON
:

1764 
°©e
 = "On";

1766 
SND_SOC_BIAS_PREPARE
:

1767 
°©e
 = "Prepare";

1769 
SND_SOC_BIAS_STANDBY
:

1770 
°©e
 = "Standby";

1772 
SND_SOC_BIAS_OFF
:

1773 
°©e
 = "Off";

1776 
cou¡
 +
	`•rötf
(
buf
 + cou¡, "PM Sèã: %s\n", 
°©e
);

1778  
cou¡
;

1779 
	}
}

1781 
DEVICE_ATTR
(
d≠m_widgë
, 0444, 
d≠m_widgë_show
, 
NULL
);

1783 
	$¢d_soc_d≠m_sys_add
(
devi˚
 *
dev
)

1785  
	`devi˚_¸óã_fûe
(
dev
, &
dev_©å_d≠m_widgë
);

1786 
	}
}

1788 
	$¢d_soc_d≠m_sys_ªmove
(
devi˚
 *
dev
)

1790 
	`devi˚_ªmove_fûe
(
dev
, &
dev_©å_d≠m_widgë
);

1791 
	}
}

1794 
	$d≠m_‰ì_widgës
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

1796 
¢d_soc_d≠m_widgë
 *
w
, *
√xt_w
;

1797 
¢d_soc_d≠m_∑th
 *
p
, *
√xt_p
;

1799 
	`li°_f‹_óch_íåy_ß„
(
w
, 
√xt_w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
) {

1800 i‡(
w
->
d≠m
 != dapm)

1802 
	`li°_dñ
(&
w
->
li°
);

1808 
	`li°_f‹_óch_íåy_ß„
(
p
, 
√xt_p
, &
w
->
sour˚s
, 
li°_sök
) {

1809 
	`li°_dñ
(&
p
->
li°_sök
);

1810 
	`li°_dñ
(&
p
->
li°_sour˚
);

1811 
	`li°_dñ
(&
p
->
li°
);

1812 
	`k‰ì
(
p
->
l⁄g_«me
);

1813 
	`k‰ì
(
p
);

1815 
	`li°_f‹_óch_íåy_ß„
(
p
, 
√xt_p
, &
w
->
söks
, 
li°_sour˚
) {

1816 
	`li°_dñ
(&
p
->
li°_sök
);

1817 
	`li°_dñ
(&
p
->
li°_sour˚
);

1818 
	`li°_dñ
(&
p
->
li°
);

1819 
	`k‰ì
(
p
->
l⁄g_«me
);

1820 
	`k‰ì
(
p
);

1822 
	`k‰ì
(
w
->
kc⁄åﬁs
);

1823 
	`k‰ì
(
w
->
«me
);

1824 
	`k‰ì
(
w
);

1826 
	}
}

1828 
¢d_soc_d≠m_widgë
 *
	$d≠m_föd_widgë
(

1829 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
, c⁄° *
pö
,

1830 
boﬁ
 
£¨ch_Ÿhî_c⁄ãxts
)

1832 
¢d_soc_d≠m_widgë
 *
w
;

1833 
¢d_soc_d≠m_widgë
 *
ÁŒback
 = 
NULL
;

1835 
	`li°_f‹_óch_íåy
(
w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
) {

1836 i‡(!
	`°rcmp
(
w
->
«me
, 
pö
)) {

1837 i‡(
w
->
d≠m
 == dapm)

1838  
w
;

1840 
ÁŒback
 = 
w
;

1844 i‡(
£¨ch_Ÿhî_c⁄ãxts
)

1845  
ÁŒback
;

1847  
NULL
;

1848 
	}
}

1850 
	$¢d_soc_d≠m_£t_pö
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

1851 c⁄° *
pö
, 
°©us
)

1853 
¢d_soc_d≠m_widgë
 *
w
 = 
	`d≠m_föd_widgë
(
d≠m
, 
pö
, 
åue
);

1855 i‡(!
w
) {

1856 
	`dev_îr
(
d≠m
->
dev
, "d≠m: unknow¿pö %s\n", 
pö
);

1857  -
EINVAL
;

1860 
w
->
c⁄√˘ed
 = 
°©us
;

1861 i‡(
°©us
 == 0)

1862 
w
->
f‹˚
 = 0;

1863 
	`d≠m_m¨k_dúty
(
w
, "pin configuration");

1866 
	}
}

1877 
	$¢d_soc_d≠m_sync
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

1883 i‡(!
d≠m
->
ˇrd
 || !d≠m->ˇrd->
ö°™tüãd
)

1886  
	`d≠m_powî_widgës
(
d≠m
, 
SND_SOC_DAPM_STREAM_NOP
);

1887 
	}
}

1888 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_sync
);

1890 
	$¢d_soc_d≠m_add_rouã
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

1891 c⁄° 
¢d_soc_d≠m_rouã
 *
rouã
)

1893 
¢d_soc_d≠m_∑th
 *
∑th
;

1894 
¢d_soc_d≠m_widgë
 *
wsour˚
 = 
NULL
, *
wsök
 = NULL, *
w
;

1895 
¢d_soc_d≠m_widgë
 *
wtsour˚
 = 
NULL
, *
wtsök
 = NULL;

1896 c⁄° *
sök
;

1897 c⁄° *
c⁄åﬁ
 = 
rouã
->control;

1898 c⁄° *
sour˚
;

1899 
¥efixed_sök
[80];

1900 
¥efixed_sour˚
[80];

1901 
ªt
 = 0;

1903 i‡(
d≠m
->
codec
 && d≠m->codec->
«me_¥efix
) {

1904 
	`¢¥ötf
(
¥efixed_sök
, (prefixed_sink), "%s %s",

1905 
d≠m
->
codec
->
«me_¥efix
, 
rouã
->
sök
);

1906 
sök
 = 
¥efixed_sök
;

1907 
	`¢¥ötf
(
¥efixed_sour˚
, (prefixed_source), "%s %s",

1908 
d≠m
->
codec
->
«me_¥efix
, 
rouã
->
sour˚
);

1909 
sour˚
 = 
¥efixed_sour˚
;

1911 
sök
 = 
rouã
->sink;

1912 
sour˚
 = 
rouã
->source;

1919 
	`li°_f‹_óch_íåy
(
w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
) {

1920 i‡(!
wsök
 && !(
	`°rcmp
(
w
->
«me
, 
sök
))) {

1921 
wtsök
 = 
w
;

1922 i‡(
w
->
d≠m
 == dapm)

1923 
wsök
 = 
w
;

1926 i‡(!
wsour˚
 && !(
	`°rcmp
(
w
->
«me
, 
sour˚
))) {

1927 
wtsour˚
 = 
w
;

1928 i‡(
w
->
d≠m
 == dapm)

1929 
wsour˚
 = 
w
;

1933 i‡(!
wsök
)

1934 
wsök
 = 
wtsök
;

1935 i‡(!
wsour˚
)

1936 
wsour˚
 = 
wtsour˚
;

1938 i‡(
wsour˚
 =
NULL
 || 
wsök
 == NULL)

1939  -
ENODEV
;

1941 
∑th
 = 
	`kzÆloc
((
¢d_soc_d≠m_∑th
), 
GFP_KERNEL
);

1942 i‡(!
∑th
)

1943  -
ENOMEM
;

1945 
∑th
->
sour˚
 = 
wsour˚
;

1946 
∑th
->
sök
 = 
wsök
;

1947 
∑th
->
c⁄√˘ed
 = 
rouã
->connected;

1948 
	`INIT_LIST_HEAD
(&
∑th
->
li°
);

1949 
	`INIT_LIST_HEAD
(&
∑th
->
li°_sour˚
);

1950 
	`INIT_LIST_HEAD
(&
∑th
->
li°_sök
);

1953 i‡(
wsök
->
id
 =
¢d_soc_d≠m_öput
) {

1954 i‡(
wsour˚
->
id
 =
¢d_soc_d≠m_micbüs
 ||

1955 
wsour˚
->
id
 =
¢d_soc_d≠m_mic
 ||

1956 
wsour˚
->
id
 =
¢d_soc_d≠m_löe
 ||

1957 
wsour˚
->
id
 =
¢d_soc_d≠m_ouçut
)

1958 
wsök
->
ext
 = 1;

1960 i‡(
wsour˚
->
id
 =
¢d_soc_d≠m_ouçut
) {

1961 i‡(
wsök
->
id
 =
¢d_soc_d≠m_•k
 ||

1962 
wsök
->
id
 =
¢d_soc_d≠m_hp
 ||

1963 
wsök
->
id
 =
¢d_soc_d≠m_löe
 ||

1964 
wsök
->
id
 =
¢d_soc_d≠m_öput
)

1965 
wsour˚
->
ext
 = 1;

1969 i‡(
c⁄åﬁ
 =
NULL
) {

1970 
	`li°_add
(&
∑th
->
li°
, &
d≠m
->
ˇrd
->
∑ths
);

1971 
	`li°_add
(&
∑th
->
li°_sök
, &
wsök
->
sour˚s
);

1972 
	`li°_add
(&
∑th
->
li°_sour˚
, &
wsour˚
->
söks
);

1973 
∑th
->
c⁄√˘
 = 1;

1978 
wsök
->
id
) {

1979 
¢d_soc_d≠m_adc
:

1980 
¢d_soc_d≠m_dac
:

1981 
¢d_soc_d≠m_pga
:

1982 
¢d_soc_d≠m_out_drv
:

1983 
¢d_soc_d≠m_öput
:

1984 
¢d_soc_d≠m_ouçut
:

1985 
¢d_soc_d≠m_micbüs
:

1986 
¢d_soc_d≠m_vmid
:

1987 
¢d_soc_d≠m_¥e
:

1988 
¢d_soc_d≠m_po°
:

1989 
¢d_soc_d≠m_suµly
:

1990 
¢d_soc_d≠m_aif_ö
:

1991 
¢d_soc_d≠m_aif_out
:

1992 
	`li°_add
(&
∑th
->
li°
, &
d≠m
->
ˇrd
->
∑ths
);

1993 
	`li°_add
(&
∑th
->
li°_sök
, &
wsök
->
sour˚s
);

1994 
	`li°_add
(&
∑th
->
li°_sour˚
, &
wsour˚
->
söks
);

1995 
∑th
->
c⁄√˘
 = 1;

1997 
¢d_soc_d≠m_mux
:

1998 
¢d_soc_d≠m_vút_mux
:

1999 
¢d_soc_d≠m_vÆue_mux
:

2000 
ªt
 = 
	`d≠m_c⁄√˘_mux
(
d≠m
, 
wsour˚
, 
wsök
, 
∑th
, 
c⁄åﬁ
,

2001 &
wsök
->
kc⁄åﬁ_√ws
[0]);

2002 i‡(
ªt
 != 0)

2003 
îr
;

2005 
¢d_soc_d≠m_swôch
:

2006 
¢d_soc_d≠m_mixî
:

2007 
¢d_soc_d≠m_mixî_«med_˘l
:

2008 
ªt
 = 
	`d≠m_c⁄√˘_mixî
(
d≠m
, 
wsour˚
, 
wsök
, 
∑th
, 
c⁄åﬁ
);

2009 i‡(
ªt
 != 0)

2010 
îr
;

2012 
¢d_soc_d≠m_hp
:

2013 
¢d_soc_d≠m_mic
:

2014 
¢d_soc_d≠m_löe
:

2015 
¢d_soc_d≠m_•k
:

2016 
	`li°_add
(&
∑th
->
li°
, &
d≠m
->
ˇrd
->
∑ths
);

2017 
	`li°_add
(&
∑th
->
li°_sök
, &
wsök
->
sour˚s
);

2018 
	`li°_add
(&
∑th
->
li°_sour˚
, &
wsour˚
->
söks
);

2019 
∑th
->
c⁄√˘
 = 0;

2024 
îr
:

2025 
	`dev_w¨n
(
d≠m
->
dev
, "asoc:Ço dapm match for %s --> %s --> %s\n",

2026 
sour˚
, 
c⁄åﬁ
, 
sök
);

2027 
	`k‰ì
(
∑th
);

2028  
ªt
;

2029 
	}
}

2044 
	$¢d_soc_d≠m_add_rouãs
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2045 c⁄° 
¢d_soc_d≠m_rouã
 *
rouã
, 
num
)

2047 
i
, 
ªt
;

2049 
i
 = 0; i < 
num
; i++) {

2050 
ªt
 = 
	`¢d_soc_d≠m_add_rouã
(
d≠m
, 
rouã
);

2051 i‡(
ªt
 < 0) {

2052 
	`dev_îr
(
d≠m
->
dev
, "FailedÅoáddÑoute %s->%s\n",

2053 
rouã
->
sour˚
,Ñouã->
sök
);

2054  
ªt
;

2056 
rouã
++;

2060 
	}
}

2061 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_add_rouãs
);

2063 
	$¢d_soc_d≠m_wók_rouã
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2064 c⁄° 
¢d_soc_d≠m_rouã
 *
rouã
)

2066 
¢d_soc_d≠m_widgë
 *
sour˚
 = 
	`d≠m_föd_widgë
(
d≠m
,

2067 
rouã
->
sour˚
,

2068 
åue
);

2069 
¢d_soc_d≠m_widgë
 *
sök
 = 
	`d≠m_föd_widgë
(
d≠m
,

2070 
rouã
->
sök
,

2071 
åue
);

2072 
¢d_soc_d≠m_∑th
 *
∑th
;

2073 
cou¡
 = 0;

2075 i‡(!
sour˚
) {

2076 
	`dev_îr
(
d≠m
->
dev
, "UnableÅo find source %s for weakÑoute\n",

2077 
rouã
->
sour˚
);

2078  -
ENODEV
;

2081 i‡(!
sök
) {

2082 
	`dev_îr
(
d≠m
->
dev
, "UnableÅo find sink %s for weakÑoute\n",

2083 
rouã
->
sök
);

2084  -
ENODEV
;

2087 i‡(
rouã
->
c⁄åﬁ
 ||Ñouã->
c⁄√˘ed
)

2088 
	`dev_w¨n
(
d≠m
->
dev
, "Ignoring control for weakÑoute %s->%s\n",

2089 
rouã
->
sour˚
,Ñouã->
sök
);

2091 
	`li°_f‹_óch_íåy
(
∑th
, &
sour˚
->
söks
, 
li°_sour˚
) {

2092 i‡(
∑th
->
sök
 == sink) {

2093 
∑th
->
wók
 = 1;

2094 
cou¡
++;

2098 i‡(
cou¡
 == 0)

2099 
	`dev_îr
(
d≠m
->
dev
, "NoÖath found for weakÑoute %s->%s\n",

2100 
rouã
->
sour˚
,Ñouã->
sök
);

2101 i‡(
cou¡
 > 1)

2102 
	`dev_w¨n
(
d≠m
->
dev
, "%dÖaths found for weakÑoute %s->%s\n",

2103 
cou¡
, 
rouã
->
sour˚
,Ñouã->
sök
);

2106 
	}
}

2124 
	$¢d_soc_d≠m_wók_rouãs
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2125 c⁄° 
¢d_soc_d≠m_rouã
 *
rouã
, 
num
)

2127 
i
, 
îr
;

2128 
ªt
 = 0;

2130 
i
 = 0; i < 
num
; i++) {

2131 
îr
 = 
	`¢d_soc_d≠m_wók_rouã
(
d≠m
, 
rouã
);

2132 i‡(
îr
)

2133 
ªt
 = 
îr
;

2134 
rouã
++;

2137  
ªt
;

2138 
	}
}

2139 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_wók_rouãs
);

2149 
	$¢d_soc_d≠m_√w_widgës
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

2151 
¢d_soc_d≠m_widgë
 *
w
;

2152 
vÆ
;

2154 
	`li°_f‹_óch_íåy
(
w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
)

2156 i‡(
w
->
√w
)

2159 i‡(
w
->
num_kc⁄åﬁs
) {

2160 
w
->
kc⁄åﬁs
 = 
	`kzÆloc
(w->
num_kc⁄åﬁs
 *

2161 (
¢d_kc⁄åﬁ
 *),

2162 
GFP_KERNEL
);

2163 i‡(!
w
->
kc⁄åﬁs
)

2164  -
ENOMEM
;

2167 
w
->
id
) {

2168 
¢d_soc_d≠m_swôch
:

2169 
¢d_soc_d≠m_mixî
:

2170 
¢d_soc_d≠m_mixî_«med_˘l
:

2171 
	`d≠m_√w_mixî
(
w
);

2173 
¢d_soc_d≠m_mux
:

2174 
¢d_soc_d≠m_vút_mux
:

2175 
¢d_soc_d≠m_vÆue_mux
:

2176 
	`d≠m_√w_mux
(
w
);

2178 
¢d_soc_d≠m_pga
:

2179 
¢d_soc_d≠m_out_drv
:

2180 
	`d≠m_√w_pga
(
w
);

2187 i‡(
w
->
ªg
 >= 0) {

2188 
vÆ
 = 
	`soc_widgë_ªad
(
w
, w->
ªg
);

2189 
vÆ
 &1 << 
w
->
shi·
;

2190 i‡(
w
->
övît
)

2191 
vÆ
 = !val;

2193 i‡(
vÆ
)

2194 
w
->
powî
 = 1;

2197 
w
->
√w
 = 1;

2199 
	`d≠m_m¨k_dúty
(
w
, "new widget");

2200 
	`d≠m_debugfs_add_widgë
(
w
);

2203 
	`d≠m_powî_widgës
(
d≠m
, 
SND_SOC_DAPM_STREAM_NOP
);

2205 
	}
}

2206 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_√w_widgës
);

2217 
	$¢d_soc_d≠m_gë_vﬁsw
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2218 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2220 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2221 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2222 
soc_mixî_c⁄åﬁ
 *
mc
 =

2223 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2224 
ªg
 = 
mc
->reg;

2225 
shi·
 = 
mc
->shift;

2226 
rshi·
 = 
mc
->rshift;

2227 
max
 = 
mc
->max;

2228 
övît
 = 
mc
->invert;

2229 
mask
 = (1 << 
	`Ês
(
max
)) - 1;

2231 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0] =

2232 (
	`¢d_soc_ªad
(
widgë
->
codec
, 
ªg
Ë>> 
shi·
Ë& 
mask
;

2233 i‡(
shi·
 !
rshi·
)

2234 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1] =

2235 (
	`¢d_soc_ªad
(
widgë
->
codec
, 
ªg
Ë>> 
rshi·
Ë& 
mask
;

2236 i‡(
övît
) {

2237 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0] =

2238 
max
 - 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0];

2239 i‡(
shi·
 !
rshi·
)

2240 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1] =

2241 
max
 - 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[1];

2245 
	}
}

2246 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_gë_vﬁsw
);

2257 
	$¢d_soc_d≠m_put_vﬁsw
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2258 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2260 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2261 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2262 
¢d_soc_codec
 *
codec
 = 
widgë
->codec;

2263 
soc_mixî_c⁄åﬁ
 *
mc
 =

2264 (
soc_mixî_c⁄åﬁ
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2265 
ªg
 = 
mc
->reg;

2266 
shi·
 = 
mc
->shift;

2267 
max
 = 
mc
->max;

2268 
mask
 = (1 << 
	`Ês
(
max
)) - 1;

2269 
övît
 = 
mc
->invert;

2270 
vÆ
;

2271 
c⁄√˘
, 
ch™ge
;

2272 
¢d_soc_d≠m_upd©e
 
upd©e
;

2273 
wi
;

2275 
vÆ
 = (
uc⁄åﬁ
->
vÆue
.
öãgî
.vÆue[0] & 
mask
);

2277 i‡(
övît
)

2278 
vÆ
 = 
max
 - val;

2279 
mask
 = mask << 
shi·
;

2280 
vÆ
 = vÆ << 
shi·
;

2282 i‡(
vÆ
)

2284 
c⁄√˘
 = 
övît
 ? 0 : 1;

2287 
c⁄√˘
 = 
övît
 ? 1 : 0;

2289 
	`muãx_lock
(&
codec
->
muãx
);

2291 
ch™ge
 = 
	`¢d_soc_ã°_bôs
(
widgë
->
codec
, 
ªg
, 
mask
, 
vÆ
);

2292 i‡(
ch™ge
) {

2293 
wi
 = 0; wò< 
wli°
->
num_widgës
; wi++) {

2294 
widgë
 = 
wli°
->
widgës
[
wi
];

2296 
widgë
->
vÆue
 = 
vÆ
;

2298 
upd©e
.
kc⁄åﬁ
 = kcontrol;

2299 
upd©e
.
widgë
 = widget;

2300 
upd©e
.
ªg
 =Ñeg;

2301 
upd©e
.
mask
 = mask;

2302 
upd©e
.
vÆ
 = val;

2303 
widgë
->
d≠m
->
upd©e
 = &update;

2305 
	`d≠m_mixî_upd©e_powî
(
widgë
, 
kc⁄åﬁ
, 
c⁄√˘
);

2307 
widgë
->
d≠m
->
upd©e
 = 
NULL
;

2311 
	`muãx_u∆ock
(&
codec
->
muãx
);

2313 
	}
}

2314 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_put_vﬁsw
);

2325 
	$¢d_soc_d≠m_gë_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2326 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2328 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2329 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2330 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2331 
vÆ
, 
bômask
;

2333 
bômask
 = 1; bômask < 
e
->
max
; bitmask <<= 1)

2335 
vÆ
 = 
	`¢d_soc_ªad
(
widgë
->
codec
, 
e
->
ªg
);

2336 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] = (
vÆ
 >> 
e
->
shi·_l
Ë& (
bômask
 - 1);

2337 i‡(
e
->
shi·_l
 !e->
shi·_r
)

2338 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] =

2339 (
vÆ
 >> 
e
->
shi·_r
Ë& (
bômask
 - 1);

2342 
	}
}

2343 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_gë_íum_doubÀ
);

2354 
	$¢d_soc_d≠m_put_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2355 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2357 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2358 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2359 
¢d_soc_codec
 *
codec
 = 
widgë
->codec;

2360 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2361 
vÆ
, 
mux
, 
ch™ge
;

2362 
mask
, 
bômask
;

2363 
¢d_soc_d≠m_upd©e
 
upd©e
;

2364 
wi
;

2366 
bômask
 = 1; bômask < 
e
->
max
; bitmask <<= 1)

2368 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] > 
e
->
max
 - 1)

2369  -
EINVAL
;

2370 
mux
 = 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0];

2371 
vÆ
 = 
mux
 << 
e
->
shi·_l
;

2372 
mask
 = (
bômask
 - 1Ë<< 
e
->
shi·_l
;

2373 i‡(
e
->
shi·_l
 !e->
shi·_r
) {

2374 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] > 
e
->
max
 - 1)

2375  -
EINVAL
;

2376 
vÆ
 |
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] << 
e
->
shi·_r
;

2377 
mask
 |(
bômask
 - 1Ë<< 
e
->
shi·_r
;

2380 
	`muãx_lock
(&
codec
->
muãx
);

2382 
ch™ge
 = 
	`¢d_soc_ã°_bôs
(
widgë
->
codec
, 
e
->
ªg
, 
mask
, 
vÆ
);

2383 i‡(
ch™ge
) {

2384 
wi
 = 0; wò< 
wli°
->
num_widgës
; wi++) {

2385 
widgë
 = 
wli°
->
widgës
[
wi
];

2387 
widgë
->
vÆue
 = 
vÆ
;

2389 
upd©e
.
kc⁄åﬁ
 = kcontrol;

2390 
upd©e
.
widgë
 = widget;

2391 
upd©e
.
ªg
 = 
e
->reg;

2392 
upd©e
.
mask
 = mask;

2393 
upd©e
.
vÆ
 = val;

2394 
widgë
->
d≠m
->
upd©e
 = &update;

2396 
	`d≠m_mux_upd©e_powî
(
widgë
, 
kc⁄åﬁ
, 
ch™ge
, 
mux
, 
e
);

2398 
widgë
->
d≠m
->
upd©e
 = 
NULL
;

2402 
	`muãx_u∆ock
(&
codec
->
muãx
);

2403  
ch™ge
;

2404 
	}
}

2405 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_put_íum_doubÀ
);

2414 
	$¢d_soc_d≠m_gë_íum_vút
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2415 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2417 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2418 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2420 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] = 
widgë
->value;

2423 
	}
}

2424 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_gë_íum_vút
);

2433 
	$¢d_soc_d≠m_put_íum_vút
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2434 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2436 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2437 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2438 
¢d_soc_codec
 *
codec
 = 
widgë
->codec;

2439 
soc_íum
 *
e
 =

2440 (
soc_íum
 *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2441 
ch™ge
;

2442 
ªt
 = 0;

2443 
wi
;

2445 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] >
e
->
max
)

2446  -
EINVAL
;

2448 
	`muãx_lock
(&
codec
->
muãx
);

2450 
ch™ge
 = 
widgë
->
vÆue
 !
uc⁄åﬁ
->vÆue.
íumî©ed
.
ôem
[0];

2451 i‡(
ch™ge
) {

2452 
wi
 = 0; wò< 
wli°
->
num_widgës
; wi++) {

2453 
widgë
 = 
wli°
->
widgës
[
wi
];

2455 
widgë
->
vÆue
 = 
uc⁄åﬁ
->vÆue.
íumî©ed
.
ôem
[0];

2457 
	`d≠m_mux_upd©e_powî
(
widgë
, 
kc⁄åﬁ
, 
ch™ge
,

2458 
widgë
->
vÆue
, 
e
);

2462 
	`muãx_u∆ock
(&
codec
->
muãx
);

2463  
ªt
;

2464 
	}
}

2465 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_put_íum_vút
);

2480 
	$¢d_soc_d≠m_gë_vÆue_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2481 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2483 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2484 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2485 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2486 
ªg_vÆ
, 
vÆ
, 
mux
;

2488 
ªg_vÆ
 = 
	`¢d_soc_ªad
(
widgë
->
codec
, 
e
->
ªg
);

2489 
vÆ
 = (
ªg_vÆ
 >> 
e
->
shi·_l
Ë&É->
mask
;

2490 
mux
 = 0; mux < 
e
->
max
; mux++) {

2491 i‡(
vÆ
 =
e
->
vÆues
[
mux
])

2494 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] = 
mux
;

2495 i‡(
e
->
shi·_l
 !e->
shi·_r
) {

2496 
vÆ
 = (
ªg_vÆ
 >> 
e
->
shi·_r
Ë&É->
mask
;

2497 
mux
 = 0; mux < 
e
->
max
; mux++) {

2498 i‡(
vÆ
 =
e
->
vÆues
[
mux
])

2501 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] = 
mux
;

2505 
	}
}

2506 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_gë_vÆue_íum_doubÀ
);

2521 
	$¢d_soc_d≠m_put_vÆue_íum_doubÀ
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2522 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2524 
¢d_soc_d≠m_widgë_li°
 *
wli°
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2525 
¢d_soc_d≠m_widgë
 *
widgë
 = 
wli°
->
widgës
[0];

2526 
¢d_soc_codec
 *
codec
 = 
widgë
->codec;

2527 
soc_íum
 *
e
 = (soc_íum *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2528 
vÆ
, 
mux
, 
ch™ge
;

2529 
mask
;

2530 
¢d_soc_d≠m_upd©e
 
upd©e
;

2531 
wi
;

2533 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0] > 
e
->
max
 - 1)

2534  -
EINVAL
;

2535 
mux
 = 
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0];

2536 
vÆ
 = 
e
->
vÆues
[
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[0]] <<É->
shi·_l
;

2537 
mask
 = 
e
->mask <<É->
shi·_l
;

2538 i‡(
e
->
shi·_l
 !e->
shi·_r
) {

2539 i‡(
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1] > 
e
->
max
 - 1)

2540  -
EINVAL
;

2541 
vÆ
 |
e
->
vÆues
[
uc⁄åﬁ
->
vÆue
.
íumî©ed
.
ôem
[1]] <<É->
shi·_r
;

2542 
mask
 |
e
->mask <<É->
shi·_r
;

2545 
	`muãx_lock
(&
codec
->
muãx
);

2547 
ch™ge
 = 
	`¢d_soc_ã°_bôs
(
widgë
->
codec
, 
e
->
ªg
, 
mask
, 
vÆ
);

2548 i‡(
ch™ge
) {

2549 
wi
 = 0; wò< 
wli°
->
num_widgës
; wi++) {

2550 
widgë
 = 
wli°
->
widgës
[
wi
];

2552 
widgë
->
vÆue
 = 
vÆ
;

2554 
upd©e
.
kc⁄åﬁ
 = kcontrol;

2555 
upd©e
.
widgë
 = widget;

2556 
upd©e
.
ªg
 = 
e
->reg;

2557 
upd©e
.
mask
 = mask;

2558 
upd©e
.
vÆ
 = val;

2559 
widgë
->
d≠m
->
upd©e
 = &update;

2561 
	`d≠m_mux_upd©e_powî
(
widgë
, 
kc⁄åﬁ
, 
ch™ge
, 
mux
, 
e
);

2563 
widgë
->
d≠m
->
upd©e
 = 
NULL
;

2567 
	`muãx_u∆ock
(&
codec
->
muãx
);

2568  
ch™ge
;

2569 
	}
}

2570 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_put_vÆue_íum_doubÀ
);

2580 
	$¢d_soc_d≠m_öfo_pö_swôch
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2581 
¢d_˘l_ñem_öfo
 *
uöfo
)

2583 
uöfo
->
ty≥
 = 
SNDRV_CTL_ELEM_TYPE_BOOLEAN
;

2584 
uöfo
->
cou¡
 = 1;

2585 
uöfo
->
vÆue
.
öãgî
.
mö
 = 0;

2586 
uöfo
->
vÆue
.
öãgî
.
max
 = 1;

2589 
	}
}

2590 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_öfo_pö_swôch
);

2598 
	$¢d_soc_d≠m_gë_pö_swôch
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2599 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2601 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2602 c⁄° *
pö
 = (c⁄° *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2604 
	`muãx_lock
(&
codec
->
muãx
);

2606 
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0] =

2607 
	`¢d_soc_d≠m_gë_pö_°©us
(&
codec
->
d≠m
, 
pö
);

2609 
	`muãx_u∆ock
(&
codec
->
muãx
);

2612 
	}
}

2613 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_gë_pö_swôch
);

2621 
	$¢d_soc_d≠m_put_pö_swôch
(
¢d_kc⁄åﬁ
 *
kc⁄åﬁ
,

2622 
¢d_˘l_ñem_vÆue
 *
uc⁄åﬁ
)

2624 
¢d_soc_codec
 *
codec
 = 
	`¢d_kc⁄åﬁ_chù
(
kc⁄åﬁ
);

2625 c⁄° *
pö
 = (c⁄° *)
kc⁄åﬁ
->
¥iv©e_vÆue
;

2627 
	`muãx_lock
(&
codec
->
muãx
);

2629 i‡(
uc⁄åﬁ
->
vÆue
.
öãgî
.value[0])

2630 
	`¢d_soc_d≠m_íabÀ_pö
(&
codec
->
d≠m
, 
pö
);

2632 
	`¢d_soc_d≠m_dißbÀ_pö
(&
codec
->
d≠m
, 
pö
);

2634 
	`¢d_soc_d≠m_sync
(&
codec
->
d≠m
);

2636 
	`muãx_u∆ock
(&
codec
->
muãx
);

2639 
	}
}

2640 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_put_pö_swôch
);

2651 
	$¢d_soc_d≠m_√w_c⁄åﬁ
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2652 c⁄° 
¢d_soc_d≠m_widgë
 *
widgë
)

2654 
¢d_soc_d≠m_widgë
 *
w
;

2655 
size_t
 
«me_Àn
;

2657 i‡((
w
 = 
	`d≠m_˙ew_widgë
(
widgë
)Ë=
NULL
)

2658  -
ENOMEM
;

2660 
«me_Àn
 = 
	`°æí
(
widgë
->
«me
) + 1;

2661 i‡(
d≠m
->
codec
 && d≠m->codec->
«me_¥efix
)

2662 
«me_Àn
 +1 + 
	`°æí
(
d≠m
->
codec
->
«me_¥efix
);

2663 
w
->
«me
 = 
	`kmÆloc
(
«me_Àn
, 
GFP_KERNEL
);

2664 i‡(
w
->
«me
 =
NULL
) {

2665 
	`k‰ì
(
w
);

2666  -
ENOMEM
;

2668 i‡(
d≠m
->
codec
 && d≠m->codec->
«me_¥efix
)

2669 
	`¢¥ötf
(
w
->
«me
, 
«me_Àn
, "%s %s",

2670 
d≠m
->
codec
->
«me_¥efix
, 
widgë
->
«me
);

2672 
	`¢¥ötf
(
w
->
«me
, 
«me_Àn
, "%s", 
widgë
->name);

2674 
w
->
id
) {

2675 
¢d_soc_d≠m_swôch
:

2676 
¢d_soc_d≠m_mixî
:

2677 
¢d_soc_d≠m_mixî_«med_˘l
:

2678 
w
->
powî_check
 = 
d≠m_gíîic_check_powî
;

2680 
¢d_soc_d≠m_mux
:

2681 
¢d_soc_d≠m_vút_mux
:

2682 
¢d_soc_d≠m_vÆue_mux
:

2683 
w
->
powî_check
 = 
d≠m_gíîic_check_powî
;

2685 
¢d_soc_d≠m_adc
:

2686 
¢d_soc_d≠m_aif_out
:

2687 
w
->
powî_check
 = 
d≠m_adc_check_powî
;

2689 
¢d_soc_d≠m_dac
:

2690 
¢d_soc_d≠m_aif_ö
:

2691 
w
->
powî_check
 = 
d≠m_dac_check_powî
;

2693 
¢d_soc_d≠m_pga
:

2694 
¢d_soc_d≠m_out_drv
:

2695 
¢d_soc_d≠m_öput
:

2696 
¢d_soc_d≠m_ouçut
:

2697 
¢d_soc_d≠m_micbüs
:

2698 
¢d_soc_d≠m_•k
:

2699 
¢d_soc_d≠m_hp
:

2700 
¢d_soc_d≠m_mic
:

2701 
¢d_soc_d≠m_löe
:

2702 
w
->
powî_check
 = 
d≠m_gíîic_check_powî
;

2704 
¢d_soc_d≠m_suµly
:

2705 
w
->
powî_check
 = 
d≠m_suµly_check_powî
;

2708 
w
->
powî_check
 = 
d≠m_Æways_⁄_check_powî
;

2712 
d≠m
->
n_widgës
++;

2713 
w
->
d≠m
 = dapm;

2714 
w
->
codec
 = 
d≠m
->codec;

2715 
w
->
∂©f‹m
 = 
d≠m
->platform;

2716 
	`INIT_LIST_HEAD
(&
w
->
sour˚s
);

2717 
	`INIT_LIST_HEAD
(&
w
->
söks
);

2718 
	`INIT_LIST_HEAD
(&
w
->
li°
);

2719 
	`INIT_LIST_HEAD
(&
w
->
dúty
);

2720 
	`li°_add
(&
w
->
li°
, &
d≠m
->
ˇrd
->
widgës
);

2723 
w
->
c⁄√˘ed
 = 1;

2725 
	}
}

2726 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_√w_c⁄åﬁ
);

2738 
	$¢d_soc_d≠m_√w_c⁄åﬁs
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2739 c⁄° 
¢d_soc_d≠m_widgë
 *
widgë
,

2740 
num
)

2742 
i
, 
ªt
;

2744 
i
 = 0; i < 
num
; i++) {

2745 
ªt
 = 
	`¢d_soc_d≠m_√w_c⁄åﬁ
(
d≠m
, 
widgë
);

2746 i‡(
ªt
 < 0) {

2747 
	`dev_îr
(
d≠m
->
dev
,

2749 
widgë
->
«me
, 
ªt
);

2750  
ªt
;

2752 
widgë
++;

2755 
	}
}

2756 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_√w_c⁄åﬁs
);

2758 
	$soc_d≠m_°ªam_evít
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2759 c⁄° *
°ªam
, 
evít
)

2761 
¢d_soc_d≠m_widgë
 *
w
;

2763 
	`li°_f‹_óch_íåy
(
w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
)

2765 i‡(!
w
->
¢ame
 || w->
d≠m
 != dapm)

2767 
	`dev_vdbg
(
w
->
d≠m
->
dev
, "widget %s\n %s stream %sÉvent %d\n",

2768 
w
->
«me
, w->
¢ame
, 
°ªam
, 
evít
);

2769 i‡(
	`°r°r
(
w
->
¢ame
, 
°ªam
)) {

2770 
	`d≠m_m¨k_dúty
(
w
, "streamÉvent");

2771 
evít
) {

2772 
SND_SOC_DAPM_STREAM_START
:

2773 
w
->
a˘ive
 = 1;

2775 
SND_SOC_DAPM_STREAM_STOP
:

2776 
w
->
a˘ive
 = 0;

2778 
SND_SOC_DAPM_STREAM_SUSPEND
:

2779 
SND_SOC_DAPM_STREAM_RESUME
:

2780 
SND_SOC_DAPM_STREAM_PAUSE_PUSH
:

2781 
SND_SOC_DAPM_STREAM_PAUSE_RELEASE
:

2787 
	`d≠m_powî_widgës
(
d≠m
, 
evít
);

2790 i‡(
d≠m
->
°ªam_evít
)

2791 
d≠m
->
	`°ªam_evít
(d≠m, 
evít
);

2792 
	}
}

2805 
	$¢d_soc_d≠m_°ªam_evít
(
¢d_soc_pcm_ru¡ime
 *
πd
,

2806 c⁄° *
°ªam
, 
evít
)

2808 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

2810 i‡(
°ªam
 =
NULL
)

2813 
	`muãx_lock
(&
codec
->
muãx
);

2814 
	`soc_d≠m_°ªam_evít
(&
codec
->
d≠m
, 
°ªam
, 
evít
);

2815 
	`muãx_u∆ock
(&
codec
->
muãx
);

2817 
	}
}

2829 
	$¢d_soc_d≠m_íabÀ_pö
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
, c⁄° *
pö
)

2831  
	`¢d_soc_d≠m_£t_pö
(
d≠m
, 
pö
, 1);

2832 
	}
}

2833 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_íabÀ_pö
);

2847 
	$¢d_soc_d≠m_f‹˚_íabÀ_pö
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2848 c⁄° *
pö
)

2850 
¢d_soc_d≠m_widgë
 *
w
 = 
	`d≠m_föd_widgë
(
d≠m
, 
pö
, 
åue
);

2852 i‡(!
w
) {

2853 
	`dev_îr
(
d≠m
->
dev
, "d≠m: unknow¿pö %s\n", 
pö
);

2854  -
EINVAL
;

2857 
	`dev_dbg
(
w
->
d≠m
->
dev
, "d≠m: f‹˚É«bÀÖö %s\n", 
pö
);

2858 
w
->
c⁄√˘ed
 = 1;

2859 
w
->
f‹˚
 = 1;

2860 
	`d≠m_m¨k_dúty
(
w
, "forceÉnable");

2863 
	}
}

2864 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_f‹˚_íabÀ_pö
);

2875 
	$¢d_soc_d≠m_dißbÀ_pö
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2876 c⁄° *
pö
)

2878  
	`¢d_soc_d≠m_£t_pö
(
d≠m
, 
pö
, 0);

2879 
	}
}

2880 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_dißbÀ_pö
);

2896 
	$¢d_soc_d≠m_nc_pö
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
, c⁄° *
pö
)

2898  
	`¢d_soc_d≠m_£t_pö
(
d≠m
, 
pö
, 0);

2899 
	}
}

2900 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_nc_pö
);

2911 
	$¢d_soc_d≠m_gë_pö_°©us
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2912 c⁄° *
pö
)

2914 
¢d_soc_d≠m_widgë
 *
w
 = 
	`d≠m_föd_widgë
(
d≠m
, 
pö
, 
åue
);

2916 i‡(
w
)

2917  
w
->
c⁄√˘ed
;

2920 
	}
}

2921 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_gë_pö_°©us
);

2934 
	$¢d_soc_d≠m_ign‹e_su•íd
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
,

2935 c⁄° *
pö
)

2937 
¢d_soc_d≠m_widgë
 *
w
 = 
	`d≠m_föd_widgë
(
d≠m
, 
pö
, 
Ál£
);

2939 i‡(!
w
) {

2940 
	`dev_îr
(
d≠m
->
dev
, "d≠m: unknow¿pö %s\n", 
pö
);

2941  -
EINVAL
;

2944 
w
->
ign‹e_su•íd
 = 1;

2947 
	}
}

2948 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_ign‹e_su•íd
);

2956 
	$¢d_soc_d≠m_‰ì
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

2958 
	`¢d_soc_d≠m_sys_ªmove
(
d≠m
->
dev
);

2959 
	`d≠m_debugfs_˛ónup
(
d≠m
);

2960 
	`d≠m_‰ì_widgës
(
d≠m
);

2961 
	`li°_dñ
(&
d≠m
->
li°
);

2962 
	}
}

2963 
EXPORT_SYMBOL_GPL
(
¢d_soc_d≠m_‰ì
);

2965 
	$soc_d≠m_shutdown_codec
(
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
)

2967 
¢d_soc_d≠m_widgë
 *
w
;

2968 
	`LIST_HEAD
(
down_li°
);

2969 
powîdown
 = 0;

2971 
	`li°_f‹_óch_íåy
(
w
, &
d≠m
->
ˇrd
->
widgës
, 
li°
) {

2972 i‡(
w
->
d≠m
 != dapm)

2974 i‡(
w
->
powî
) {

2975 
	`d≠m_£q_ö£π
(
w
, &
down_li°
, 
Ál£
);

2976 
w
->
powî
 = 0;

2977 
powîdown
 = 1;

2984 i‡(
powîdown
) {

2985 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d≠m
, 
SND_SOC_BIAS_PREPARE
);

2986 
	`d≠m_£q_run
(
d≠m
, &
down_li°
, 0, 
Ál£
);

2987 
	`¢d_soc_d≠m_£t_büs_Àvñ
(
d≠m
, 
SND_SOC_BIAS_STANDBY
);

2989 
	}
}

2994 
	$¢d_soc_d≠m_shutdown
(
¢d_soc_ˇrd
 *
ˇrd
)

2996 
¢d_soc_codec
 *
codec
;

2998 
	`li°_f‹_óch_íåy
(
codec
, &
ˇrd
->
codec_dev_li°
, 
li°
) {

2999 
	`soc_d≠m_shutdown_codec
(&
codec
->
d≠m
);

3000 
	`¢d_soc_d≠m_£t_büs_Àvñ
(&
codec
->
d≠m
, 
SND_SOC_BIAS_OFF
);

3002 
	}
}

3005 
MODULE_AUTHOR
("Liam Girdwood,Ürg@slimlogic.co.uk");

3006 
MODULE_DESCRIPTION
("Dynamic Audio Power Management core for ALSA SoC");

3007 
MODULE_LICENSE
("GPL");

	@soc-io.c

14 
	~<löux/i2c.h
>

15 
	~<löux/•i/•i.h
>

16 
	~<löux/ªgm≠.h
>

17 
	~<löux/exp‹t.h
>

18 
	~<sound/soc.h
>

20 
	~<åa˚/evíts/asoc.h
>

22 #ifde‡
CONFIG_REGMAP


23 
	$hw_wrôe
(
¢d_soc_codec
 *
codec
, 
ªg
,

24 
vÆue
)

26 
ªt
;

28 i‡(!
	`¢d_soc_codec_vﬁ©ûe_ªgi°î
(
codec
, 
ªg
) &&

29 
ªg
 < 
codec
->
drivî
->
ªg_ˇche_size
 &&

30 !
codec
->
ˇche_by∑ss
) {

31 
ªt
 = 
	`¢d_soc_ˇche_wrôe
(
codec
, 
ªg
, 
vÆue
);

32 i‡(
ªt
 < 0)

36 i‡(
codec
->
ˇche_⁄ly
) {

37 
codec
->
ˇche_sync
 = 1;

41  
	`ªgm≠_wrôe
(
codec
->
c⁄åﬁ_d©a
, 
ªg
, 
vÆue
);

42 
	}
}

44 
	$hw_ªad
(
¢d_soc_codec
 *
codec
, 
ªg
)

46 
ªt
;

47 
vÆ
;

49 i‡(
ªg
 >
codec
->
drivî
->
ªg_ˇche_size
 ||

50 
	`¢d_soc_codec_vﬁ©ûe_ªgi°î
(
codec
, 
ªg
) ||

51 
codec
->
ˇche_by∑ss
) {

52 i‡(
codec
->
ˇche_⁄ly
)

55 
ªt
 = 
	`ªgm≠_ªad
(
codec
->
c⁄åﬁ_d©a
, 
ªg
, &
vÆ
);

56 i‡(
ªt
 == 0)

57  
vÆ
;

62 
ªt
 = 
	`¢d_soc_ˇche_ªad
(
codec
, 
ªg
, &
vÆ
);

63 i‡(
ªt
 < 0)

65  
vÆ
;

66 
	}
}

76 
	$¢d_soc_hw_bulk_wrôe_øw
(
¢d_soc_codec
 *
codec
,

77 
ªg
,

78 c⁄° *
d©a
, 
size_t
 
Àn
)

85 i‡(!
codec
->
ˇche_by∑ss


86 && !
	`¢d_soc_codec_vﬁ©ûe_ªgi°î
(
codec
, 
ªg
)

87 && 
ªg
 < 
codec
->
drivî
->
ªg_ˇche_size
)

88  -
EINVAL
;

90  
	`ªgm≠_øw_wrôe
(
codec
->
c⁄åﬁ_d©a
, 
ªg
, 
d©a
, 
Àn
);

91 
	}
}

112 
	$¢d_soc_codec_£t_ˇche_io
(
¢d_soc_codec
 *
codec
,

113 
addr_bôs
, 
d©a_bôs
,

114 
¢d_soc_c⁄åﬁ_ty≥
 
c⁄åﬁ
)

116 
ªgm≠_c⁄fig
 
c⁄fig
;

118 
	`mem£t
(&
c⁄fig
, 0, (config));

119 
codec
->
wrôe
 = 
hw_wrôe
;

120 
codec
->
ªad
 = 
hw_ªad
;

121 
codec
->
bulk_wrôe_øw
 = 
¢d_soc_hw_bulk_wrôe_øw
;

123 
c⁄fig
.
ªg_bôs
 = 
addr_bôs
;

124 
c⁄fig
.
vÆ_bôs
 = 
d©a_bôs
;

126 
c⁄åﬁ
) {

127 #i‡
	`deföed
(
CONFIG_REGMAP_I2C
Ë|| deföed(
CONFIG_REGMAP_I2C_MODULE
)

128 
SND_SOC_I2C
:

129 
codec
->
c⁄åﬁ_d©a
 = 
	`ªgm≠_öô_i2c
(
	`to_i2c_˛õ¡
(codec->
dev
),

130 &
c⁄fig
);

134 #i‡
	`deföed
(
CONFIG_REGMAP_SPI
Ë|| deföed(
CONFIG_REGMAP_SPI_MODULE
)

135 
SND_SOC_SPI
:

136 
codec
->
c⁄åﬁ_d©a
 = 
	`ªgm≠_öô_•i
(
	`to_•i_devi˚
(codec->
dev
),

137 &
c⁄fig
);

141 
SND_SOC_REGMAP
:

146  -
EINVAL
;

149 i‡(
	`IS_ERR
(
codec
->
c⁄åﬁ_d©a
))

150  
	`PTR_ERR
(
codec
->
c⁄åﬁ_d©a
);

153 
	}
}

154 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_£t_ˇche_io
);

156 
	$¢d_soc_codec_£t_ˇche_io
(
¢d_soc_codec
 *
codec
,

157 
addr_bôs
, 
d©a_bôs
,

158 
¢d_soc_c⁄åﬁ_ty≥
 
c⁄åﬁ
)

160  -
ENOTSUPP
;

161 
	}
}

162 
EXPORT_SYMBOL_GPL
(
¢d_soc_codec_£t_ˇche_io
);

	@soc-jack.c

14 
	~<sound/jack.h
>

15 
	~<sound/soc.h
>

16 
	~<löux/gpio.h
>

17 
	~<löux/öãºu±.h
>

18 
	~<löux/w‹kqueue.h
>

19 
	~<löux/dñay.h
>

20 
	~<löux/exp‹t.h
>

21 
	~<åa˚/evíts/asoc.h
>

36 
	$¢d_soc_jack_√w
(
¢d_soc_codec
 *
codec
, c⁄° *
id
, 
ty≥
,

37 
¢d_soc_jack
 *
jack
)

39 
jack
->
codec
 = codec;

40 
	`INIT_LIST_HEAD
(&
jack
->
pös
);

41 
	`INIT_LIST_HEAD
(&
jack
->
jack_z⁄es
);

42 
	`BLOCKING_INIT_NOTIFIER_HEAD
(&
jack
->
nŸifõr
);

44  
	`¢d_jack_√w
(
codec
->
ˇrd
->
¢d_ˇrd
, 
id
, 
ty≥
, &
jack
->jack);

45 
	}
}

46 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_√w
);

62 
	$¢d_soc_jack_ªp‹t
(
¢d_soc_jack
 *
jack
, 
°©us
, 
mask
)

64 
¢d_soc_codec
 *
codec
;

65 
¢d_soc_d≠m_c⁄ãxt
 *
d≠m
;

66 
¢d_soc_jack_pö
 *
pö
;

67 
íabÀ
;

68 
ﬁd°©us
;

70 
	`åa˚_¢d_soc_jack_ªp‹t
(
jack
, 
mask
, 
°©us
);

72 i‡(!
jack
)

75 
codec
 = 
jack
->codec;

76 
d≠m
 = &
codec
->dapm;

78 
	`muãx_lock
(&
codec
->
muãx
);

80 
ﬁd°©us
 = 
jack
->
°©us
;

82 
jack
->
°©us
 &~
mask
;

83 
jack
->
°©us
 |°©u†& 
mask
;

87 i‡(
mask
 && (
jack
->
°©us
 =
ﬁd°©us
))

88 
out
;

90 
	`åa˚_¢d_soc_jack_nŸify
(
jack
, 
°©us
);

92 
	`li°_f‹_óch_íåy
(
pö
, &
jack
->
pös
, 
li°
) {

93 
íabÀ
 = 
pö
->
mask
 & 
jack
->
°©us
;

95 i‡(
pö
->
övît
)

96 
íabÀ
 = !enable;

98 i‡(
íabÀ
)

99 
	`¢d_soc_d≠m_íabÀ_pö
(
d≠m
, 
pö
->pin);

101 
	`¢d_soc_d≠m_dißbÀ_pö
(
d≠m
, 
pö
->pin);

105 
	`blockög_nŸifõr_ˇŒ_chaö
(&
jack
->
nŸifõr
, 
°©us
, jack);

107 
	`¢d_soc_d≠m_sync
(
d≠m
);

109 
	`¢d_jack_ªp‹t
(
jack
->jack, jack->
°©us
);

111 
out
:

112 
	`muãx_u∆ock
(&
codec
->
muãx
);

113 
	}
}

114 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_ªp‹t
);

126 
	$¢d_soc_jack_add_z⁄es
(
¢d_soc_jack
 *
jack
, 
cou¡
,

127 
¢d_soc_jack_z⁄e
 *
z⁄es
)

129 
i
;

131 
i
 = 0; i < 
cou¡
; i++) {

132 
	`INIT_LIST_HEAD
(&
z⁄es
[
i
].
li°
);

133 
	`li°_add
(&(
z⁄es
[
i
].
li°
), &
jack
->
jack_z⁄es
);

136 
	}
}

137 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_add_z⁄es
);

148 
	$¢d_soc_jack_gë_ty≥
(
¢d_soc_jack
 *
jack
, 
micbüs_vﬁège
)

150 
¢d_soc_jack_z⁄e
 *
z⁄e
;

152 
	`li°_f‹_óch_íåy
(
z⁄e
, &
jack
->
jack_z⁄es
, 
li°
) {

153 i‡(
micbüs_vﬁège
 >
z⁄e
->
mö_mv
 &&

154 
micbüs_vﬁège
 < 
z⁄e
->
max_mv
)

155  
z⁄e
->
jack_ty≥
;

158 
	}
}

159 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_gë_ty≥
);

172 
	$¢d_soc_jack_add_pös
(
¢d_soc_jack
 *
jack
, 
cou¡
,

173 
¢d_soc_jack_pö
 *
pös
)

175 
i
;

177 
i
 = 0; i < 
cou¡
; i++) {

178 i‡(!
pös
[
i
].
pö
) {

179 
	`¥ötk
(
KERN_ERR
 "Nÿ«mêf‹Öö %d\n", 
i
);

180  -
EINVAL
;

182 i‡(!
pös
[
i
].
mask
) {

183 
	`¥ötk
(
KERN_ERR
 "Nÿmask f‹Öö %d (%s)\n", 
i
,

184 
pös
[
i
].
pö
);

185  -
EINVAL
;

188 
	`INIT_LIST_HEAD
(&
pös
[
i
].
li°
);

189 
	`li°_add
(&(
pös
[
i
].
li°
), &
jack
->pins);

192 
	`¢d_soc_d≠m_√w_widgës
(&
jack
->
codec
->
ˇrd
->
d≠m
);

198 
	`¢d_soc_jack_ªp‹t
(
jack
, 0, 0);

201 
	}
}

202 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_add_pös
);

216 
	$¢d_soc_jack_nŸifõr_ªgi°î
(
¢d_soc_jack
 *
jack
,

217 
nŸifõr_block
 *
nb
)

219 
	`blockög_nŸifõr_chaö_ªgi°î
(&
jack
->
nŸifõr
, 
nb
);

220 
	}
}

221 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_nŸifõr_ªgi°î
);

231 
	$¢d_soc_jack_nŸifõr_uƒegi°î
(
¢d_soc_jack
 *
jack
,

232 
nŸifõr_block
 *
nb
)

234 
	`blockög_nŸifõr_chaö_uƒegi°î
(&
jack
->
nŸifõr
, 
nb
);

235 
	}
}

236 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_nŸifõr_uƒegi°î
);

238 #ifde‡
CONFIG_GPIOLIB


240 
	$¢d_soc_jack_gpio_dëe˘
(
¢d_soc_jack_gpio
 *
gpio
)

242 
¢d_soc_jack
 *
jack
 = 
gpio
->jack;

243 
íabÀ
;

244 
ªp‹t
;

246 
íabÀ
 = 
	`gpio_gë_vÆue_ˇn¶ìp
(
gpio
->gpio);

247 i‡(
gpio
->
övît
)

248 
íabÀ
 = !enable;

250 i‡(
íabÀ
)

251 
ªp‹t
 = 
gpio
->report;

253 
ªp‹t
 = 0;

255 i‡(
gpio
->
jack_°©us_check
)

256 
ªp‹t
 = 
gpio
->
	`jack_°©us_check
();

258 
	`¢d_soc_jack_ªp‹t
(
jack
, 
ªp‹t
, 
gpio
->report);

259 
	}
}

262 
úqªtu∫_t
 
	$gpio_h™dÀr
(
úq
, *
d©a
)

264 
¢d_soc_jack_gpio
 *
gpio
 = 
d©a
;

265 
devi˚
 *
dev
 = 
gpio
->
jack
->
codec
->
ˇrd
->dev;

267 
	`åa˚_¢d_soc_jack_úq
(
gpio
->
«me
);

269 i‡(
	`devi˚_may_wakeup
(
dev
))

270 
	`pm_wakeup_evít
(
dev
, 
gpio
->
deboun˚_time
 + 50);

272 
	`scheduÀ_dñayed_w‹k
(&
gpio
->
w‹k
,

273 
	`m£cs_to_jiffõs
(
gpio
->
deboun˚_time
));

275  
IRQ_HANDLED
;

276 
	}
}

279 
	$gpio_w‹k
(
w‹k_°ru˘
 *
w‹k
)

281 
¢d_soc_jack_gpio
 *
gpio
;

283 
gpio
 = 
	`c⁄èöî_of
(
w‹k
, 
¢d_soc_jack_gpio
, work.work);

284 
	`¢d_soc_jack_gpio_dëe˘
(
gpio
);

285 
	}
}

297 
	$¢d_soc_jack_add_gpios
(
¢d_soc_jack
 *
jack
, 
cou¡
,

298 
¢d_soc_jack_gpio
 *
gpios
)

300 
i
, 
ªt
;

302 
i
 = 0; i < 
cou¡
; i++) {

303 i‡(!
	`gpio_is_vÆid
(
gpios
[
i
].
gpio
)) {

304 
	`¥ötk
(
KERN_ERR
 "Invalid gpio %d\n",

305 
gpios
[
i
].
gpio
);

306 
ªt
 = -
EINVAL
;

307 
undo
;

309 i‡(!
gpios
[
i
].
«me
) {

310 
	`¥ötk
(
KERN_ERR
 "NoÇame for gpio %d\n",

311 
gpios
[
i
].
gpio
);

312 
ªt
 = -
EINVAL
;

313 
undo
;

316 
ªt
 = 
	`gpio_ªque°
(
gpios
[
i
].
gpio
, gpios[i].
«me
);

317 i‡(
ªt
)

318 
undo
;

320 
ªt
 = 
	`gpio_dúe˘i⁄_öput
(
gpios
[
i
].
gpio
);

321 i‡(
ªt
)

322 
îr
;

324 
	`INIT_DELAYED_WORK
(&
gpios
[
i
].
w‹k
, 
gpio_w‹k
);

325 
gpios
[
i
].
jack
 = jack;

327 
ªt
 = 
	`ªque°_™y_c⁄ãxt_úq
(
	`gpio_to_úq
(
gpios
[
i
].
gpio
),

328 
gpio_h™dÀr
,

329 
IRQF_TRIGGER_RISING
 |

330 
IRQF_TRIGGER_FALLING
,

331 
gpios
[
i
].
«me
,

332 &
gpios
[
i
]);

333 i‡(
ªt
 < 0)

334 
îr
;

336 i‡(
gpios
[
i
].
wake
) {

337 
ªt
 = 
	`úq_£t_úq_wake
(
	`gpio_to_úq
(
gpios
[
i
].
gpio
), 1);

338 i‡(
ªt
 != 0)

339 
	`¥ötk
(
KERN_ERR


341 
gpios
[
i
].
gpio
, 
ªt
);

344 #ifde‡
CONFIG_GPIO_SYSFS


346 
	`gpio_exp‹t
(
gpios
[
i
].
gpio
, 
Ál£
);

350 
	`¢d_soc_jack_gpio_dëe˘
(&
gpios
[
i
]);

355 
îr
:

356 
	`gpio_‰ì
(
gpios
[
i
].
gpio
);

357 
undo
:

358 
	`¢d_soc_jack_‰ì_gpios
(
jack
, 
i
, 
gpios
);

360  
ªt
;

361 
	}
}

362 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_add_gpios
);

373 
	$¢d_soc_jack_‰ì_gpios
(
¢d_soc_jack
 *
jack
, 
cou¡
,

374 
¢d_soc_jack_gpio
 *
gpios
)

376 
i
;

378 
i
 = 0; i < 
cou¡
; i++) {

379 #ifde‡
CONFIG_GPIO_SYSFS


380 
	`gpio_u√xp‹t
(
gpios
[
i
].
gpio
);

382 
	`‰ì_úq
(
	`gpio_to_úq
(
gpios
[
i
].
gpio
), &gpios[i]);

383 
	`ˇn˚l_dñayed_w‹k_sync
(&
gpios
[
i
].
w‹k
);

384 
	`gpio_‰ì
(
gpios
[
i
].
gpio
);

385 
gpios
[
i
].
jack
 = 
NULL
;

387 
	}
}

388 
EXPORT_SYMBOL_GPL
(
¢d_soc_jack_‰ì_gpios
);

	@soc-pcm.c

19 
	~<löux/kî√l.h
>

20 
	~<löux/öô.h
>

21 
	~<löux/dñay.h
>

22 
	~<löux/¶ab.h
>

23 
	~<löux/w‹kqueue.h
>

24 
	~<sound/c‹e.h
>

25 
	~<sound/pcm.h
>

26 
	~<sound/pcm_∑øms.h
>

27 
	~<sound/soc.h
>

28 
	~<sound/öôvÆ.h
>

30 
	$soc_pcm_≠∂y_symmëry
(
¢d_pcm_sub°ªam
 *
sub°ªam
,

31 
¢d_soc_dai
 *
soc_dai
)

33 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

34 
ªt
;

36 i‡(!
soc_dai
->
drivî
->
symmëric_øãs
 &&

37 !
πd
->
dai_lök
->
symmëric_øãs
)

44 i‡(!
soc_dai
->
øã
) {

45 
	`dev_w¨n
(
soc_dai
->
dev
,

50 
	`dev_dbg
(
soc_dai
->
dev
, "Symmëry f‹˚†%dHzÑ©e\n", soc_dai->
øã
);

52 
ªt
 = 
	`¢d_pcm_hw_c⁄°øöt_mömax
(
sub°ªam
->
ru¡ime
,

53 
SNDRV_PCM_HW_PARAM_RATE
,

54 
soc_dai
->
øã
, soc_dai->rate);

55 i‡(
ªt
 < 0) {

56 
	`dev_îr
(
soc_dai
->
dev
,

57 "U«bÀÅÿ≠∂yÑ©êsymmëry c⁄°øöt: %d\n", 
ªt
);

58  
ªt
;

62 
	}
}

69 
	$soc_pcm_›í
(
¢d_pcm_sub°ªam
 *
sub°ªam
)

71 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

72 
¢d_pcm_ru¡ime
 *
ru¡ime
 = 
sub°ªam
->runtime;

73 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

74 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

75 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

76 
¢d_soc_dai_drivî
 *
˝u_dai_drv
 = 
˝u_dai
->
drivî
;

77 
¢d_soc_dai_drivî
 *
codec_dai_drv
 = 
codec_dai
->
drivî
;

78 
ªt
 = 0;

80 
	`muãx_lock_√°ed
(&
πd
->
pcm_muãx
,Ñtd->
pcm_sub˛ass
);

83 i‡(
˝u_dai
->
drivî
->
›s
->
°¨tup
) {

84 
ªt
 = 
˝u_dai
->
drivî
->
›s
->
	`°¨tup
(
sub°ªam
, cpu_dai);

85 i‡(
ªt
 < 0) {

86 
	`¥ötk
(
KERN_ERR
 "asoc: can't open interface %s\n",

87 
˝u_dai
->
«me
);

88 
out
;

92 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
›í
) {

93 
ªt
 = 
∂©f‹m
->
drivî
->
›s
->
	`›í
(
sub°ªam
);

94 i‡(
ªt
 < 0) {

95 
	`¥ötk
(
KERN_ERR
 "asoc: c™'à›íÖœtf‹m %s\n", 
∂©f‹m
->
«me
);

96 
∂©f‹m_îr
;

100 i‡(
codec_dai
->
drivî
->
›s
->
°¨tup
) {

101 
ªt
 = 
codec_dai
->
drivî
->
›s
->
	`°¨tup
(
sub°ªam
, codec_dai);

102 i‡(
ªt
 < 0) {

103 
	`¥ötk
(
KERN_ERR
 "asoc: can't open codec %s\n",

104 
codec_dai
->
«me
);

105 
codec_dai_îr
;

109 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
°¨tup
) {

110 
ªt
 = 
πd
->
dai_lök
->
›s
->
	`°¨tup
(
sub°ªam
);

111 i‡(
ªt
 < 0) {

112 
	`¥ötk
(
KERN_ERR
 "asoc: %†°¨tu∞Áûed\n", 
πd
->
dai_lök
->
«me
);

113 
machöe_îr
;

118 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
) {

119 
ru¡ime
->
hw
.
øã_mö
 =

120 
	`max
(
codec_dai_drv
->
∂ayback
.
øã_mö
,

121 
˝u_dai_drv
->
∂ayback
.
øã_mö
);

122 
ru¡ime
->
hw
.
øã_max
 =

123 
	`mö
(
codec_dai_drv
->
∂ayback
.
øã_max
,

124 
˝u_dai_drv
->
∂ayback
.
øã_max
);

125 
ru¡ime
->
hw
.
ch™√ls_mö
 =

126 
	`max
(
codec_dai_drv
->
∂ayback
.
ch™√ls_mö
,

127 
˝u_dai_drv
->
∂ayback
.
ch™√ls_mö
);

128 
ru¡ime
->
hw
.
ch™√ls_max
 =

129 
	`mö
(
codec_dai_drv
->
∂ayback
.
ch™√ls_max
,

130 
˝u_dai_drv
->
∂ayback
.
ch™√ls_max
);

131 
ru¡ime
->
hw
.
f‹m©s
 =

132 
codec_dai_drv
->
∂ayback
.
f‹m©s
 & 
˝u_dai_drv
->playback.formats;

133 
ru¡ime
->
hw
.
øãs
 =

134 
codec_dai_drv
->
∂ayback
.
øãs
 & 
˝u_dai_drv
->playback.rates;

135 i‡(
codec_dai_drv
->
∂ayback
.
øãs


136 & (
SNDRV_PCM_RATE_KNOT
 | 
SNDRV_PCM_RATE_CONTINUOUS
))

137 
ru¡ime
->
hw
.
øãs
 |
˝u_dai_drv
->
∂ayback
.rates;

138 i‡(
˝u_dai_drv
->
∂ayback
.
øãs


139 & (
SNDRV_PCM_RATE_KNOT
 | 
SNDRV_PCM_RATE_CONTINUOUS
))

140 
ru¡ime
->
hw
.
øãs
 |
codec_dai_drv
->
∂ayback
.rates;

142 
ru¡ime
->
hw
.
øã_mö
 =

143 
	`max
(
codec_dai_drv
->
ˇ±uª
.
øã_mö
,

144 
˝u_dai_drv
->
ˇ±uª
.
øã_mö
);

145 
ru¡ime
->
hw
.
øã_max
 =

146 
	`mö
(
codec_dai_drv
->
ˇ±uª
.
øã_max
,

147 
˝u_dai_drv
->
ˇ±uª
.
øã_max
);

148 
ru¡ime
->
hw
.
ch™√ls_mö
 =

149 
	`max
(
codec_dai_drv
->
ˇ±uª
.
ch™√ls_mö
,

150 
˝u_dai_drv
->
ˇ±uª
.
ch™√ls_mö
);

151 
ru¡ime
->
hw
.
ch™√ls_max
 =

152 
	`mö
(
codec_dai_drv
->
ˇ±uª
.
ch™√ls_max
,

153 
˝u_dai_drv
->
ˇ±uª
.
ch™√ls_max
);

154 
ru¡ime
->
hw
.
f‹m©s
 =

155 
codec_dai_drv
->
ˇ±uª
.
f‹m©s
 & 
˝u_dai_drv
->capture.formats;

156 
ru¡ime
->
hw
.
øãs
 =

157 
codec_dai_drv
->
ˇ±uª
.
øãs
 & 
˝u_dai_drv
->capture.rates;

158 i‡(
codec_dai_drv
->
ˇ±uª
.
øãs


159 & (
SNDRV_PCM_RATE_KNOT
 | 
SNDRV_PCM_RATE_CONTINUOUS
))

160 
ru¡ime
->
hw
.
øãs
 |
˝u_dai_drv
->
ˇ±uª
.rates;

161 i‡(
˝u_dai_drv
->
ˇ±uª
.
øãs


162 & (
SNDRV_PCM_RATE_KNOT
 | 
SNDRV_PCM_RATE_CONTINUOUS
))

163 
ru¡ime
->
hw
.
øãs
 |
codec_dai_drv
->
ˇ±uª
.rates;

166 
ªt
 = -
EINVAL
;

167 
	`¢d_pcm_limô_hw_øãs
(
ru¡ime
);

168 i‡(!
ru¡ime
->
hw
.
øãs
) {

169 
	`¥ötk
(
KERN_ERR
 "asoc: %s <-> %s No matchingÑates\n",

170 
codec_dai
->
«me
, 
˝u_dai
->name);

171 
c⁄fig_îr
;

173 i‡(!
ru¡ime
->
hw
.
f‹m©s
) {

174 
	`¥ötk
(
KERN_ERR
 "asoc: %s <-> %s No matching formats\n",

175 
codec_dai
->
«me
, 
˝u_dai
->name);

176 
c⁄fig_îr
;

178 i‡(!
ru¡ime
->
hw
.
ch™√ls_mö
 || !ru¡ime->hw.
ch™√ls_max
 ||

179 
ru¡ime
->
hw
.
ch™√ls_mö
 >Ñu¡ime->hw.
ch™√ls_max
) {

180 
	`¥ötk
(
KERN_ERR
 "asoc: %s <-> %s No matching channels\n",

181 
codec_dai
->
«me
, 
˝u_dai
->name);

182 
c⁄fig_îr
;

186 i‡(
˝u_dai
->
a˘ive
) {

187 
ªt
 = 
	`soc_pcm_≠∂y_symmëry
(
sub°ªam
, 
˝u_dai
);

188 i‡(
ªt
 != 0)

189 
c⁄fig_îr
;

192 i‡(
codec_dai
->
a˘ive
) {

193 
ªt
 = 
	`soc_pcm_≠∂y_symmëry
(
sub°ªam
, 
codec_dai
);

194 i‡(
ªt
 != 0)

195 
c⁄fig_îr
;

198 
	`¥_debug
("asoc: %s <-> %s info:\n",

199 
codec_dai
->
«me
, 
˝u_dai
->name);

200 
	`¥_debug
("asoc:Ñ©êmask 0x%x\n", 
ru¡ime
->
hw
.
øãs
);

201 
	`¥_debug
("asoc: mö ch %d max ch %d\n", 
ru¡ime
->
hw
.
ch™√ls_mö
,

202 
ru¡ime
->
hw
.
ch™√ls_max
);

203 
	`¥_debug
("asoc: möÑ©ê%d maxÑ©ê%d\n", 
ru¡ime
->
hw
.
øã_mö
,

204 
ru¡ime
->
hw
.
øã_max
);

206 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
) {

207 
˝u_dai
->
∂ayback_a˘ive
++;

208 
codec_dai
->
∂ayback_a˘ive
++;

210 
˝u_dai
->
ˇ±uª_a˘ive
++;

211 
codec_dai
->
ˇ±uª_a˘ive
++;

213 
˝u_dai
->
a˘ive
++;

214 
codec_dai
->
a˘ive
++;

215 
πd
->
codec
->
a˘ive
++;

216 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

219 
c⁄fig_îr
:

220 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
shutdown
)

221 
πd
->
dai_lök
->
›s
->
	`shutdown
(
sub°ªam
);

223 
machöe_îr
:

224 i‡(
codec_dai
->
drivî
->
›s
->
shutdown
)

225 
codec_dai
->
drivî
->
›s
->
	`shutdown
(
sub°ªam
, codec_dai);

227 
codec_dai_îr
:

228 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
˛o£
)

229 
∂©f‹m
->
drivî
->
›s
->
	`˛o£
(
sub°ªam
);

231 
∂©f‹m_îr
:

232 i‡(
˝u_dai
->
drivî
->
›s
->
shutdown
)

233 
˝u_dai
->
drivî
->
›s
->
	`shutdown
(
sub°ªam
, cpu_dai);

234 
out
:

235 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

236  
ªt
;

237 
	}
}

244 
	$˛o£_dñayed_w‹k
(
w‹k_°ru˘
 *
w‹k
)

246 
¢d_soc_pcm_ru¡ime
 *
πd
 =

247 
	`c⁄èöî_of
(
w‹k
, 
¢d_soc_pcm_ru¡ime
, 
dñayed_w‹k
.work);

248 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

250 
	`muãx_lock_√°ed
(&
πd
->
pcm_muãx
,Ñtd->
pcm_sub˛ass
);

252 
	`¥_debug
("pop wq checking: %s status: %s waiting: %s\n",

253 
codec_dai
->
drivî
->
∂ayback
.
°ªam_«me
,

254 
codec_dai
->
∂ayback_a˘ive
 ? "active" : "inactive",

255 
codec_dai
->
p›_waô
 ? "yes" : "no");

258 i‡(
codec_dai
->
p›_waô
 == 1) {

259 
codec_dai
->
p›_waô
 = 0;

260 
	`¢d_soc_d≠m_°ªam_evít
(
πd
,

261 
codec_dai
->
drivî
->
∂ayback
.
°ªam_«me
,

262 
SND_SOC_DAPM_STREAM_STOP
);

265 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

266 
	}
}

273 
	$soc_pcm_˛o£
(
¢d_pcm_sub°ªam
 *
sub°ªam
)

275 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

276 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

277 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

278 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

279 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

281 
	`muãx_lock_√°ed
(&
πd
->
pcm_muãx
,Ñtd->
pcm_sub˛ass
);

283 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
) {

284 
˝u_dai
->
∂ayback_a˘ive
--;

285 
codec_dai
->
∂ayback_a˘ive
--;

287 
˝u_dai
->
ˇ±uª_a˘ive
--;

288 
codec_dai
->
ˇ±uª_a˘ive
--;

291 
˝u_dai
->
a˘ive
--;

292 
codec_dai
->
a˘ive
--;

293 
codec
->
a˘ive
--;

296 i‡(!
˝u_dai
->
a˘ive
)

297 
˝u_dai
->
øã
 = 0;

299 i‡(!
codec_dai
->
a˘ive
)

300 
codec_dai
->
øã
 = 0;

305 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
)

306 
	`¢d_soc_dai_digôÆ_muã
(
codec_dai
, 1);

308 i‡(
˝u_dai
->
drivî
->
›s
->
shutdown
)

309 
˝u_dai
->
drivî
->
›s
->
	`shutdown
(
sub°ªam
, cpu_dai);

311 i‡(
codec_dai
->
drivî
->
›s
->
shutdown
)

312 
codec_dai
->
drivî
->
›s
->
	`shutdown
(
sub°ªam
, codec_dai);

314 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
shutdown
)

315 
πd
->
dai_lök
->
›s
->
	`shutdown
(
sub°ªam
);

317 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
˛o£
)

318 
∂©f‹m
->
drivî
->
›s
->
	`˛o£
(
sub°ªam
);

319 
˝u_dai
->
ru¡ime
 = 
NULL
;

321 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
) {

322 i‡(
	`u∆ikñy
(
codec
->
ign‹e_pmdown_time
)) {

324 
	`¢d_soc_d≠m_°ªam_evít
(
πd
,

325 
codec_dai
->
drivî
->
∂ayback
.
°ªam_«me
,

326 
SND_SOC_DAPM_STREAM_STOP
);

329 
codec_dai
->
p›_waô
 = 1;

330 
	`scheduÀ_dñayed_w‹k
(&
πd
->
dñayed_w‹k
,

331 
	`m£cs_to_jiffõs
(
πd
->
pmdown_time
));

335 
	`¢d_soc_d≠m_°ªam_evít
(
πd
,

336 
codec_dai
->
drivî
->
ˇ±uª
.
°ªam_«me
,

337 
SND_SOC_DAPM_STREAM_STOP
);

340 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

342 
	}
}

349 
	$soc_pcm_¥ï¨e
(
¢d_pcm_sub°ªam
 *
sub°ªam
)

351 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

352 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

353 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

354 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

355 
ªt
 = 0;

357 
	`muãx_lock_√°ed
(&
πd
->
pcm_muãx
,Ñtd->
pcm_sub˛ass
);

359 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
¥ï¨e
) {

360 
ªt
 = 
πd
->
dai_lök
->
›s
->
	`¥ï¨e
(
sub°ªam
);

361 i‡(
ªt
 < 0) {

362 
	`¥ötk
(
KERN_ERR
 "asoc: machineÖrepareÉrror\n");

363 
out
;

367 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
¥ï¨e
) {

368 
ªt
 = 
∂©f‹m
->
drivî
->
›s
->
	`¥ï¨e
(
sub°ªam
);

369 i‡(
ªt
 < 0) {

370 
	`¥ötk
(
KERN_ERR
 "asoc:ÖlatformÖrepareÉrror\n");

371 
out
;

375 i‡(
codec_dai
->
drivî
->
›s
->
¥ï¨e
) {

376 
ªt
 = 
codec_dai
->
drivî
->
›s
->
	`¥ï¨e
(
sub°ªam
, codec_dai);

377 i‡(
ªt
 < 0) {

378 
	`¥ötk
(
KERN_ERR
 "asoc: codec DAIÖrepareÉrror\n");

379 
out
;

383 i‡(
˝u_dai
->
drivî
->
›s
->
¥ï¨e
) {

384 
ªt
 = 
˝u_dai
->
drivî
->
›s
->
	`¥ï¨e
(
sub°ªam
, cpu_dai);

385 i‡(
ªt
 < 0) {

386 
	`¥ötk
(
KERN_ERR
 "asoc: cpu DAIÖrepareÉrror\n");

387 
out
;

392 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
 &&

393 
codec_dai
->
p›_waô
) {

394 
codec_dai
->
p›_waô
 = 0;

395 
	`ˇn˚l_dñayed_w‹k
(&
πd
->
dñayed_w‹k
);

398 i‡(
sub°ªam
->
°ªam
 =
SNDRV_PCM_STREAM_PLAYBACK
)

399 
	`¢d_soc_d≠m_°ªam_evít
(
πd
,

400 
codec_dai
->
drivî
->
∂ayback
.
°ªam_«me
,

401 
SND_SOC_DAPM_STREAM_START
);

403 
	`¢d_soc_d≠m_°ªam_evít
(
πd
,

404 
codec_dai
->
drivî
->
ˇ±uª
.
°ªam_«me
,

405 
SND_SOC_DAPM_STREAM_START
);

407 
	`¢d_soc_dai_digôÆ_muã
(
codec_dai
, 0);

409 
out
:

410 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

411  
ªt
;

412 
	}
}

419 
	$soc_pcm_hw_∑øms
(
¢d_pcm_sub°ªam
 *
sub°ªam
,

420 
¢d_pcm_hw_∑øms
 *
∑øms
)

422 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

423 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

424 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

425 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

426 
ªt
 = 0;

428 
	`muãx_lock_√°ed
(&
πd
->
pcm_muãx
,Ñtd->
pcm_sub˛ass
);

430 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
hw_∑øms
) {

431 
ªt
 = 
πd
->
dai_lök
->
›s
->
	`hw_∑øms
(
sub°ªam
, 
∑øms
);

432 i‡(
ªt
 < 0) {

433 
	`¥ötk
(
KERN_ERR
 "asoc: machine hw_params failed\n");

434 
out
;

438 i‡(
codec_dai
->
drivî
->
›s
->
hw_∑øms
) {

439 
ªt
 = 
codec_dai
->
drivî
->
›s
->
	`hw_∑øms
(
sub°ªam
, 
∑øms
, codec_dai);

440 i‡(
ªt
 < 0) {

441 
	`¥ötk
(
KERN_ERR
 "asoc: can't set codec %s hwÖarams\n",

442 
codec_dai
->
«me
);

443 
codec_îr
;

447 i‡(
˝u_dai
->
drivî
->
›s
->
hw_∑øms
) {

448 
ªt
 = 
˝u_dai
->
drivî
->
›s
->
	`hw_∑øms
(
sub°ªam
, 
∑øms
, cpu_dai);

449 i‡(
ªt
 < 0) {

450 
	`¥ötk
(
KERN_ERR
 "asoc: interface %s hwÖarams failed\n",

451 
˝u_dai
->
«me
);

452 
öãrÁ˚_îr
;

456 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
hw_∑øms
) {

457 
ªt
 = 
∂©f‹m
->
drivî
->
›s
->
	`hw_∑øms
(
sub°ªam
, 
∑øms
);

458 i‡(
ªt
 < 0) {

459 
	`¥ötk
(
KERN_ERR
 "asoc:Ölatform %s hwÖarams failed\n",

460 
∂©f‹m
->
«me
);

461 
∂©f‹m_îr
;

466 
˝u_dai
->
øã
 = 
	`∑øms_øã
(
∑øms
);

467 
codec_dai
->
øã
 = 
	`∑øms_øã
(
∑øms
);

469 
out
:

470 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

471  
ªt
;

473 
∂©f‹m_îr
:

474 i‡(
˝u_dai
->
drivî
->
›s
->
hw_‰ì
)

475 
˝u_dai
->
drivî
->
›s
->
	`hw_‰ì
(
sub°ªam
, cpu_dai);

477 
öãrÁ˚_îr
:

478 i‡(
codec_dai
->
drivî
->
›s
->
hw_‰ì
)

479 
codec_dai
->
drivî
->
›s
->
	`hw_‰ì
(
sub°ªam
, codec_dai);

481 
codec_îr
:

482 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
hw_‰ì
)

483 
πd
->
dai_lök
->
›s
->
	`hw_‰ì
(
sub°ªam
);

485 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

486  
ªt
;

487 
	}
}

492 
	$soc_pcm_hw_‰ì
(
¢d_pcm_sub°ªam
 *
sub°ªam
)

494 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

495 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

496 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

497 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

498 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

500 
	`muãx_lock_√°ed
(&
πd
->
pcm_muãx
,Ñtd->
pcm_sub˛ass
);

503 i‡(!
codec
->
a˘ive
)

504 
	`¢d_soc_dai_digôÆ_muã
(
codec_dai
, 1);

507 i‡(
πd
->
dai_lök
->
›s
 &&Ñtd->dai_lök->›s->
hw_‰ì
)

508 
πd
->
dai_lök
->
›s
->
	`hw_‰ì
(
sub°ªam
);

511 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
hw_‰ì
)

512 
∂©f‹m
->
drivî
->
›s
->
	`hw_‰ì
(
sub°ªam
);

515 i‡(
codec_dai
->
drivî
->
›s
->
hw_‰ì
)

516 
codec_dai
->
drivî
->
›s
->
	`hw_‰ì
(
sub°ªam
, codec_dai);

518 i‡(
˝u_dai
->
drivî
->
›s
->
hw_‰ì
)

519 
˝u_dai
->
drivî
->
›s
->
	`hw_‰ì
(
sub°ªam
, cpu_dai);

521 
	`muãx_u∆ock
(&
πd
->
pcm_muãx
);

523 
	}
}

525 
	$soc_pcm_åiggî
(
¢d_pcm_sub°ªam
 *
sub°ªam
, 
cmd
)

527 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

528 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

529 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

530 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

531 
ªt
;

533 i‡(
codec_dai
->
drivî
->
›s
->
åiggî
) {

534 
ªt
 = 
codec_dai
->
drivî
->
›s
->
	`åiggî
(
sub°ªam
, 
cmd
, codec_dai);

535 i‡(
ªt
 < 0)

536  
ªt
;

539 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
åiggî
) {

540 
ªt
 = 
∂©f‹m
->
drivî
->
›s
->
	`åiggî
(
sub°ªam
, 
cmd
);

541 i‡(
ªt
 < 0)

542  
ªt
;

545 i‡(
˝u_dai
->
drivî
->
›s
->
åiggî
) {

546 
ªt
 = 
˝u_dai
->
drivî
->
›s
->
	`åiggî
(
sub°ªam
, 
cmd
, cpu_dai);

547 i‡(
ªt
 < 0)

548  
ªt
;

551 
	}
}

558 
¢d_pcm_u‰ames_t
 
	$soc_pcm_poöãr
(
¢d_pcm_sub°ªam
 *
sub°ªam
)

560 
¢d_soc_pcm_ru¡ime
 *
πd
 = 
sub°ªam
->
¥iv©e_d©a
;

561 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

562 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

563 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

564 
¢d_pcm_ru¡ime
 *
ru¡ime
 = 
sub°ªam
->runtime;

565 
¢d_pcm_u‰ames_t
 
off£t
 = 0;

566 
¢d_pcm_s‰ames_t
 
dñay
 = 0;

568 i‡(
∂©f‹m
->
drivî
->
›s
 &&Öœtf‹m->drivî->›s->
poöãr
)

569 
off£t
 = 
∂©f‹m
->
drivî
->
›s
->
	`poöãr
(
sub°ªam
);

571 i‡(
˝u_dai
->
drivî
->
›s
->
dñay
)

572 
dñay
 +
˝u_dai
->
drivî
->
›s
->
	`dñay
(
sub°ªam
, cpu_dai);

574 i‡(
codec_dai
->
drivî
->
›s
->
dñay
)

575 
dñay
 +
codec_dai
->
drivî
->
›s
->
	`dñay
(
sub°ªam
, codec_dai);

577 i‡(
∂©f‹m
->
drivî
->
dñay
)

578 
dñay
 +
∂©f‹m
->
drivî
->
	`dñay
(
sub°ªam
, 
codec_dai
);

580 
ru¡ime
->
dñay
 = delay;

582  
off£t
;

583 
	}
}

586 
¢d_pcm_›s
 
	gsoc_pcm_›s
 = {

587 .
›í
 = 
soc_pcm_›í
,

588 .
	g˛o£
 = 
soc_pcm_˛o£
,

589 .
	ghw_∑øms
 = 
soc_pcm_hw_∑øms
,

590 .
	ghw_‰ì
 = 
soc_pcm_hw_‰ì
,

591 .
	g¥ï¨e
 = 
soc_pcm_¥ï¨e
,

592 .
	gåiggî
 = 
soc_pcm_åiggî
,

593 .
	gpoöãr
 = 
soc_pcm_poöãr
,

597 
	$soc_√w_pcm
(
¢d_soc_pcm_ru¡ime
 *
πd
, 
num
)

599 
¢d_soc_codec
 *
codec
 = 
πd
->codec;

600 
¢d_soc_∂©f‹m
 *
∂©f‹m
 = 
πd
->platform;

601 
¢d_soc_dai
 *
codec_dai
 = 
πd
->codec_dai;

602 
¢d_soc_dai
 *
˝u_dai
 = 
πd
->cpu_dai;

603 
¢d_pcm
 *
pcm
;

604 
√w_«me
[64];

605 
ªt
 = 0, 
∂ayback
 = 0, 
ˇ±uª
 = 0;

608 
	`¢¥ötf
(
√w_«me
, (new_name), "%s %s-%d",

609 
πd
->
dai_lök
->
°ªam_«me
, 
codec_dai
->
«me
, 
num
);

611 i‡(
codec_dai
->
drivî
->
∂ayback
.
ch™√ls_mö
)

612 
∂ayback
 = 1;

613 i‡(
codec_dai
->
drivî
->
ˇ±uª
.
ch™√ls_mö
)

614 
ˇ±uª
 = 1;

616 
	`dev_dbg
(
πd
->
ˇrd
->
dev
, "ªgi°îedÖcm #%d %s\n",
num
,
√w_«me
);

617 
ªt
 = 
	`¢d_pcm_√w
(
πd
->
ˇrd
->
¢d_ˇrd
, 
√w_«me
,

618 
num
, 
∂ayback
, 
ˇ±uª
, &
pcm
);

619 i‡(
ªt
 < 0) {

620 
	`¥ötk
(
KERN_ERR
 "asoc: c™'à¸óãÖcm f‹ code¯%s\n", 
codec
->
«me
);

621  
ªt
;

625 
	`INIT_DELAYED_WORK
(&
πd
->
dñayed_w‹k
, 
˛o£_dñayed_w‹k
);

627 
πd
->
pcm
 =Öcm;

628 
pcm
->
¥iv©e_d©a
 = 
πd
;

629 i‡(
∂©f‹m
->
drivî
->
›s
) {

630 
soc_pcm_›s
.
mm≠
 = 
∂©f‹m
->
drivî
->
›s
->mmap;

631 
soc_pcm_›s
.
poöãr
 = 
∂©f‹m
->
drivî
->
›s
->pointer;

632 
soc_pcm_›s
.
io˘l
 = 
∂©f‹m
->
drivî
->
›s
->ioctl;

633 
soc_pcm_›s
.
c›y
 = 
∂©f‹m
->
drivî
->
›s
->copy;

634 
soc_pcm_›s
.
sûí˚
 = 
∂©f‹m
->
drivî
->
›s
->silence;

635 
soc_pcm_›s
.
ack
 = 
∂©f‹m
->
drivî
->
›s
->ack;

636 
soc_pcm_›s
.
∑ge
 = 
∂©f‹m
->
drivî
->
›s
->page;

639 i‡(
∂ayback
)

640 
	`¢d_pcm_£t_›s
(
pcm
, 
SNDRV_PCM_STREAM_PLAYBACK
, &
soc_pcm_›s
);

642 i‡(
ˇ±uª
)

643 
	`¢d_pcm_£t_›s
(
pcm
, 
SNDRV_PCM_STREAM_CAPTURE
, &
soc_pcm_›s
);

645 i‡(
∂©f‹m
->
drivî
->
pcm_√w
) {

646 
ªt
 = 
∂©f‹m
->
drivî
->
	`pcm_√w
(
πd
);

647 i‡(
ªt
 < 0) {

648 
	`¥_îr
("asoc:ÖlatformÖcm constructor failed\n");

649  
ªt
;

653 
pcm
->
¥iv©e_‰ì
 = 
∂©f‹m
->
drivî
->
pcm_‰ì
;

654 
	`¥ötk
(
KERN_INFO
 "asoc: %†<-> %†m≠pög ok\n", 
codec_dai
->
«me
,

655 
˝u_dai
->
«me
);

656  
ªt
;

657 
	}
}

	@soc-utils.c

16 
	~<löux/∂©f‹m_devi˚.h
>

17 
	~<löux/exp‹t.h
>

18 
	~<sound/c‹e.h
>

19 
	~<sound/pcm.h
>

20 
	~<sound/pcm_∑øms.h
>

21 
	~<sound/soc.h
>

23 
	$¢d_soc_ˇlc_‰ame_size
(
ßm∂e_size
, 
ch™√ls
, 
tdm_¶Ÿs
)

25  
ßm∂e_size
 * 
ch™√ls
 * 
tdm_¶Ÿs
;

26 
	}
}

27 
EXPORT_SYMBOL_GPL
(
¢d_soc_ˇlc_‰ame_size
);

29 
	$¢d_soc_∑øms_to_‰ame_size
(
¢d_pcm_hw_∑øms
 *
∑øms
)

31 
ßm∂e_size
;

33 
ßm∂e_size
 = 
	`¢d_pcm_f‹m©_width
(
	`∑øms_f‹m©
(
∑øms
));

34 i‡(
ßm∂e_size
 < 0)

35  
ßm∂e_size
;

37  
	`¢d_soc_ˇlc_‰ame_size
(
ßm∂e_size
, 
	`∑øms_ch™√ls
(
∑øms
),

39 
	}
}

40 
EXPORT_SYMBOL_GPL
(
¢d_soc_∑øms_to_‰ame_size
);

42 
	$¢d_soc_ˇlc_b˛k
(
fs
, 
ßm∂e_size
, 
ch™√ls
, 
tdm_¶Ÿs
)

44  
fs
 * 
	`¢d_soc_ˇlc_‰ame_size
(
ßm∂e_size
, 
ch™√ls
, 
tdm_¶Ÿs
);

45 
	}
}

46 
EXPORT_SYMBOL_GPL
(
¢d_soc_ˇlc_b˛k
);

48 
	$¢d_soc_∑øms_to_b˛k
(
¢d_pcm_hw_∑øms
 *
∑øms
)

50 
ªt
;

52 
ªt
 = 
	`¢d_soc_∑øms_to_‰ame_size
(
∑øms
);

54 i‡(
ªt
 > 0)

55  
ªt
 * 
	`∑øms_øã
(
∑øms
);

57  
ªt
;

58 
	}
}

59 
EXPORT_SYMBOL_GPL
(
¢d_soc_∑øms_to_b˛k
);

61 c⁄° 
¢d_pcm_h¨dw¨e
 
	gdummy_dma_h¨dw¨e
 = {

62 .
f‹m©s
 = 0xffffffff,

63 .
	gch™√ls_mö
 = 1,

64 .
	gch™√ls_max
 = 
UINT_MAX
,

67 .
	göfo
 = 
SNDRV_PCM_INFO_INTERLEAVED
 |

68 
SNDRV_PCM_INFO_BLOCK_TRANSFER
,

69 .
	gbuf„r_byãs_max
 = 128*1024,

70 .
	g≥riod_byãs_mö
 = 
PAGE_SIZE
,

71 .
	g≥riod_byãs_max
 = 
PAGE_SIZE
*2,

72 .
	g≥riods_mö
 = 2,

73 .
	g≥riods_max
 = 128,

76 
	$dummy_dma_›í
(
¢d_pcm_sub°ªam
 *
sub°ªam
)

78 
	`¢d_soc_£t_ru¡ime_hw∑øms
(
sub°ªam
, &
dummy_dma_h¨dw¨e
);

81 
	}
}

83 
¢d_pcm_›s
 
	gdummy_dma_›s
 = {

84 .
›í
 = 
dummy_dma_›í
,

85 .
	gio˘l
 = 
¢d_pcm_lib_io˘l
,

88 
¢d_soc_∂©f‹m_drivî
 
	gdummy_∂©f‹m
 = {

89 .
›s
 = &
dummy_dma_›s
,

92 
__devöô
 
	$¢d_soc_dummy_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

94  
	`¢d_soc_ªgi°î_∂©f‹m
(&
pdev
->
dev
, &
dummy_∂©f‹m
);

95 
	}
}

97 
__devexô
 
	$¢d_soc_dummy_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

99 
	`¢d_soc_uƒegi°î_∂©f‹m
(&
pdev
->
dev
);

102 
	}
}

104 
∂©f‹m_drivî
 
	gsoc_dummy_drivî
 = {

105 .
drivî
 = {

106 .
«me
 = "snd-soc-dummy",

107 .
	gow√r
 = 
THIS_MODULE
,

109 .
	g¥obe
 = 
¢d_soc_dummy_¥obe
,

110 .
	gªmove
 = 
__devexô_p
(
¢d_soc_dummy_ªmove
),

113 
∂©f‹m_devi˚
 *
	gsoc_dummy_dev
;

115 
__öô
 
	$¢d_soc_utû_öô
()

117 
ªt
;

119 
soc_dummy_dev
 = 
	`∂©f‹m_devi˚_Æloc
("snd-soc-dummy", -1);

120 i‡(!
soc_dummy_dev
)

121  -
ENOMEM
;

123 
ªt
 = 
	`∂©f‹m_devi˚_add
(
soc_dummy_dev
);

124 i‡(
ªt
 != 0) {

125 
	`∂©f‹m_devi˚_put
(
soc_dummy_dev
);

126  
ªt
;

129 
ªt
 = 
	`∂©f‹m_drivî_ªgi°î
(&
soc_dummy_drivî
);

130 i‡(
ªt
 != 0)

131 
	`∂©f‹m_devi˚_uƒegi°î
(
soc_dummy_dev
);

133  
ªt
;

134 
	}
}

136 
__exô
 
	$¢d_soc_utû_exô
()

138 
	`∂©f‹m_devi˚_uƒegi°î
(
soc_dummy_dev
);

139 
	`∂©f‹m_drivî_uƒegi°î
(&
soc_dummy_drivî
);

140 
	}
}

	@/usr/include/linux/i2c.h

27 #i‚de‡
_LINUX_I2C_H


28 
	#_LINUX_I2C_H


	)

30 
	~<löux/ty≥s.h
>

68 
	si2c_msg
 {

69 
__u16
 
	maddr
;

70 
__u16
 
	mÊags
;

71 
	#I2C_M_TEN
 0x0010

	)

72 
	#I2C_M_RD
 0x0001

	)

73 
	#I2C_M_STOP
 0x8000

	)

74 
	#I2C_M_NOSTART
 0x4000

	)

75 
	#I2C_M_REV_DIR_ADDR
 0x2000

	)

76 
	#I2C_M_IGNORE_NAK
 0x1000

	)

77 
	#I2C_M_NO_RD_ACK
 0x0800

	)

78 
	#I2C_M_RECV_LEN
 0x0400

	)

79 
__u16
 
	mÀn
;

80 
__u8
 *
	mbuf
;

85 
	#I2C_FUNC_I2C
 0x00000001

	)

86 
	#I2C_FUNC_10BIT_ADDR
 0x00000002

	)

87 
	#I2C_FUNC_PROTOCOL_MANGLING
 0x00000004

	)

88 
	#I2C_FUNC_SMBUS_PEC
 0x00000008

	)

89 
	#I2C_FUNC_NOSTART
 0x00000010

	)

90 
	#I2C_FUNC_SMBUS_BLOCK_PROC_CALL
 0x00008000

	)

91 
	#I2C_FUNC_SMBUS_QUICK
 0x00010000

	)

92 
	#I2C_FUNC_SMBUS_READ_BYTE
 0x00020000

	)

93 
	#I2C_FUNC_SMBUS_WRITE_BYTE
 0x00040000

	)

94 
	#I2C_FUNC_SMBUS_READ_BYTE_DATA
 0x00080000

	)

95 
	#I2C_FUNC_SMBUS_WRITE_BYTE_DATA
 0x00100000

	)

96 
	#I2C_FUNC_SMBUS_READ_WORD_DATA
 0x00200000

	)

97 
	#I2C_FUNC_SMBUS_WRITE_WORD_DATA
 0x00400000

	)

98 
	#I2C_FUNC_SMBUS_PROC_CALL
 0x00800000

	)

99 
	#I2C_FUNC_SMBUS_READ_BLOCK_DATA
 0x01000000

	)

100 
	#I2C_FUNC_SMBUS_WRITE_BLOCK_DATA
 0x02000000

	)

101 
	#I2C_FUNC_SMBUS_READ_I2C_BLOCK
 0x04000000

	)

102 
	#I2C_FUNC_SMBUS_WRITE_I2C_BLOCK
 0x08000000

	)

104 
	#I2C_FUNC_SMBUS_BYTE
 (
I2C_FUNC_SMBUS_READ_BYTE
 | \

105 
I2C_FUNC_SMBUS_WRITE_BYTE
)

	)

106 
	#I2C_FUNC_SMBUS_BYTE_DATA
 (
I2C_FUNC_SMBUS_READ_BYTE_DATA
 | \

107 
I2C_FUNC_SMBUS_WRITE_BYTE_DATA
)

	)

108 
	#I2C_FUNC_SMBUS_WORD_DATA
 (
I2C_FUNC_SMBUS_READ_WORD_DATA
 | \

109 
I2C_FUNC_SMBUS_WRITE_WORD_DATA
)

	)

110 
	#I2C_FUNC_SMBUS_BLOCK_DATA
 (
I2C_FUNC_SMBUS_READ_BLOCK_DATA
 | \

111 
I2C_FUNC_SMBUS_WRITE_BLOCK_DATA
)

	)

112 
	#I2C_FUNC_SMBUS_I2C_BLOCK
 (
I2C_FUNC_SMBUS_READ_I2C_BLOCK
 | \

113 
I2C_FUNC_SMBUS_WRITE_I2C_BLOCK
)

	)

115 
	#I2C_FUNC_SMBUS_EMUL
 (
I2C_FUNC_SMBUS_QUICK
 | \

116 
I2C_FUNC_SMBUS_BYTE
 | \

117 
I2C_FUNC_SMBUS_BYTE_DATA
 | \

118 
I2C_FUNC_SMBUS_WORD_DATA
 | \

119 
I2C_FUNC_SMBUS_PROC_CALL
 | \

120 
I2C_FUNC_SMBUS_WRITE_BLOCK_DATA
 | \

121 
I2C_FUNC_SMBUS_I2C_BLOCK
 | \

122 
I2C_FUNC_SMBUS_PEC
)

	)

127 
	#I2C_SMBUS_BLOCK_MAX
 32

	)

128 
	ui2c_smbus_d©a
 {

129 
__u8
 
	mbyã
;

130 
__u16
 
	mw‹d
;

131 
__u8
 
	mblock
[
I2C_SMBUS_BLOCK_MAX
 + 2];

136 
	#I2C_SMBUS_READ
 1

	)

137 
	#I2C_SMBUS_WRITE
 0

	)

141 
	#I2C_SMBUS_QUICK
 0

	)

142 
	#I2C_SMBUS_BYTE
 1

	)

143 
	#I2C_SMBUS_BYTE_DATA
 2

	)

144 
	#I2C_SMBUS_WORD_DATA
 3

	)

145 
	#I2C_SMBUS_PROC_CALL
 4

	)

146 
	#I2C_SMBUS_BLOCK_DATA
 5

	)

147 
	#I2C_SMBUS_I2C_BLOCK_BROKEN
 6

	)

148 
	#I2C_SMBUS_BLOCK_PROC_CALL
 7

	)

149 
	#I2C_SMBUS_I2C_BLOCK_DATA
 8

	)

	@/usr/include/linux/kernel.h

1 #i‚de‡
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<löux/sysöfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a
Ë
	`__ALIGN_KERNEL_MASK
(x, (
	`ty≥of
(x))◊Ë- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

	@/usr/include/linux/sysinfo.h

1 #i‚de‡
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<löux/ty≥s.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysöfo
 {

8 
__kî√l_l⁄g_t
 
	mu±ime
;

9 
__kî√l_ul⁄g_t
 
	mlﬂds
[3];

10 
__kî√l_ul⁄g_t
 
	mtŸÆøm
;

11 
__kî√l_ul⁄g_t
 
	m‰ìøm
;

12 
__kî√l_ul⁄g_t
 
	msh¨edøm
;

13 
__kî√l_ul⁄g_t
 
	mbuf„ºam
;

14 
__kî√l_ul⁄g_t
 
	mtŸÆsw≠
;

15 
__kî√l_ul⁄g_t
 
	m‰ìsw≠
;

16 
__u16
 
	m¥ocs
;

17 
__u16
 
	m∑d
;

18 
__kî√l_ul⁄g_t
 
	mtŸÆhigh
;

19 
__kî√l_ul⁄g_t
 
	m‰ìhigh
;

20 
__u32
 
	mmem_unô
;

21 
	m_f
[20-2*(
__kî√l_ul⁄g_t
)-(
__u32
)];

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

46 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

47 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

48 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-gíîic/ty≥s.h
>

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_bôs
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__kî√l_fd_£t
;

29 (*
	t__kî√l_sigh™dÀr_t
)();

32 
	t__kî√l_key_t
;

33 
	t__kî√l_mqd_t
;

35 
	~<asm/posix_ty≥s.h
>

	@/usr/include/asm-generic/types.h

1 #i‚de‡
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-gíîic/öt-Œ64.h
>

	@/usr/include/asm/posix_types.h

1 #ifde‡
__i386__


2 
	~<asm/posix_ty≥s_32.h
>

3 #ñi‡
deföed
(
__ILP32__
)

4 
	~<asm/posix_ty≥s_x32.h
>

6 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/linux/stddef.h

	@/usr/include/asm-generic/int-ll64.h

8 #i‚de‡
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__ASSEMBLY__


19 
__sig√d__
 
	t__s8
;

20 
	t__u8
;

22 
__sig√d__
 
	t__s16
;

23 
	t__u16
;

25 
__sig√d__
 
	t__s32
;

26 
	t__u32
;

28 #ifde‡
__GNUC__


29 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

30 
__exãnsi⁄__
 
	t__u64
;

32 
__sig√d__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm/posix_types_32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__kî√l_mode_t
;

11 
	#__kî√l_mode_t
 
__kî√l_mode_t


	)

13 
	t__kî√l_ùc_pid_t
;

14 
	#__kî√l_ùc_pid_t
 
__kî√l_ùc_pid_t


	)

16 
	t__kî√l_uid_t
;

17 
	t__kî√l_gid_t
;

18 
	#__kî√l_uid_t
 
__kî√l_uid_t


	)

20 
	t__kî√l_ﬁd_dev_t
;

21 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

23 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_64.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__kî√l_ﬁd_uid_t
;

11 
	t__kî√l_ﬁd_gid_t
;

12 
	#__kî√l_ﬁd_uid_t
 
__kî√l_ﬁd_uid_t


	)

14 
	t__kî√l_ﬁd_dev_t
;

15 
	#__kî√l_ﬁd_dev_t
 
__kî√l_ﬁd_dev_t


	)

17 
	~<asm-gíîic/posix_ty≥s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #i‚de‡
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__kî√l_l⁄g_t
;

14 
	t__kî√l_ul⁄g_t
;

15 
	#__kî√l_l⁄g_t
 
__kî√l_l⁄g_t


	)

17 
	~<asm/posix_ty≥s_64.h
>

	@/usr/include/asm-generic/posix_types.h

1 #i‚de‡
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__kî√l_l⁄g_t


14 
	t__kî√l_l⁄g_t
;

15 
	t__kî√l_ul⁄g_t
;

18 #i‚de‡
__kî√l_öo_t


19 
__kî√l_ul⁄g_t
 
	t__kî√l_öo_t
;

22 #i‚de‡
__kî√l_mode_t


23 
	t__kî√l_mode_t
;

26 #i‚de‡
__kî√l_pid_t


27 
	t__kî√l_pid_t
;

30 #i‚de‡
__kî√l_ùc_pid_t


31 
	t__kî√l_ùc_pid_t
;

34 #i‚de‡
__kî√l_uid_t


35 
	t__kî√l_uid_t
;

36 
	t__kî√l_gid_t
;

39 #i‚de‡
__kî√l_su£c⁄ds_t


40 
__kî√l_l⁄g_t
 
	t__kî√l_su£c⁄ds_t
;

43 #i‚de‡
__kî√l_daddr_t


44 
	t__kî√l_daddr_t
;

47 #i‚de‡
__kî√l_uid32_t


48 
	t__kî√l_uid32_t
;

49 
	t__kî√l_gid32_t
;

52 #i‚de‡
__kî√l_ﬁd_uid_t


53 
__kî√l_uid_t
 
	t__kî√l_ﬁd_uid_t
;

54 
__kî√l_gid_t
 
	t__kî√l_ﬁd_gid_t
;

57 #i‚de‡
__kî√l_ﬁd_dev_t


58 
	t__kî√l_ﬁd_dev_t
;

65 #i‚de‡
__kî√l_size_t


66 #i‡
__BITS_PER_LONG
 != 64

67 
	t__kî√l_size_t
;

68 
	t__kî√l_ssize_t
;

69 
	t__kî√l_±rdiff_t
;

71 
__kî√l_ul⁄g_t
 
	t__kî√l_size_t
;

72 
__kî√l_l⁄g_t
 
	t__kî√l_ssize_t
;

73 
__kî√l_l⁄g_t
 
	t__kî√l_±rdiff_t
;

77 #i‚de‡
__kî√l_fsid_t


79 
	mvÆ
[2];

80 } 
	t__kî√l_fsid_t
;

86 
__kî√l_l⁄g_t
 
	t__kî√l_off_t
;

87 
	t__kî√l_loff_t
;

88 
__kî√l_l⁄g_t
 
	t__kî√l_time_t
;

89 
__kî√l_l⁄g_t
 
	t__kî√l_˛ock_t
;

90 
	t__kî√l_timî_t
;

91 
	t__kî√l_˛ockid_t
;

92 * 
	t__kî√l_ˇddr_t
;

93 
	t__kî√l_uid16_t
;

94 
	t__kî√l_gid16_t
;

	@/usr/include/asm/bitsperlong.h

1 #i‚de‡
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifde‡
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-gíîic/bô•îl⁄g.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #i‚de‡
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #i‚de‡
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
23
583
soc-cache.c
soc-core.c
soc-dapm.c
soc-io.c
soc-jack.c
soc-pcm.c
soc-utils.c
/usr/include/linux/i2c.h
/usr/include/linux/kernel.h
/usr/include/linux/sysinfo.h
/usr/include/linux/types.h
/usr/include/asm/types.h
/usr/include/linux/posix_types.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/linux/stddef.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
